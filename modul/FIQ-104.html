<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIQ-104: Fiqih Puasa Ramadhan - Kurikulum Sempurna</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #1e3a8a; 
            --secondary: #fbbf24; 
            --accent: #ef4444;
            --bg-body: #f1f5f9;
        }
        body { font-family: 'Noto Sans', sans-serif; background-color: var(--bg-body); }
        .arabic { font-family: 'Amiri', serif; direction: rtl; line-height: 2.5; font-size: 1.75rem; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .teacher-note { 
            border-left: 5px solid var(--secondary); 
            background: #fffbeb; 
            padding: 1.5rem; 
            margin: 2rem 0; 
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        .nav-active { 
            background-color: var(--primary) !important; 
            color: white !important; 
            border-bottom: 4px solid var(--secondary);
            transform: translateY(-2px);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .btn-option { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-option:hover:not(:disabled) { transform: translateX(8px); background-color: #f8fafc; border-color: var(--primary); }
    </style>
</head>
<body class="text-slate-900 leading-relaxed">

    <!-- Header & Navigation -->
    <header class="bg-blue-900 text-white sticky top-0 z-50 shadow-2xl border-b-4 border-amber-400">
        <div class="max-w-[1400px] mx-auto overflow-x-auto no-scrollbar">
            <nav class="flex items-center space-x-1 p-3 min-w-max">
                <div class="px-5 py-2 bg-blue-950 rounded-full font-extrabold text-sm tracking-widest mr-6 border border-blue-700 uppercase">FIQ-104</div>
                <button onclick="switchTab('p1')" id="btn-p1" class="nav-btn px-6 py-2 rounded-xl hover:bg-blue-800 transition-all font-semibold text-sm">P1: Definisi & Syarat</button>
                <button onclick="switchTab('p2')" id="btn-p2" class="nav-btn px-6 py-2 rounded-xl hover:bg-blue-800 transition-all font-semibold text-sm">P2: Rukun Puasa</button>
                <button onclick="switchTab('p3')" id="btn-p3" class="nav-btn px-6 py-2 rounded-xl hover:bg-blue-800 transition-all font-semibold text-sm">P3: Pembatal Puasa</button>
                <button onclick="switchTab('p4')" id="btn-p4" class="nav-btn px-6 py-2 rounded-xl hover:bg-blue-800 transition-all font-semibold text-sm">P4: Hal-Hal Makruh</button>
                <button onclick="switchTab('p5')" id="btn-p5" class="nav-btn px-6 py-2 rounded-xl hover:bg-blue-800 transition-all font-semibold text-sm">P5: Sunnah Puasa</button>
                <button onclick="switchTab('p6')" id="btn-p6" class="nav-btn px-6 py-2 rounded-xl hover:bg-blue-800 transition-all font-semibold text-sm">P6: Rukhsah (Keringanan)</button>
                <button onclick="switchTab('p7')" id="btn-p7" class="nav-btn px-6 py-2 rounded-xl hover:bg-blue-800 transition-all font-semibold text-sm">P7: Qadha & Fidyah</button>
                <button onclick="switchTab('p8')" id="btn-p8" class="nav-btn px-6 py-2 rounded-xl hover:bg-blue-800 transition-all font-semibold text-sm">P8: Adab Berhari Raya</button>
                <button onclick="switchTab('sumatif')" id="btn-sumatif" class="nav-btn px-8 py-2 rounded-xl bg-amber-500 text-blue-950 font-black hover:bg-amber-400 transition-all text-sm ml-6 uppercase shadow-lg">Ujian Akhir</button>
            </nav>
        </div>
    </header>

    <main class="max-w-5xl mx-auto py-12 px-6" id="main-container">
        <!-- JS will render content here -->
    </main>

    <script>
        const dataModul = {
            p1: {
                title: "Pertemuan 1: Definisi, Keutamaan, & Syarat Wajib Puasa",
                tujuan: [
                    "Memahami definisi puasa secara bahasa dan syariat.",
                    "Mengetahui dalil kewajiban puasa Ramadhan dari Al-Qur'an dan Sunnah.",
                    "Merinci syarat-syarat wajib puasa sehingga santri tahu siapa yang terkena beban syariat.",
                    "Menanamkan niat yang tulus (Ikhlas) sebagai syarat diterimanya ibadah."
                ],
                dalil: {
                    arab: "يَا أَيُّهَا الَّذِينَ آمَنُوا كُتِبَ عَلَيْكُمُ الصِّيَامُ كَمَا كُتِبَ عَلَى الَّذِينَ مِنْ قَبْلِكُمْ لَعَلَّكُمْ تَتَّقُونَ",
                    indo: "Hai orang-orang yang beriman, diwajibkan atas kamu berpuasa sebagaimana diwajibkan atas orang-orang sebelum kamu agar kamu bertakwa. (QS. Al-Baqarah: 183)"
                },
                nilai: "Puasa bukan sekadar menahan lapar, melainkan Madrasah Takwa. Keterkaitannya dengan Manhaj Salaf adalah pemurnian ibadah hanya untuk Allah (Tauhid) dan mengikuti petunjuk Nabi Muhammad ﷺ (Ittiba').",
                skenario: `
                    <div class="space-y-6">
                        <p><strong>1. Definisi Puasa (Ash-Shiyam):</strong> Secara bahasa bermakna <em>Al-Imsak</em> (menahan diri). Secara syariat adalah menahan diri dari pembatal-pembatal puasa sejak terbit fajar shadiq hingga terbenam matahari dengan niat ibadah.</p>
                        <p><strong>2. Analogi Gelas:</strong> Bayangkan sebuah gelas yang penuh dengan air keruh. Untuk mengisinya dengan air jernih (iman), kita harus mengosongkannya terlebih dahulu. Puasa mengosongkan perut dan syahwat untuk diisi dengan ketaatan.</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-xl">
                                <h4 class="font-bold text-blue-800 mb-2 underline">Syarat Wajib Puasa:</h4>
                                <ul class="list-decimal ml-5 text-sm space-y-1">
                                    <li>Islam (Tidak wajib bagi kafir).</li>
                                    <li>Baligh (Mencapai usia dewasa).</li>
                                    <li>Berakal (Tidak gila).</li>
                                    <li>Mukim (Tidak sedang safar/perjalanan jauh).</li>
                                    <li>Mampu secara fisik (Tidak sakit parah/tua renta).</li>
                                    <li>Suci dari Haid & Nifas (Bagi wanita).</li>
                                </ul>
                            </div>
                            <div class="text-center">
                                <img src="https://images.unsplash.com/photo-1590076247267-55e71ffde2ef?w=600" class="rounded-xl shadow-md w-full h-40 object-cover" alt="Ramadan Moon">
                                <p class="text-[10px] mt-2 text-slate-500 italic">Sumber: Unsplash - Simbol Ramadhan</p>
                            </div>
                        </div>
                        <div class="flex justify-center p-4">
                            <svg width="200" height="100" viewBox="0 0 200 100">
                                <rect x="10" y="40" width="180" height="20" rx="10" fill="#e2e8f0"/>
                                <circle cx="40" cy="50" r="15" fill="#1e3a8a">
                                    <animate attributeName="cx" from="40" to="160" dur="2s" repeatCount="indefinite" />
                                </circle>
                                <text x="10" y="30" font-size="12" fill="#64748b">Fajar</text>
                                <text x="150" y="30" font-size="12" fill="#64748b">Maghrib</text>
                            </svg>
                        </div>
                    </div>
                `,
                teacherNote: "Tekankan bahwa anak-anak yang belum baligh belum wajib, namun sebaiknya dilatih berpuasa bertahap jika mampu untuk membiasakan ketaatan sejak dini.",
                penilaian: `
                    <section class="mt-8 border-t-2 border-slate-100 pt-6">
                        <h2 class="text-2xl font-black text-blue-900 mb-4 uppercase tracking-tighter">D. Penilaian Modul</h2>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="p-4 bg-white rounded-xl shadow-sm border">
                                <h4 class="font-bold text-emerald-700">1. Aspek Sikap (Adab)</h4>
                                <p class="text-xs text-slate-500">Ketaatan mengikuti instruksi, keseriusan dalam doa, dan adab terhadap guru serta sesama santri.</p>
                            </div>
                            <div class="p-4 bg-white rounded-xl shadow-sm border">
                                <h4 class="font-bold text-blue-700">2. Aspek Pengetahuan</h4>
                                <p class="text-xs text-slate-500">Skor latihan formatif (minimal 70) dan kemampuan menjelaskan rukun serta pembatal secara lisan.</p>
                            </div>
                            <div class="p-4 bg-white rounded-xl shadow-sm border">
                                <h4 class="font-bold text-amber-700">3. Aspek Keterampilan</h4>
                                <p class="text-xs text-slate-500">Mampu mensimulasikan niat yang benar dan membedakan antara air wudhu yang tertelan sengaja vs tidak.</p>
                            </div>
                        </div>
                    </section>
                `,
                simulasi: [
                    { q: "Manakah yang merupakan syarat Wajib Puasa?", opts: ["Kaya", "Baligh", "Sudah menikah", "Punya rumah"], ans: 1 },
                    { q: "Kapan puasa dimulai?", opts: ["Terbit matahari", "Adzan Subuh/Fajar Shadiq", "Jam 6 pagi", "Adzan Dzuhur"], ans: 1 }
                ],
                formatif: [
                    { q: "Apa arti Ash-Shiyam secara bahasa?", a: ["Makan", "Minum", "Menahan diri", "Berlari"], c: 2 },
                    { q: "Puasa Ramadhan hukumnya...", a: ["Sunnah", "Mubah", "Wajib", "Makruh"], c: 2 },
                    { q: "Salah satu syarat wajib puasa adalah...", a: ["Laki-laki", "Berakal", "Kaya", "Tinggi"], c: 1 },
                    { q: "Wanita yang sedang haid hukum puasanya...", a: ["Wajib", "Sunnah", "Haram", "Makruh"], c: 2 },
                    { q: "Dalil puasa terdapat dalam surat Al-Baqarah ayat...", a: ["183", "184", "185", "186"], c: 0 },
                    { q: "Niat puasa dilakukan pada...", a: ["Siang hari", "Malam hari sebelum fajar", "Setelah berbuka", "Kapan saja"], c: 1 },
                    { q: "Siapa yang tidak wajib puasa karena fisik?", a: ["Pelajar", "Orang tua renta yang lemah", "Pedagang", "Atlet"], c: 1 },
                    { q: "Puasa dimulai sejak terbit...", a: ["Matahari", "Fajar Shadiq", "Bintang", "Bulan"], c: 1 },
                    { q: "Tujuan akhir puasa (QS 2:183) adalah...", a: ["Sehat", "Kurus", "Bertakwa", "Hemat"], c: 2 },
                    { q: "Apakah orang gila wajib puasa?", a: ["Ya", "Tidak", "Setengah hari", "Tergantung wali"], c: 1 }
                ]
            },
            p2: {
                title: "Pertemuan 2: Rukun Puasa Ramadhan",
                tujuan: [
                    "Mengidentifikasi 2 rukun utama puasa.",
                    "Memahami pentingnya niat di malam hari untuk puasa wajib.",
                    "Menjelaskan batasan waktu imsak yang sebenarnya menurut sunnah."
                ],
                dalil: {
                    arab: "إِنَّمَا الأَعْمَالُ بِالنِّيَّاتِ",
                    indo: "Sesungguhnya setiap amalan itu tergantung pada niatnya. (HR. Bukhari & Muslim)"
                },
                nilai: "Keikhlasan adalah pondasi. Rukun memastikan ibadah kita sah secara teknis di mata hukum Allah.",
                skenario: `
                    <div class="space-y-4">
                        <p>Rukun puasa hanya ada dua, namun jika salah satu hilang, puasa batal secara total:</p>
                        <ul class="list-disc ml-6">
                            <li><strong>Niat:</strong> Menanamkan keinginan berpuasa di dalam hati. Untuk puasa Ramadhan, niat harus dilakukan sebelum fajar (Tabyitun Niyah).</li>
                            <li><strong>Al-Imsak:</strong> Menahan diri dari makan, minum, dan hubungan suami istri dari fajar hingga maghrib.</li>
                        </ul>
                        <div class="bg-amber-50 p-4 border-l-4 border-amber-500 rounded">
                            <p class="text-sm"><strong>PENTING:</strong> Niat bertempat di hati. Melafadzkan niat secara lisan bukan termasuk syarat sah, yang utama adalah kesadaran hati untuk berpuasa esok hari.</p>
                        </div>
                        <img src="https://images.unsplash.com/photo-1542810634-7bc278057dc3?w=600" class="rounded-lg shadow w-full h-40 object-cover" alt="Mosque">
                        <p class="text-[10px] text-center italic">Sumber: Unsplash - Suasana Ibadah</p>
                    </div>
                `,
                teacherNote: "Ingatkan santri bahwa makan sahur otomatis sudah dianggap memiliki niat di dalam hati.",
                simulasi: [
                    { q: "Dimana tempat niat yang benar?", opts: ["Di mulut", "Di hati", "Di kertas", "Di depan guru"], ans: 1 },
                    { q: "Kapan batas akhir makan sahur?", opts: ["Imsak 10 menit sebelum subuh", "Saat adzan subuh berkumandang", "Jam 5 pagi", "Terbit matahari"], ans: 1 }
                ],
                formatif: [
                    { q: "Ada berapa rukun puasa?", a: ["1", "2", "3", "4"], c: 1 },
                    { q: "Rukun pertama adalah...", a: ["Mandi", "Makan", "Niat", "Lari"], c: 2 },
                    { q: "Kapan niat puasa wajib dilakukan?", a: ["Pagi hari", "Malam hari", "Siang hari", "Setelah maghrib"], c: 1 },
                    { q: "Rukun kedua adalah menahan diri dari...", a: ["Bicara", "Tidur", "Pembatal puasa", "Bermain"], c: 2 },
                    { q: "Batas awal puasa adalah fajar...", a: ["Kadzib", "Shadiq", "Biasa", "Matahari"], c: 1 },
                    { q: "Batas akhir puasa adalah...", a: ["Ashar", "Isya", "Maghrib/Terbenam Matahari", "Jam 6"], c: 2 },
                    { q: "Apakah sah puasa tanpa niat?", a: ["Sah", "Tidak Sah", "Mungkin", "Tergantung"], c: 1 },
                    { q: "Apakah sahur termasuk tanda adanya niat?", a: ["Ya", "Tidak", "Hanya jika kenyang", "Bukan"], c: 0 },
                    { q: "Niat harus dilakukan setiap...", a: ["Minggu", "Malam (untuk esoknya)", "Bulan", "Tahun"], c: 1 },
                    { q: "Menahan diri disebut juga...", a: ["Imsak", "Ifthar", "Sahur", "Shalat"], c: 0 }
                ]
            },
            p3: {
                title: "Pertemuan 3: Pembatal-Pembatal Puasa",
                tujuan: ["Mengetahui hal yang membatalkan puasa.", "Membedakan antara pembatal yang disengaja dan tidak.", "Memahami konsekuensi pembatal puasa."],
                dalil: {
                    arab: "فَالآنَ بَاشِرُوهُنَّ وَابْتَغُوا مَا كَتَبَ اللَّهُ لَكُمْ وَكُلُوا وَاشْرَبُوا حَتَّى يَتَبَيَّنَ لَكُمُ الْخَيْطُ الأَبْيَضُ مِنَ الْخَيْطِ الأَسْوَدِ مِنَ الْفَجْرِ",
                    indo: "...makan minumlah hingga terang bagimu benang putih dari benang hitam, yaitu fajar... (QS. Al-Baqarah: 187)"
                },
                nilai: "Kejujuran (Ash-Shidq). Hanya Allah dan kita yang tahu apakah kita benar-benar berpuasa atau makan sembunyi-sembunyi.",
                skenario: `
                    <div class="space-y-4">
                        <p>Pembatal puasa secara umum dibagi dua:</p>
                        <ol class="list-decimal ml-6 font-semibold">
                            <li>Makan dan minum dengan sengaja.</li>
                            <li>Memasukkan sesuatu ke rongga tubuh dengan sengaja.</li>
                            <li>Muntah dengan sengaja.</li>
                            <li>Haid dan Nifas bagi wanita.</li>
                            <li>Gila atau murtad.</li>
                            <li>Berhubungan suami istri di siang hari.</li>
                        </ol>
                        <div class="teacher-note">
                            Guru: Jelaskan bahwa jika makan/minum karena LUPA, maka puasa tetap sah. Itu adalah rezeki dari Allah.
                        </div>
                        <img src="https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600" class="rounded-lg shadow w-full h-40 object-cover" alt="Healthy Food">
                    </div>
                `,
                teacherNote: "Berikan contoh konkret seperti menelan dahak (khilaf ulama) vs menelan air minum.",
                simulasi: [
                    { q: "Lupa makan siang, apakah puasa batal?", opts: ["Ya, batal", "Tidak, tetap sah", "Harus bayar denda", "Puasa setengah hari"], ans: 1 },
                    { q: "Sengaja muntah dengan memasukkan jari ke tenggorokan?", opts: ["Tetap sah", "Batal", "Boleh saja", "Makruh"], ans: 1 }
                ],
                formatif: [
                    { q: "Makan sengaja hukumnya...", a: ["Sah", "Makruh", "Batal", "Boleh"], c: 2 },
                    { q: "Makan karena LUPA hukumnya...", a: ["Batal", "Sah", "Haram", "Wajib qadha"], c: 1 },
                    { q: "Muntah TIDAK sengaja hukumnya...", a: ["Batal", "Sah", "Makruh", "Haram"], c: 1 },
                    { q: "Keluar darah haid saat ashar?", a: ["Lanjut puasa", "Puasa Batal", "Boleh makan sedikit", "Tidak tahu"], c: 1 },
                    { q: "Memasukkan obat lewat dubur?", a: ["Batal", "Sah", "Boleh", "Sunnah"], c: 0 },
                    { q: "Menelan sisa makanan di gigi (sebesar biji)?", a: ["Sah", "Batal", "Boleh", "Bagus"], c: 1 },
                    { q: "Murtad (keluar Islam) membatalkan puasa?", a: ["Ya", "Tidak", "Mungkin", "Tergantung niat"], c: 0 },
                    { q: "Berhubungan suami istri siang hari dendanya...", a: ["Ringan", "Berat (Kaffarah)", "Tidak ada", "Hanya minta maaf"], c: 1 },
                    { q: "Menelan ludah sendiri yang bersih?", a: ["Batal", "Sah", "Makruh", "Haram"], c: 1 },
                    { q: "Pingsan sepanjang hari (subuh-maghrib)?", a: ["Sah", "Batal", "Boleh", "Sunnah"], c: 1 }
                ]
            },
            p4: {
                title: "Pertemuan 4: Hal-Hal yang Dimakruhkan",
                tujuan: ["Menghindari perilaku yang mengurangi pahala puasa.", "Membedakan batal (sah/tidak) dengan makruh (pahala berkurang)."],
                dalil: {
                    arab: "رُبَّ صَائِمٍ لَيْسَ لَهُ مِنْ صِيَامِهِ إِلَّا الْجُوعُ",
                    indo: "Betapa banyak orang yang berpuasa, namun dia tidak mendapatkan apa-apa dari puasanya kecuali rasa lapar. (HR. Ahmad)"
                },
                nilai: "Kualitas di atas Kuantitas. Puasa bukan sekadar menahan fisik tapi juga lisan dan hati.",
                skenario: `
                    <p>Makruh artinya jika dilakukan tidak membatalkan puasa, tapi dibenci dan mengurangi kesempurnaan pahala.</p>
                    <div class="grid md:grid-cols-2 gap-4 my-4">
                        <div class="p-4 bg-red-50 rounded-lg">
                            <h4 class="font-bold">Contoh Makruh:</h4>
                            <ul class="text-sm list-disc ml-5">
                                <li>Berkumur berlebihan (khawatir tertelan).</li>
                                <li>Mencicipi makanan tanpa hajat (keperluan).</li>
                                <li>Berdusta, ghibah (gosip), dan marah.</li>
                                <li>Banyak tidur tanpa alasan.</li>
                            </ul>
                        </div>
                        <img src="https://images.unsplash.com/photo-1499209974870-103b7517adba?w=600" class="rounded-lg shadow object-cover h-40" alt="Sleeping">
                    </div>
                `,
                teacherNote: "Tekankan bahwa ghibah dan dusta bisa menghanguskan seluruh pahala puasa meskipun puasanya secara fiqih tetap sah (tidak perlu mengulang).",
                simulasi: [
                    { q: "Berkumur sangat keras saat wudhu siang hari?", opts: ["Sangat dianjurkan", "Makruh", "Wajib", "Batal"], ans: 1 },
                    { q: "Berbohong saat puasa?", opts: ["Batal puasa", "Pahala hilang (Makruh/Haram)", "Boleh saja", "Hanya sedikit dosa"], ans: 1 }
                ],
                formatif: [
                    { q: "Makruh artinya...", a: ["Dapat pahala", "Dibenci/Pahala kurang", "Wajib", "Batal"], c: 1 },
                    { q: "Ghibah (gosip) saat puasa membuat...", a: ["Puasanya batal", "Pahala hilang", "Badan kurus", "Puasanya makin bagus"], c: 1 },
                    { q: "Mencicipi makanan di lidah lalu dibuang?", a: ["Batal", "Makruh jika tanpa hajat", "Sunnah", "Haram"], c: 1 },
                    { q: "Berkumur berlebihan disebut...", a: ["Mubalaghah", "Imsak", "Ifthar", "Sahur"], c: 0 },
                    { q: "Banyak tidur saat puasa Ramadhan?", a: ["Wajib", "Makruh (jika malas-malasan)", "Sunnah", "Batal"], c: 1 },
                    { q: "Sikat gigi siang hari dengan pasta yang kuat rasa?", a: ["Sunnah", "Makruh/Khilaf", "Batal", "Wajib"], c: 1 },
                    { q: "Berbekam (hijamah) saat puasa menurut sebagian ulama?", a: ["Sunnah", "Makruh/Batal", "Boleh", "Wajib"], c: 1 },
                    { q: "Mencium pasangan bagi yang muda (khawatir syahwat)?", a: ["Sunnah", "Wajib", "Makruh", "Batal"], c: 2 },
                    { q: "Puasa tapi tidak shalat?", a: ["Pahala sempurna", "Sangat buruk/Pahala terancam", "Bagus", "Tidak pengaruh"], c: 1 },
                    { q: "Berteriak-teriak tidak jelas?", a: ["Makruh", "Wajib", "Sah", "Sunnah"], c: 0 }
                ]
            },
            p5: {
                title: "Pertemuan 5: Sunnah-Sunnah Puasa",
                tujuan: ["Mengamalkan adab Nabi ﷺ saat berpuasa.", "Meningkatkan pahala dengan amalan tambahan."],
                dalil: {
                    arab: "تَسَحَّرُوا فَإِنَّ فِي السَّحُورِ بَرَكَةً",
                    indo: "Makan sahurlah kalian, karena pada sahur itu ada keberkahan. (HR. Bukhari)"
                },
                nilai: "Ittiba' (Mengikuti Sunnah). Kebahagiaan seorang mukmin adalah saat mengikuti jejak Rasulullah ﷺ.",
                skenario: `
                    <div class="space-y-4">
                        <p>Sunnah puasa adalah hal-hal yang jika dilakukan akan menambah pahala berlipat ganda:</p>
                        <ul class="list-disc ml-6 space-y-2">
                            <li><strong>Mengakhirkan Sahur:</strong> Makan mendekati waktu fajar.</li>
                            <li><strong>Menyegerakan Berbuka:</strong> Segera makan saat adzan maghrib.</li>
                            <li><strong>Berdoa saat Berbuka:</strong> <em>Dzahabazh zhama'u...</em></li>
                            <li><strong>Berbuka dengan Kurma (Rutab/Tamr) atau Air.</strong></li>
                            <li><strong>Memperbanyak Sedekah dan Tilawah Al-Qur'an.</strong></li>
                        </ul>
                        <div class="flex justify-center">
                             <img src="https://images.unsplash.com/photo-1584271813633-596956637fc3?w=600" class="rounded-xl h-48 w-64 object-cover" alt="Dates">
                        </div>
                    </div>
                `,
                teacherNote: "Ajarkan doa berbuka yang shahih: 'Dzahabazh-zhama’u wab-tallatil ‘uruuqu wa tsabatal ajru in sya Allah'.",
                simulasi: [
                    { q: "Kapan waktu terbaik sahur?", opts: ["Jam 12 malam", "Satu jam sebelum subuh", "Mendekati fajar subuh", "Setelah subuh"], ans: 2 },
                    { q: "Menu buka puasa terbaik menurut sunnah?", opts: ["Gorengan", "Es krim", "Kurma dan air", "Nasi padang"], ans: 2 }
                ],
                formatif: [
                    { q: "Makan sahur hukumnya...", a: ["Wajib", "Mubah", "Sunnah Muakkad", "Haram"], c: 2 },
                    { q: "Keutamaan sahur adalah adanya...", a: ["Kenyang", "Berkah", "Ngantuk", "Lapar"], c: 1 },
                    { q: "Waktu berbuka yang benar adalah...", a: ["Tunggu adzan selesai", "Segera saat matahari terbenam", "Jam 7 malam", "Tunggu gelap"], c: 1 },
                    { q: "Buka puasa dengan kurma basah disebut...", a: ["Rutab", "Tamr", "Sukkari", "Ajwa"], c: 0 },
                    { q: "Sedekah di bulan Ramadhan pahalanya...", a: ["Biasa saja", "Sama dengan bulan lain", "Berlipat ganda", "Kecil"], c: 2 },
                    { q: "Doa berbuka diucapkan...", a: ["Sebelum makan", "Setelah makan", "Satu jam sebelumnya", "Besoknya"], c: 1 },
                    { q: "Banyak membaca Al-Qur'an adalah sunnah...", a: ["Pasti", "Boleh", "Wajib", "Makruh"], c: 0 },
                    { q: "Makan sahur sebaiknya...", a: ["Diawalkan", "Diakhirkan", "Ditinggalkan", "Sekali saja"], c: 1 },
                    { q: "Memberi makan orang berbuka?", a: ["Dapat pahala puasa orang itu", "Rugi", "Dosa", "Biasa"], c: 0 },
                    { q: "Meninggalkan perkataan sia-sia?", a: ["Haram", "Wajib", "Sunnah/Penyempurna", "Batal"], c: 2 }
                ]
            },
            p6: {
                title: "Pertemuan 6: Rukhsah (Keringanan) Tidak Berpuasa",
                tujuan: ["Memahami kasih sayang Allah dalam syariat.", "Mengetahui siapa saja yang boleh tidak berpuasa."],
                dalil: {
                    arab: "يُرِيدُ اللَّهُ بِكُمُ الْيُسْرَ وَلَا يُرِيدُ بِكُمُ الْعُسْرَ",
                    indo: "Allah menghendaki kemudahan bagimu, dan tidak menghendaki kesukaran bagimu. (QS. Al-Baqarah: 185)"
                },
                nilai: "Keadilan Allah. Agama ini mudah dan tidak membebani hamba di luar kemampuannya.",
                skenario: `
                    <p>Beberapa orang diberi keringanan untuk tidak berpuasa (namun wajib mengganti):</p>
                    <div class="space-y-3 mt-4">
                        <div class="p-3 bg-white border shadow-sm rounded"><strong>1. Orang Sakit:</strong> Yang jika berpuasa sakitnya bertambah parah.</div>
                        <div class="p-3 bg-white border shadow-sm rounded"><strong>2. Musafir:</strong> Orang yang melakukan perjalanan jauh (sekitar 80km+).</div>
                        <div class="p-3 bg-white border shadow-sm rounded"><strong>3. Wanita Hamil & Menyusui:</strong> Jika khawatir akan kesehatan dirinya atau bayinya.</div>
                        <div class="p-3 bg-white border shadow-sm rounded"><strong>4. Orang Tua Renta:</strong> Yang sudah tidak mampu lagi.</div>
                    </div>
                    <img src="https://images.unsplash.com/photo-1436491865332-7a61a109c0f2?w=600" class="rounded-lg shadow my-4 w-full h-40 object-cover" alt="Airplane Safar">
                `,
                teacherNote: "Jelaskan bahwa musafir boleh tetap puasa jika tidak memberatkan, namun mengambil rukhsah adalah cinta Allah kepada hamba-Nya.",
                simulasi: [
                    { q: "Musafir bepergian naik pesawat mewah tanpa lelah, bolehkah buka puasa?", opts: ["Tidak boleh", "Boleh (mengambil rukhsah)", "Wajib buka", "Haram"], ans: 1 },
                    { q: "Sakit flu ringan (batuk sedikit)?", opts: ["Wajib buka", "Tetap wajib puasa", "Boleh buka", "Bayar fidyah saja"], ans: 1 }
                ],
                formatif: [
                    { q: "Rukhsah artinya...", a: ["Hukuman", "Keringanan", "Beban", "Aturan"], c: 1 },
                    { q: "Musafir adalah orang yang...", a: ["Tidur", "Berjalan/Safar", "Bekerja", "Sakit"], c: 1 },
                    { q: "Orang sakit parah wajib ganti dengan...", a: ["Shalat", "Qadha (setelah sembuh)", "Zakat", "Sedekah saja"], c: 1 },
                    { q: "Ibu menyusui yang khawatir bayinya lapar boleh...", a: ["Tidak puasa", "Tetap wajib puasa", "Makan di depan orang", "Pensiun"], c: 0 },
                    { q: "Anak kecil belum baligh?", a: ["Wajib ganti", "Tidak wajib ganti", "Wajib fidyah", "Bebas total"], c: 1 },
                    { q: "Orang tua yang pikun/sangat lemah wajib...", a: ["Qadha", "Fidyah", "Shalat terus", "Tidak ada"], c: 1 },
                    { q: "Safar yang dibolehkan buka adalah...", a: ["Safar maksiat", "Safar mubah/ketaatan", "Ke pasar depan", "Lari pagi"], c: 1 },
                    { q: "Apakah musafir harus qadha?", a: ["Ya", "Tidak", "Mungkin", "Jika kaya"], c: 0 },
                    { q: "Tujuan Rukhsah adalah agar hamba...", a: ["Malas", "Tidak terbebani berat", "Meninggalkan shalat", "Bebas makan"], c: 1 },
                    { q: "Berapa jarak safar minimal menurut jumhur?", a: ["1 km", "10 km", "80-90 km", "500 km"], c: 2 }
                ]
            },
            p7: {
                title: "Pertemuan 7: Qadha dan Fidyah",
                tujuan: ["Mengetahui cara mengganti utang puasa.", "Membedakan siapa yang wajib Qadha dan siapa yang wajib Fidyah."],
                dalil: {
                    arab: "فَمَنْ كَانَ مِنْكُمْ مَرِيضًا أَوْ عَلَى سَفَرٍ فَعِدَّةٌ مِنْ أَيَّامٍ أُخَرَ",
                    indo: "Maka barangsiapa di antara kamu ada yang sakit atau dalam perjalanan (lalu ia berbuka), maka (wajiblah baginya berpuasa) sebanyak hari yang ditinggalkan itu pada hari-hari yang lain. (QS. Al-Baqarah: 184)"
                },
                nilai: "Tanggung Jawab (Mas'uliyah). Setiap utang kepada Allah harus dilunasi.",
                skenario: `
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-bold">Qadha:</h4>
                            <p class="text-xs">Berpuasa di luar bulan Ramadhan sejumlah hari yang ditinggalkan. Wajib bagi: orang sakit (bisa sembuh), musafir, haid/nifas, hamil/menyusui.</p>
                        </div>
                        <div class="p-4 bg-amber-50 rounded-lg">
                            <h4 class="font-bold">Fidyah:</h4>
                            <p class="text-xs">Memberi makan satu orang miskin setiap hari yang ditinggalkan. Wajib bagi: Orang tua renta dan orang sakit yang tidak ada harapan sembuh.</p>
                        </div>
                    </div>
                    <div class="teacher-note">
                        Ukuran Fidyah: Sekitar 1,5 kg makanan pokok (beras) atau memberi makanan siap saji yang mengenyangkan kepada satu orang miskin per satu hari puasa.
                    </div>
                `,
                teacherNote: "Ingatkan santri untuk segera membayar utang puasa sebelum datang Ramadhan tahun berikutnya.",
                simulasi: [
                    { q: "Seorang kakek berusia 90 tahun sangat lemah, apa kewajibannya?", opts: ["Qadha puasa", "Membayar Fidyah", "Shalat malam", "Zakat Mal"], ans: 1 },
                    { q: "Kapan batas akhir Qadha puasa?", opts: ["Bulan Syawal", "Sebelum Ramadhan berikutnya", "Akhir hayat", "Tahun depan"], ans: 1 }
                ],
                formatif: [
                    { q: "Qadha artinya...", a: ["Membayar uang", "Mengganti puasa di hari lain", "Sedekah nasi", "Shalat sunnah"], c: 1 },
                    { q: "Siapa yang wajib Qadha?", a: ["Wanita haid", "Orang gila", "Anak bayi", "Batu"], c: 0 },
                    { q: "Fidyah diberikan kepada...", a: ["Orang kaya", "Orang miskin", "Teman sekolah", "Guru"], c: 1 },
                    { q: "Jumlah fidyah per hari adalah...", a: ["1 kg emas", "Memberi makan 1 orang miskin", "Puasa 2 hari", "Tidak ada"], c: 1 },
                    { q: "Bolehkah Qadha puasa di hari Jumat saja?", a: ["Boleh (jika diniatkan qadha)", "Haram", "Wajib", "Mubah"], c: 0 },
                    { q: "Meninggal dunia punya utang puasa?", a: ["Diabaikan", "Wali boleh membayarkan/puasa untuknya", "Dosa selamanya", "Membayar pajak"], c: 1 },
                    { q: "Hamil tapi kuat puasa?", a: ["Wajib buka", "Tetap wajib puasa", "Boleh buka", "Wajib qadha"], c: 1 },
                    { q: "Menunda qadha sampai Ramadhan berikutnya tanpa udzur?", a: ["Berdosa & wajib qadha+fidyah (menurut sebagian)", "Tidak apa-apa", "Bagus", "Lupa"], c: 0 },
                    { q: "Qadha harus berurutan harinya?", a: ["Ya", "Tidak harus (boleh pisah)", "Wajib", "Mubah"], c: 1 },
                    { q: "Ukuran fidyah nasi/beras sekitar...", a: ["10 kg", "1,5 kg (setengah sha')", "100 gram", "1 ton"], c: 1 }
                ]
            },
            p8: {
                title: "Pertemuan 8: Adab Berhari Raya & Puasa Syawal",
                tujuan: ["Mengakhiri Ramadhan dengan syukur.", "Mengenal sunnah di hari Idul Fitri.", "Memahami keutamaan puasa 6 hari di bulan Syawal."],
                dalil: {
                    arab: "مَنْ صَامَ رَمَضَانَ ثُمَّ أَتْبَعَهُ سِتًّا مِنْ شَوَّالٍ كَانَ كَصِيَامِ الدَّهْرِ",
                    indo: "Barangsiapa berpuasa Ramadhan kemudian diikuti dengan enam hari di bulan Syawal, maka seolah-olah ia berpuasa setahun penuh. (HR. Muslim)"
                },
                nilai: "Istiqamah (Konsisten). Ibadah tidak berakhir dengan berakhirnya Ramadhan.",
                skenario: `
                    <p>Setelah sebulan penuh berjuang, Allah memberikan hadiah berupa Idul Fitri.</p>
                    <h4 class="font-bold mt-4 underline">Adab Idul Fitri:</h4>
                    <ul class="list-disc ml-6 text-sm">
                        <li>Mandi sebelum shalat Id.</li>
                        <li>Memakai pakaian terbaik (tidak harus baru).</li>
                        <li>Makan sebelum berangkat shalat Idul Fitri.</li>
                        <li>Berjalan kaki dan melewati jalan yang berbeda saat pulang.</li>
                        <li>Banyak bertakbir.</li>
                    </ul>
                    <div class="mt-6 p-4 bg-emerald-50 rounded-xl border border-emerald-200">
                        <h4 class="font-bold text-emerald-800 italic">Rumus Pahala Setahun:</h4>
                        <p class="text-sm">Puasa Ramadhan (30 hari) + Puasa Syawal (6 hari) = Pahala 360 hari (Setahun).</p>
                        $$ 30 \text{ hari} \times 10 = 300 \text{ hari} $$
                        $$ 6 \text{ hari} \times 10 = 60 \text{ hari} $$
                        $$ \text{Total} = 360 \text{ hari} $$
                    </div>
                `,
                teacherNote: "Pastikan santri paham bahwa dilarang (Haram) berpuasa pada hari raya Idul Fitri dan Idul Adha.",
                simulasi: [
                    { q: "Berapa hari puasa sunnah di bulan Syawal?", opts: ["1 hari", "3 hari", "6 hari", "10 hari"], ans: 2 },
                    { q: "Apa hukum puasa tepat di hari Idul Fitri?", opts: ["Sunnah", "Wajib", "Haram", "Makruh"], ans: 2 }
                ],
                formatif: [
                    { q: "Puasa setahun penuh didapat dengan puasa Ramadhan + ...", a: ["3 hari Syawal", "6 hari Syawal", "Senin Kamis", "Arafah"], c: 1 },
                    { q: "Mandi sebelum shalat Id hukumnya...", a: ["Wajib", "Sunnah", "Mubah", "Haram"], c: 1 },
                    { q: "Makan sebelum shalat Idul Fitri?", a: ["Disunnahkan", "Dilarang", "Bebas", "Wajib"], c: 0 },
                    { q: "Hari raya Islam ada berapa?", a: ["1", "2 (Idul Fitri & Adha)", "3", "4"], c: 1 },
                    { q: "Pakaian Id sebaiknya...", a: ["Paling mahal", "Terbaik/Bersih", "Warna merah", "Robek"], c: 1 },
                    { q: "Pulang pergi shalat Id lewat jalan yang...", a: ["Sama", "Berbeda", "Sangat jauh", "Gelap"], c: 1 },
                    { q: "Takbir Idul Fitri dimulai sejak...", a: ["Malam hari saat terlihat hilal syawal", "Shubuh", "Tengah malam", "Selesai shalat"], c: 0 },
                    { q: "Ucapan selamat yang disukai salaf?", a: ["Happy Holiday", "Taqabbalallahu minna wa minkum", "Maaf ya", "HBD"], c: 1 },
                    { q: "Puasa syawal harus berurutan 6 hari?", a: ["Ya, wajib", "Tidak, boleh terpisah yang penting di bulan Syawal", "Hanya senin kamis", "Bebas"], c: 1 },
                    { q: "Hukum puasa Idul Adha?", a: ["Sunnah", "Mubah", "Haram", "Wajib"], c: 2 }
                ]
            }
        };

        const sumatifQuestions = [
            { q: "Tujuan puasa Ramadhan adalah mencetak hamba yang...", a: ["Kurus", "Kaya", "Bertakwa", "Terkenal"], c: 2 },
            { q: "Apa rukun puasa yang paling dasar?", a: ["Makan banyak", "Niat & Menahan diri (Imsak)", "Olahraga", "Tidur siang"], c: 1 },
            { q: "Niat puasa Ramadhan harus dilakukan pada...", a: ["Malam hari sebelum fajar", "Siang hari", "Setelah berbuka", "Kapan saja"], c: 0 },
            { q: "Muntah dengan sengaja membatalkan puasa?", a: ["Ya", "Tidak", "Mungkin", "Tergantung makanan"], c: 0 },
            { q: "Seseorang yang safar (perjalanan jauh) boleh tidak puasa?", a: ["Tidak boleh", "Boleh (Rukhsah)", "Wajib haram", "Dosa"], c: 1 },
            { q: "Apa konsekuensi bagi wanita haid yang tidak puasa?", a: ["Bayar fidyah", "Qadha (ganti hari)", "Zakat Mal", "Tidak ada"], c: 1 },
            { q: "Memberi makan orang miskin sebagai pengganti puasa disebut...", a: ["Zakat", "Qadha", "Fidyah", "Infaq"], c: 2 },
            { q: "Hukum puasa di hari raya Idul Fitri adalah...", a: ["Sunnah", "Haram", "Wajib", "Boleh"], c: 1 },
            { q: "Puasa Ramadhan diikuti 6 hari Syawal pahalanya seperti...", a: ["Sebulan", "Setahun", "Seumur hidup", "Satu hari"], c: 1 },
            { q: "Definisi puasa secara bahasa adalah Al-Imsak, yang artinya...", a: ["Lari", "Makan", "Menahan diri", "Bicara"], c: 2 }
        ];

        function switchTab(id) {
            const btns = document.querySelectorAll('.nav-btn');
            btns.forEach(b => b.classList.remove('nav-active'));
            const activeBtn = document.getElementById('btn-' + id);
            if(activeBtn) activeBtn.classList.add('nav-active');

            const container = document.getElementById('main-container');
            container.innerHTML = '';

            if(id === 'sumatif') {
                renderSumatif();
            } else {
                renderPertemuan(id);
            }
            window.scrollTo(0,0);
            if (typeof MathJax !== 'undefined') MathJax.typeset();
        }

        function renderPertemuan(id) {
            const p = dataModul[id];
            const html = `
                <div class="tab-content active space-y-12">
                    <div class="bg-white rounded-[2rem] p-10 shadow-2xl border-t-[12px] border-blue-900 glass-card">
                        <h1 class="text-4xl font-extrabold text-blue-950 mb-8 border-b-2 border-slate-100 pb-4">${p.title}</h1>
                        
                        <div class="space-y-12">
                            <section>
                                <h2 class="text-2xl font-black text-slate-800 mb-6 flex items-center">
                                    <span class="w-10 h-10 bg-blue-100 text-blue-800 rounded-2xl flex items-center justify-center mr-4 shadow-inner">A</span>
                                    Tujuan Pembelajaran
                                </h2>
                                <div class="grid md:grid-cols-2 gap-4">
                                    ${p.tujuan.map(t => `<div class="p-4 bg-slate-50 rounded-2xl border-l-4 border-blue-600 shadow-sm text-sm font-medium">✨ ${t}</div>`).join('')}
                                </div>
                            </section>

                            <section class="bg-gradient-to-br from-blue-900 to-blue-800 text-white p-10 rounded-[2.5rem] shadow-xl relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-4 opacity-10">
                                    <svg width="100" height="100" fill="currentColor" viewBox="0 0 24 24"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
                                </div>
                                <h2 class="text-2xl font-black text-amber-400 mb-6">B. Keterkaitan Nilai Islam</h2>
                                <p class="arabic text-center mb-6 leading-relaxed bg-blue-950/40 p-6 rounded-2xl border border-blue-700/50">${p.dalil.arab}</p>
                                <p class="text-sm italic text-center opacity-90 mb-8 border-b border-blue-700 pb-6">"${p.dalil.indo}"</p>
                                <p class="text-md leading-relaxed font-light">${p.nilai}</p>
                            </section>

                            <section>
                                <h2 class="text-2xl font-black text-slate-800 mb-6 flex items-center">
                                    <span class="w-10 h-10 bg-blue-100 text-blue-800 rounded-2xl flex items-center justify-center mr-4 shadow-inner">C</span>
                                    Skenario Pembelajaran (Materi)
                                </h2>
                                <div class="bg-white border-2 border-slate-100 p-8 rounded-[2rem] shadow-sm leading-loose text-slate-700">
                                    ${p.skenario}
                                </div>
                                <div class="teacher-note">
                                    <span class="inline-block px-3 py-1 bg-amber-200 text-amber-800 text-[10px] font-black rounded-full mb-3 uppercase tracking-widest">Poin Diskusi Guru</span>
                                    <p class="text-sm italic text-slate-600 leading-relaxed">${p.teacherNote}</p>
                                </div>
                            </section>
                            
                            ${p.penilaian || ''}
                        </div>
                    </div>

                    <!-- Simulations -->
                    <div class="grid md:grid-cols-2 gap-8">
                        ${p.simulasi.map((sim, i) => `
                            <div class="bg-white p-8 rounded-[2rem] shadow-xl border-b-8 border-emerald-500">
                                <div class="mb-4 flex justify-between items-center">
                                    <span class="bg-emerald-100 text-emerald-700 px-4 py-1 rounded-full text-xs font-bold uppercase">Simulasi ${i+1}</span>
                                </div>
                                <h3 class="font-black text-slate-800 mb-6 text-lg">${sim.q}</h3>
                                <div class="space-y-3">
                                    ${sim.opts.map((o, j) => `
                                        <button onclick="handleSim(this, ${j}, ${sim.ans})" class="w-full text-left p-4 border-2 border-slate-100 rounded-2xl font-semibold hover:border-emerald-500 hover:bg-emerald-50 transition-all text-sm btn-option">
                                            ${o}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Formative Quiz -->
                    <div class="bg-white rounded-[2rem] p-10 shadow-2xl">
                        <div class="flex items-center justify-between mb-10 border-b pb-6">
                            <h2 class="text-3xl font-black text-slate-800">Latihan Formatif</h2>
                            <span class="bg-blue-100 text-blue-700 px-6 py-2 rounded-full font-black text-sm uppercase tracking-widest">10 Soal Wajib</span>
                        </div>
                        <div class="space-y-10">
                            ${p.formatif.map((q, i) => `
                                <div class="p-8 bg-slate-50 rounded-[2rem] border border-slate-200 hover:border-blue-300 transition-colors">
                                    <p class="font-extrabold mb-6 text-slate-800 text-lg flex items-start">
                                        <span class="bg-blue-600 text-white w-8 h-8 rounded-lg flex-shrink-0 flex items-center justify-center mr-4 text-sm">${i+1}</span>
                                        ${q.q}
                                    </p>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        ${q.a.map((opt, j) => `
                                            <button onclick="checkFormatif(this, ${j}, ${q.c}, '${id}', ${i})" class="btn-f-${id}-${i} text-left p-4 bg-white border-2 border-slate-100 rounded-2xl font-bold hover:border-blue-500 transition-all text-sm shadow-sm">
                                                ${opt}
                                            </button>
                                        `).join('')}
                                    </div>
                                    <div id="f-msg-${id}-${i}" class="hidden mt-6 p-4 rounded-2xl text-sm font-bold animate-bounce"></div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('main-container').innerHTML = html;
        }

        function handleSim(btn, chosen, correct) {
            const container = btn.parentElement;
            const btns = container.querySelectorAll('button');
            btns.forEach(b => b.disabled = true);
            if(chosen === correct) {
                btn.classList.replace('border-slate-100', 'border-emerald-500');
                btn.classList.add('bg-emerald-500', 'text-white');
            } else {
                btn.classList.replace('border-slate-100', 'border-red-500');
                btn.classList.add('bg-red-500', 'text-white');
                btns[correct].classList.add('bg-emerald-100', 'border-emerald-500', 'text-emerald-700');
            }
        }

        function checkFormatif(btn, chosen, correct, pid, qid) {
            const btns = document.querySelectorAll(`.btn-f-${pid}-${qid}`);
            btns.forEach(b => b.disabled = true);
            const msg = document.getElementById(`f-msg-${pid}-${qid}`);
            msg.classList.remove('hidden');
            if(chosen === correct) {
                btn.classList.add('bg-emerald-600', 'text-white', 'border-emerald-600');
                msg.classList.add('bg-emerald-100', 'text-emerald-700');
                msg.innerText = "Maa Syaa Allah! Jawaban Anda TEPAT.";
            } else {
                btn.classList.add('bg-red-600', 'text-white', 'border-red-600');
                msg.classList.add('bg-red-100', 'text-red-700');
                msg.innerText = "Kurang Tepat. Jawaban yang benar adalah pilihan ke-" + (correct + 1);
                btns[correct].classList.add('ring-4', 'ring-emerald-200', 'border-emerald-500');
            }
        }

        function renderSumatif() {
            const html = `
                <div class="bg-white rounded-[2.5rem] p-12 shadow-2xl border-t-[15px] border-amber-500">
                    <div class="text-center mb-12">
                        <h1 class="text-5xl font-black text-slate-800 mb-4">Tes Sumatif Akhir</h1>
                        <p class="text-slate-500 font-medium">Evaluasi menyeluruh pemahaman Fiqih Puasa (FIQ-104)</p>
                    </div>
                    <div id="sum-list" class="space-y-10">
                        ${sumatifQuestions.map((q, i) => `
                            <div class="q-card p-8 bg-slate-50 rounded-[2rem] border-2 border-transparent transition-all" data-correct="${q.c}">
                                <p class="font-black text-xl mb-8 text-slate-800">${i+1}. ${q.q}</p>
                                <div class="grid md:grid-cols-2 gap-4">
                                    ${q.a.map((opt, j) => `
                                        <button onclick="selectSumatif(this, ${i}, ${j})" class="btn-s-${i} text-left p-5 bg-white border-2 border-slate-200 rounded-2xl font-bold hover:border-amber-500 transition-all text-md shadow-sm">
                                            ${opt}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div id="result-box" class="hidden mt-16 p-12 bg-blue-900 text-white rounded-[3rem] text-center shadow-inner relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-2 bg-amber-400"></div>
                        <h3 class="text-2xl font-bold mb-4">SKOR AKHIR ANDA:</h3>
                        <div id="final-score" class="text-9xl font-black text-amber-400 mb-6">0</div>
                        <p id="final-msg" class="text-xl font-medium mb-8"></p>
                        <button onclick="location.reload()" class="px-10 py-4 bg-white text-blue-900 rounded-2xl font-black uppercase tracking-widest hover:bg-slate-100 transition-colors">Ulangi Tes</button>
                    </div>

                    <div class="mt-16 text-center" id="submit-area">
                        <button onclick="gradeSumatif()" class="px-16 py-6 bg-amber-500 text-blue-950 rounded-[2rem] font-black text-2xl hover:bg-amber-400 transition-all shadow-xl hover:-translate-y-1">Kumpulkan Jawaban</button>
                    </div>
                </div>
            `;
            document.getElementById('main-container').innerHTML = html;
        }

        function selectSumatif(btn, qid, oid) {
            const btns = document.querySelectorAll(`.btn-s-${qid}`);
            btns.forEach(b => b.classList.remove('border-amber-500', 'bg-amber-50', 'ring-4', 'ring-amber-200'));
            btn.classList.add('border-amber-500', 'bg-amber-50', 'ring-4', 'ring-amber-200');
            btn.closest('.q-card').dataset.chosen = oid;
        }

        function gradeSumatif() {
            const cards = document.querySelectorAll('.q-card');
            let score = 0;
            let answered = 0;
            cards.forEach(c => {
                if(c.dataset.chosen !== undefined) {
                    answered++;
                    if(parseInt(c.dataset.chosen) === parseInt(c.dataset.correct)) score++;
                }
            });

            if(answered < sumatifQuestions.length) {
                return alert("Ups! Ada " + (sumatifQuestions.length - answered) + " soal yang belum dijawab. Mohon selesaikan dahulu.");
            }

            const total = Math.round((score/sumatifQuestions.length)*100);
            document.getElementById('final-score').innerText = total;
            document.getElementById('final-msg').innerText = total >= 70 ? "Baarakallahu Fiik! Anda telah menguasai materi dengan sangat baik." : "Jangan berkecil hati. Pelajari kembali poin-poin yang masih bingung.";
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('submit-area').classList.add('hidden');
            window.scrollTo({ top: document.getElementById('result-box').offsetTop - 100, behavior: 'smooth' });
        }

        // Initialize P1 on Load
        window.onload = () => switchTab('p1');
    </script>
</body>
</html>