<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roster KBM Interaktif - RTQ Markaz Qur'an Al-Maa'un</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
        }

        /* --- Layout & Sticky Elements --- */
        .schedule-grid {
            display: grid;
            grid-template-columns: 90px repeat(6, 1fr);
            gap: 4px;
        }
        .time-slot {
            font-weight: 600;
            text-align: center;
            padding: 8px 4px;
            position: sticky;
            left: 0;
            z-index: 15;
            background-color: #f1f5f9;
        }
        .day-header {
            font-weight: 600;
            text-align: center;
            padding: 8px 4px;
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #f1f5f9;
        }
        .schedule-grid > .day-header:first-child {
            left: 0;
            z-index: 20;
        }
        .schedule-cell {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px;
            min-height: 120px;
            transition: all 0.3s ease-in-out;
            background-color: white;
            display: flex;
            flex-direction: column;
        }
        .subject {
            flex-grow: 1;
        }

        /* --- Sidebar & Overlay --- */
        #filter-sidebar.show {
            transform: translateX(0);
        }

        /* --- Highlighting & Effects --- */
        .highlight {
            background-color: #f0fdfa; /* teal-50 */
            border-color: #14b8a6; /* teal-500 */
            transform: scale(1.03);
            z-index: 10;
            position: relative;
            animation: glow-animation 2s ease-in-out infinite;
        }
        .dimmed {
            opacity: 0.3;
            filter: grayscale(80%);
        }
        @keyframes glow-animation {
            0% { box-shadow: 0 0 5px rgba(20, 184, 166, 0.5); }
            50% { box-shadow: 0 0 20px 5px rgba(20, 184, 166, 0.8); }
            100% { box-shadow: 0 0 5px rgba(20, 184, 166, 0.5); }
        }

        /* --- Room Specific Styles --- */
        .room-rbm {
            background-color: #fff7ed; /* orange-50 */
            border-color: #fb923c;   /* orange-400 */
            border-style: dashed;
        }
        .room-rbm .subject {
            font-style: italic;
            color: #c2410c; /* orange-700 */
        }
        .room-madinah {
            background-color: rgba(59, 130, 246, 0.1);
            border-color: #60a5fa; /* blue-400 */
        }
        .room-mekah {
            background-color: rgba(132, 204, 22, 0.1);
            border-color: #a3e635; /* lime-400 */
        }

        /* --- Accordion Arrow --- */
        .arrow-icon {
            transition: transform 0.3s ease-in-out;
        }
        .arrow-icon.rotate-90 {
            transform: rotate(90deg);
        }
        
        /* --- Tab Styles --- */
        .tab-btn {
            transition: all 0.2s ease-in-out;
        }
        .tab-btn.active {
            background-color: #0d9488; /* teal-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        /* --- Form & Buttons --- */
        .filter-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }
        #floating-action-buttons {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        #floating-action-buttons button {
            position: relative;
            display: flex;
            align-items: center;
        }
        .fab-label {
            position: absolute;
            right: 100%;
            margin-right: 16px;
            background-color: #1f2937;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            transform: translateX(10px);
            pointer-events: none;
            transition: all 0.2s ease-in-out;
        }
        #floating-action-buttons button:hover .fab-label {
            opacity: 1;
            transform: translateX(0);
        }

        /* --- Print Styles --- */
        @media print {
            body, #krs-container > div:not(#krs-display), #floating-action-buttons, header, #tabs-container, #teacher-data-container, #module-data-container, #santri-data-container, #schedule-container, #filter-sidebar, #open-filter-btn {
                display: none !important;
            }
            #krs-display {
                display: block !important;
                box-shadow: none;
                border: none;
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="page-wrapper" class="relative min-h-screen lg:flex">

        <aside id="filter-sidebar" class="bg-white lg:bg-transparent w-72 lg:w-80 p-4 border-r border-slate-200 fixed lg:sticky top-0 h-full lg:h-screen overflow-y-auto z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-teal-800">Filter Jadwal</h3>
                <button id="close-filter-btn" class="lg:hidden text-slate-500 hover:text-slate-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="filter-group" class="block text-sm font-medium text-slate-700">Kelompok</label>
                    <select id="filter-group" class="filter-select mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                        <option value="all">Semua Kelompok</option>
                        <option value="KF">Kelas Fondasi</option>
                        <option value="KG">Kelas Gabungan</option>
                    </select>
                </div>
                <div>
                    <label for="filter-cluster" class="block text-sm font-medium text-slate-700">Klaster</label>
                    <select id="filter-cluster" class="filter-select mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md" disabled>
                        <option value="all">Semua Klaster</option>
                        <option value="LKS">Literasi & Kreatif Syariah</option>
                        <option value="STT">Sains & Teknologi Terapan</option>
                    </select>
                </div>
                <div>
                    <label for="filter-teacher" class="block text-sm font-medium text-slate-700">Guru</label>
                    <select id="filter-teacher" class="filter-select mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                        <option value="all">Semua Guru</option>
                    </select>
                </div>
                <div>
                    <label for="filter-room" class="block text-sm font-medium text-slate-700">Ruang</label>
                    <select id="filter-room" class="filter-select mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                        <option value="all">Semua Ruang</option>
                        <option value="Kelas Mekah">Kelas Mekah</option>
                        <option value="Kelas Madinah">Kelas Madinah</option>
                        <option value="RBM">RBM</option>
                    </select>
                </div>
                <div>
                    <button id="reset-filters" class="w-full bg-teal-600 text-white py-2 px-4 rounded-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition">
                        Reset Filter
                    </button>
                </div>
            </div>
        </aside>

        <div id="filter-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden lg:hidden"></div>

        <main id="main-content" class="flex-1 p-4 md:p-6">
            <header class="text-center mb-6">
                 <div class="lg:hidden mb-4">
                    <button id="open-filter-btn" class="w-full flex items-center justify-center gap-2 bg-white p-3 rounded-lg shadow font-semibold text-teal-700">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
                        </svg>
                        Buka Filter
                    </button>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold text-teal-800">Roster KBM Dinamis</h1>
                <h2 class="text-xl md:text-2xl font-semibold text-teal-700">Markaz Qur'an Al-Maa'un</h2>
                <p class="text-slate-600 mt-2">Semester Ganjil</p>
            </header>

            <div id="tabs-container" class="mb-4 bg-slate-200 p-1 rounded-lg flex space-x-1">
                <button id="tab-bulan1" class="tab-btn flex-1 p-2 rounded-md font-semibold active">Bulan I</button>
                <button id="tab-bulan2" class="tab-btn flex-1 p-2 rounded-md font-semibold">Bulan II</button>
                <button id="tab-bulan3" class="tab-btn flex-1 p-2 rounded-md font-semibold">Bulan III</button>
                <button id="tab-bulan4" class="tab-btn flex-1 p-2 rounded-md font-semibold">Bulan IV</button>
            </div>

            <div id="schedule-container" class="bg-white p-2 rounded-xl shadow-lg overflow-auto max-h-[80vh]">
            </div>
            
            <div id="teacher-data-container" class="mt-8 bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-teal-800">Data Guru</h3>
                </div>
                <div class="overflow-x-auto">
                    <table id="teacher-table" class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-100">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-16">No</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Nama Guru</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Bidang / Jurusan</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Hari</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Jadwal (Slot Waktu)</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-slate-200">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="module-data-container" class="mt-8 bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-teal-800">Perpustakaan Modul</h3>
                </div>
                <div class="overflow-x-auto">
                    <table id="module-table" class="min-w-full">
                         <thead class="bg-slate-100">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider" colspan="7">Guru & Modul</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- STUDENT TABLE START -->
            <div id="santri-data-container" class="mt-8 bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-teal-800">Data Santri</h3>
                </div>
                <div class="overflow-x-auto">
                    <table id="santri-table" class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-100">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">No</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Nama Santri</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Jenis Kelamin</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Kelompok</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Kelas</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Jurusan</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Aksi</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-slate-200">
                            <tr data-santri-name="Ahmad Royyan" data-santri-group="KG LKS" data-santri-kelas="XII" data-santri-jurusan="Bisnis & Manajemen">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">1</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Ahmad Royyan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Laki-Laki</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG LKS</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">XII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Bisnis & Manajemen</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                             <tr data-santri-name="M. Alvin Ramadhan Lubis" data-santri-group="KF" data-santri-kelas="X" data-santri-jurusan="Non Jurusan">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">2</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">M. Alvin Ramadhan Lubis</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Laki-Laki</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KF</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">X</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Non Jurusan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Abdullah Ridho Selamet" data-santri-group="KG LKS" data-santri-kelas="X" data-santri-jurusan="Bisnis & Manajemen">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">3</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Abdullah Ridho Selamet</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Laki-Laki</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG LKS</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">X</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Bisnis & Manajemen</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Rizki Fadilah" data-santri-group="KF" data-santri-kelas="VIII" data-santri-jurusan="Non Jurusan">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">4</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Rizki Fadilah</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Laki-Laki</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KF</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">VIII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Non Jurusan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Annisa Akbar Siregar" data-santri-group="KG STT" data-santri-kelas="XII" data-santri-jurusan="Agribisnis (Pertanian & Peternakan)">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">5</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Annisa Akbar Siregar</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG STT</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">XII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Agribisnis (Pertanian & Peternakan)</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                             <tr data-santri-name="Intan Akbar Siregar" data-santri-group="KG STT" data-santri-kelas="IX" data-santri-jurusan="Sains & Teknologi">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">6</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Intan Akbar Siregar</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG STT</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">IX</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Sains & Teknologi</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Aprilia Alvina Rikay" data-santri-group="KG LKS" data-santri-kelas="X" data-santri-jurusan="Pendidikan Agama Islam">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">7</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Aprilia Alvina Rikay</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG LKS</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">X</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Pendidikan Agama Islam</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Aprilia Alvani Rikay" data-santri-group="KG LKS" data-santri-kelas="X" data-santri-jurusan="Pendidikan Agama Islam">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">8</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Aprilia Alvani Rikay</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG LKS</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">X</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Pendidikan Agama Islam</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Rahmah Azizah Lubis" data-santri-group="KG LKS" data-santri-kelas="XI" data-santri-jurusan="Tahfidz & Bahasa Arab">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">9</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Rahmah Azizah Lubis</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG LKS</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">XI</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Tahfidz & Bahasa Arab</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Aisyah Az-Zahra" data-santri-group="KG LKS" data-santri-kelas="VIII" data-santri-jurusan="Tahfidz & Bahasa Arab">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">10</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Aisyah Az-Zahra</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG LKS</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">VIII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Tahfidz & Bahasa Arab</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Nur Halimah" data-santri-group="KG LKS" data-santri-kelas="VIII" data-santri-jurusan="Tahfidz & Bahasa Arab">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">11</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Nur Halimah</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG LKS</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">VIII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Tahfidz & Bahasa Arab</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Nur Alfia Fauzana" data-santri-group="KG LKS" data-santri-kelas="VIII" data-santri-jurusan="Pendidikan Agama Islam">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">12</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Nur Alfia Fauzana</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KG LKS</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">VIII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Pendidikan Agama Islam</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Putri Maharani Br. Tarigan" data-santri-group="KF" data-santri-kelas="VIII" data-santri-jurusan="Non Jurusan">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">13</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Putri Maharani Br. Tarigan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KF</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">VIII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Non Jurusan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                             <tr data-santri-name="Dedek Suci Ramadhani" data-santri-group="KF" data-santri-kelas="VII" data-santri-jurusan="Non Jurusan">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">14</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Dedek Suci Ramadhani</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KF</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">VII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Non Jurusan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                            <tr data-santri-name="Aisyah Nur Fadillah" data-santri-group="KF" data-santri-kelas="VII" data-santri-jurusan="Non Jurusan">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">15</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">Aisyah Nur Fadillah</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Perempuan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">KF</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">VII</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">Non Jurusan</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="krs-btn text-indigo-600 hover:text-indigo-900">Lihat KRS</button>
                                    <button class="text-green-600 hover:text-green-900">Lihat KHS</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- STUDENT TABLE END -->

            <!-- KRS CONTAINER START -->
            <div id="krs-container" class="mt-8 mb-8 p-4 sm:p-6 rounded-xl shadow-lg bg-gray-50 hidden">
                <div id="krs-display" class="mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8" style="width: 210mm;">
                    <!-- Header -->
                    <header class="text-center border-b-2 border-gray-200 pb-4 mb-6">
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">KARTU RENCANA STUDI (KRS)</h1>
                        <h2 class="text-lg md:text-xl font-semibold text-gray-700 mt-1">Markaz Qur'an Al-Maa'un</h2>
                        <p class="text-md text-gray-600">Semester Ganjil</p>
                    </header>
            
                    <!-- Informasi Santri -->
                    <section id="info-santri" class="mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2 text-sm text-gray-700">
                            <div class="flex">
                                <span class="w-36 font-semibold">Nama Santri</span>
                                <span id="nama-santri">: </span>
                            </div>
                            <div class="flex">
                                <span class="w-48 font-semibold">Total SKS yang bisa diambil</span>
                                <span id="total-sks-ambil">: 40 sks</span>
                            </div>
                            <div class="flex">
                                <span class="w-36 font-semibold">Jurusan</span>
                                <span id="jurusan">: </span>
                            </div>
                            <div class="flex">
                                <span class="w-48 font-semibold">Kelas</span>
                                <span id="kelas">: </span>
                            </div>
                            <div class="flex">
                                <span class="w-36 font-semibold">Kelompok</span>
                                <span id="kelompok">: </span>
                            </div>
                            <div class="flex">
                                <span class="w-48 font-semibold">Materi untuk Bulan ke</span>
                                <span id="materi-bulan">: </span>
                            </div>
                        </div>
                    </section>
            
                    <!-- Tabel Rencana Studi -->
                    <section>
                        <div class="overflow-x-auto">
                            <table id="tabel-krs" class="w-full text-sm text-left text-gray-600">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                    <tr>
                                        <th scope="col" class="px-4 py-3">Hari</th>
                                        <th scope="col" class="px-4 py-3">Waktu</th>
                                        <th scope="col" class="px-4 py-3">Kode</th>
                                        <th scope="col" class="px-4 py-3">Mata Pelajaran / Modul</th>
                                        <th scope="col" class="px-4 py-3">Ruang</th>
                                        <th scope="col" class="px-4 py-3 text-center">SKS</th>
                                        <th scope="col" class="px-4 py-3">Guru</th>
                                        <th scope="col" class="px-4 py-3">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="krs-table-body">
                                    <!-- Data will be populated here -->
                                </tbody>
                                <tfoot>
                                    <tr class="font-semibold text-gray-900 bg-gray-100">
                                        <td colspan="5" class="px-4 py-3 text-right">Total SKS yang Diambil</td>
                                        <td id="total-sks-diambil" class="px-4 py-3 text-center">0</td>
                                        <td colspan="2" class="px-4 py-3"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </section>
                </div>

                <!-- Tombol Aksi Section -->
                <div class="mt-8 text-center flex justify-center items-center gap-4">
                     <button id="add-krs-row" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-opacity-50">
                        + Tambah Baris
                    </button>
                     <button id="download-krs-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 inline-flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        <span>Unduh PDF</span>
                    </button>
                    <button id="close-krs-btn-bottom" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50">Tutup</button>
                </div>
            </div>
            <!-- KRS CONTAINER END -->
        </main>

        <div id="floating-action-buttons">
            <button id="reset-schedule" title="Reset Jadwal ke Awal" class="bg-red-600 text-white rounded-full p-3 shadow-lg hover:bg-red-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" /></svg>
                <span class="fab-label">Reset Jadwal</span>
            </button>
            <button id="print-schedule" title="Cetak Jadwal" class="bg-blue-600 text-white rounded-full p-3 shadow-lg hover:bg-blue-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v3a2 2 0 002 2h6a2 2 0 002-2v-3h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" /></svg>
                <span class="fab-label">Cetak</span>
            </button>
            <button id="download-jpg" title="Unduh sebagai JPG" class="bg-green-600 text-white rounded-full p-3 shadow-lg hover:bg-green-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                <span class="fab-label">Unduh Jadwal</span>
            </button>
        </div>

        <div id="confirmation-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3 text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100">
                        <svg class="h-6 w-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    </div>
                    <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2" id="modal-title">Konfirmasi</h3>
                    <div class="mt-2 px-7 py-3">
                        <p class="text-sm text-gray-500" id="modal-message">Apakah Anda yakin?</p>
                    </div>
                    <div class="items-center px-4 py-3">
                        <button id="modal-confirm-btn" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                            Ya, Lanjutkan
                        </button>
                        <button id="modal-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md w-auto ml-2 shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300">
                            Batal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- DATA ---
        const scheduleDataBulan1 = [
            // Senin
            { day: "Senin", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "MAT-101: Operasi Bilangan Bulat & KPK/FPB", teacher: "Sulistiawan, S.Kom", downloadLink: "https://url-penyimpanan-anda.com/modul/MAT-101.pdf" },
            { day: "Senin", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "MAT-101: Operasi Bilangan Bulat & KPK/FPB", teacher: "Sulistiawan, S.Kom", downloadLink: "https://url-penyimpanan-anda.com/modul/MAT-101.pdf" },
            { day: "Senin", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "IND-101: Menyimak Efektif: Adab & Teknik", teacher: "Mia A. Lubis, S.Kom", downloadLink: "https://drive.google.com/file/d/1PAGwVSmVj3_JFW6mekxZGK7xZh54XlDH/view?usp=drive_link" },
            { day: "Senin", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "STT", subject: "THI-201: Pengantar Thibbun Nabawi", teacher: "Sulistiawan, S.Kom", downloadLink: "https://drive.google.com/file/d/1ZjmZkzVknCL8sNPz4nWwaARTN62AN1qG/view" },
            { day: "Senin", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "ENG-101: Greetings & Introductions", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "https://drive.google.com/file/d/1LYRMv43xr0ei9aHJ4Rm8VVGEZv2LMoJT/view?usp=drive_link" },
            { day: "Senin", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "KWU-201: Riset Pasar & Analisis Kompetitor", teacher: "Sulistiawan, S.Kom", downloadLink: "https://drive.google.com/file/d/1ibVSjYmLhxxAhmAm_EGJ-qowFDPy3aZ_/view?usp=drive_link" },
            // Selasa
            { day: "Selasa", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "ARB-101: ABY Jilid 1A Unit 1-2 (Perkenalan & Keluarga)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "https://drive.google.com/file/d/1KNuZMEsYPEznGzEcyhTR5GDb5J3gUwM5/view?usp=drive_link" },
            { day: "Selasa", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "PANC-201: Implementasi nilai-nilai Pancasila Dalam Kehidupan", teacher: "Sulistiawan, S.Kom", downloadLink: "https://drive.google.com/file/d/1V0ZYiN9sYr5ZYXR3yfk5p80uLFNlbv9g/view?usp=drive_link" },
            { day: "Selasa", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "ARB-201: ABY Jilid 1B Unit 7-8 (Pendidikan & Pekerjaan)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "https://drive.google.com/file/d/19dfcrahHUBSjFQx0bNvcGDxm2gJw35Tt/view?usp=drive_link" },
            { day: "Selasa", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "KTR-101: Pertolongan Pertama Pada Kecelakaan (P3K)", teacher: "Sulistiawan, S.Kom", downloadLink: "https://drive.google.com/file/d/1X7OG1Z2rdwVPn4B8VqZM--wV7zDddOFw/view?usp=drive_link" },
            { day: "Selasa", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "TAU-101: Makna & Konsekuensi 2 Kalimat Syahadat", teacher: "Erwan Syahputra, S.Pd", downloadLink: "https://drive.google.com/file/d/11yClAXt_5YcDrzyZ9-Ee4fJOSIwGQWcK/view?usp=drive_link" },
            { day: "Selasa", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "IPA-201: Gerak Lurus dan Gaya", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "https://drive.google.com/file/d/170mKM_vLYEeO0tIUOP063-k1wMW1a1jD/view?usp=drive_link" },
            // Rabu
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "LKS", subject: "ULH-201: Pengantar Ilmu Hadits (Definisi & Sejarah)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "https://drive.google.com/file/d/1b839aBuE0qPkPX5TISgiloV3qGljV2EF/view?usp=drive_link" },
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "KWU-101: Pengantar Mindset Wirausaha Muslim", teacher: "Sulistiawan, S.Kom", downloadLink: "https://drive.google.com/file/d/1OY6JWCfKPjxgKECTDUoWadrY_eoMMdCj/view?usp=drive_link" },
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "RBM", group: "KG", cluster: "STT", subject: "TME-201: Pengenalan Alat-Alat Servis", teacher: "Aria Atmaja", downloadLink: "https://drive.google.com/file/d/1tgiZzRH8P-WWtoNdtRWkJW8qGDBcrU8b/view?usp=drive_link" },
            { day: "Rabu", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "IPS-101: Aku & Lingkungan Sekitarku", teacher: "Mia A. Lubis, S.Kom", downloadLink: "https://drive.google.com/file/d/1FlPhTpeWb9ARmQRa8g-dV74_tabkmwFI/view?usp=drive_link" },
            { day: "Rabu", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "PAI-201: Public Speaking 1: Struktur Pidato & Mengatasi Gugup", teacher: "SupraSojo, S.Pd.I., M.Pd.", downloadLink: "https://drive.google.com/file/d/1HlMC_lIGb7L9rDr2MocXm3VCMP6uqyeg/view?usp=drive_link" },
            { day: "Rabu", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "ENG-201: Hobbies & Free Time", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "https://drive.google.com/file/d/15-9a1S4ogBTjKjG6i2_268-tLqrquC4P/view?usp=drive_link" },
            { day: "Rabu", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "HAD-101: Hadits Arba'in 1 (Hafalan & Makna Hadits #1-5)", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "https://drive.google.com/file/d/1pND30uoMlg5Dqyzm5C4_Yl27_H5LXHh9/view?usp=drive_link" },
            // Kamis
            { day: "Kamis", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "TIK-101: Pengenalan Perangkat Keras & Lunak Komputer", teacher: "Sulistiawan, S.Kom", downloadLink: "https://drive.google.com/file/d/1JTJjRA_rWZ-62_W82aBKL23b2K0244bL/view?usp=drive_link" },
            { day: "Kamis", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "TAU-201: Studi Kitab Tauhid 1", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "https://drive.google.com/file/d/1WoluRi1U0edST8BBaqPkLNiEIZLCPwvt/view?usp=drive_link" },
            { day: "Kamis", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "STT", subject: "TIK-201: Pengolah Kata (Word) Lanjutan", teacher: "Mia A. Lubis, S.Kom", downloadLink: "https://drive.google.com/file/d/1KzWoTzH_VqgVjd-0Sc3z9Xmwz7Z19TSX/view?usp=drive_link" },
            { day: "Kamis", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "IPS-201: Masuk dan Berkembangnya Islam di Nusantara", teacher: "Sulistiawan, S.Kom", downloadLink: "https://drive.google.com/file/d/1X0S3XBjJEdEkKCGAUjcDze8Kfh2MWjuG/view?usp=drive_link" },
            { day: "Kamis", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "IPA-101: Ciri Makhluk Hidup & Klasifikasi Sederhana", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "https://drive.google.com/file/d/1x-u8VWwCD2KJW16-wG0z_ZBrmbAb4Lpf/view?usp=drive_link" },
            { day: "Kamis", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "ULQ-201: Sejarah Penulisan & Pengumpulan Al-Qur'an", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "https://drive.google.com/file/d/1b_WMo_1KKAWPXKzilPSKsFzNzUmdW4V8/view?usp=drive_link" },
            // Jumat
            { day: "Jumat", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "FIQ-101: Wudhu & Tayammum", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "https://drive.google.com/file/d/1ZLRZNGtttzsv0KQ7E9S2vezp3ma5vfwE/view?usp=drive_link" },
            { day: "Jumat", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "NAH-201: Tanda-tanda I'rab untuk Isim", teacher: "M. Ryza Anshori, S.Pd", downloadLink: "https://drive.google.com/file/d/1WX-53Q4hY5gvzAVbKsEjLHKACWgKo1K1/view?usp=drive_link" },
            { day: "Jumat", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "SIR-101: Kondisi Dunia Sebelum Kenabian & Masa Kecil Nabi", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "https://drive.google.com/file/d/1uULQr6lFC2YylJ4ZdcktlUXbgKEPzdp-/view?usp=drive_link" },
            { day: "Jumat", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "BAL-101: Pengantar Ilmu Balaghah", teacher: "M. Ryza Anshori, S.Pd", downloadLink: "https://drive.google.com/file/d/1UyC0-W-l-Xfli8SSvpMcihgiuFc1zYS0/view?usp=drive_link" },
            // Sabtu
            { day: "Sabtu", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "TAF-201: Tafsir & Tadabbur Surat Al-Maa'un & Al-Kafirun", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "https://drive.google.com/file/d/1uy5pOjhibrZbLUOUfRJHNKtqV4AT6obY/view?usp=drive_link" },
            { day: "Sabtu", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "AKH-101: Adab Kepada Allah", teacher: "Erwan Syahputra, S.Pd", downloadLink: "https://url-penyimpanan-anda.com/modul/AKH-101.pdf" },
            { day: "Sabtu", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "TAF-101: Tafsir & Tadabbur Surat Al-Fatihah", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "https://drive.google.com/file/d/1XyXIN1bsnIKVeGX3_H9MkaGlgrB2dhCu/view?usp=drive_link" },
            { day: "Sabtu", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "IND-201: Membaca 3 (Membedakan Fakta & Opini dalam Teks)", teacher: "Mia A. Lubis, S.Kom", downloadLink: "https://drive.google.com/file/d/12D_Sk1hB2q5e3BdNX1-Iw8kIjTrm6UId/view?usp=drive_link" },
            { day: "Sabtu", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "SIR-201: Peristiwa Boikot & Wafatnya Khadijah dan Abu Thalib", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "https://drive.google.com/file/d/1vJCQq48tCQNX_S5X8NF3DqTE9weOhGse/view?usp=drive_link" },
            { day: "Sabtu", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "NAH-101: Pengenalan Kalimat (Jumlah Mufidah) & Jenis Kata", teacher: "Mahadi Sentosa, S.Sos", downloadLink: "https://drive.google.com/file/d/1kbTKODSzvge5WUbkRA5wpf3SJl8WVXci/view?usp=drive_link" },
        ];

        const scheduleDataBulan2 = [
            // Senin
            { day: "Senin", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "MAT-102: Pecahan & Desimal", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Senin", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "MAT-102: Pecahan & Desimal", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Senin", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "IND-102: Berbicara 1: Perkenalan Diri & Sapaan Santun", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Senin", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "AKH-202: Adab kepada Orang Tua & Guru (Gabungan)", teacher: "SupraSojo, S.Pd.I., M.Pd.", downloadLink: "" },
            { day: "Senin", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "ENG-102: Classroom Objects & Instructions", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Senin", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "KWU-202: Validasi Ide & Model Bisnis Sederhana", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            // Selasa
            { day: "Selasa", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "ARB-102: ABY Jilid 1A: Unit 3-4 (Tempat Tinggal & Kehidupan Harian)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "STT", subject: "THI-202: Hifzhu Shihhah (Pola Hidup Sehat Rasulullah )", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Selasa", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "ARB-202: ABY Jilid 1B: Unit 9-10 (Berbelanja & Cuaca)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "KTR-102: Manajemen Kesehatan Dasar & Penyakit Umum", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Selasa", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "TAU-102: Studi Kitab Tauhid 1", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "IPA-202: Sistem Gerak pada Manusia (Rangka & Sendi)", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            // Rabu
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "LKS", subject: "ULH-202: Klasifikasi Hadits (Shahih, Hasan, Dha'if)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "KWU-102: Dasar-dasar Produk Halal & Thayyib", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "RBM", group: "KG", cluster: "STT", subject: "TME-202: Praktik Menggunakan Alat Tangan & Solder", teacher: "Aria Atmaja", downloadLink: "" },
            { day: "Rabu", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "IPS-102: Kebutuhan Manusia & Ekonomi Dasar", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "PAI-202: Public Speaking 2: Teknik Vokal & Bahasa Tubuh", teacher: "SupraSojo, S.Pd.I., M.Pd.", downloadLink: "" },
            { day: "Rabu", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "ENG-202: Food & Drinks", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "HAD-102: Hadits Arba'in 2 (Hafalan & Makna Hadits #6-10)", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            // Kamis
            { day: "Kamis", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "TIK-102: Sistem Operasi & Manajemen File Dasar", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "TAU-202: Studi Kitab Tauhid 2", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Kamis", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "STT", subject: "TIK-202: Pengolah Angka (Excel) Lanjutan", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "IPS-202: Kerajaan-Kerajaan Islam di Nusantara", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "IPA-102: Zat dan Wujudnya (Padat, Cair, Gas)", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "ULQ-202: Pengantar Ulumul Qur'an (Makkiyah & Madaniyah)", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            // Jumat
            { day: "Jumat", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "FIQ-102: Shalat 1: Syarat & Rukun Shalat", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Jumat", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "NAH-202: I'rab Isim Mutsanna & Jamak Mudzakkar Salim", teacher: "M. Ryza Anshori, S.Pd", downloadLink: "" },
            { day: "Jumat", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "SIR-102: Masa Kenabian & Dakwah di Mekah", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Jumat", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "BAL-102: Ilmu Ma'ani: Kalam Khabari & Insya'i", teacher: "M. Ryza Anshori, S.Pd", downloadLink: "" },
            // Sabtu
            { day: "Sabtu", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "TAF-202: Tafsir & Tadabbur Surat Al-'Asr & Al-Humazah", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "AKH-102: Adab kepada Sesama & Lingkungan", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Sabtu", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "TAF-102: Tafsir & Tadabbur Ayat Kursi", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "IND-202: Menulis 3: Membuat Ringkasan & Peta Konsep", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Sabtu", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "SIR-202: Peristiwa Isra' Mi'raj & Perintah Shalat", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "NAH-102: Jumlah Ismiyah (Kalimat Nominal)", teacher: "Mahadi Sentosa, S.Sos", downloadLink: "" },
        ];

        const scheduleDataBulan3 = [
            // Senin
            { day: "Senin", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "MAT-103: Aritmetika Sosial 1: Harga & Jual Beli", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Senin", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "MAT-103: Aritmetika Sosial 1: Harga & Jual Beli", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Senin", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "IND-103: Membaca 1: Memahami Teks Informasi Sederhana", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Senin", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "AKH-203: Isra' Mi'raj & Perintah Shalat", teacher: "SupraSojo, S.Pd.I., M.Pd.", downloadLink: "" },
            { day: "Senin", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "ENG-103: Alphabet, Numbers, & Telling Time", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Senin", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "KWU-202: Analisis Kompetitor & SWOT Sederhana", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            // Selasa
            { day: "Selasa", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "ARB-103: ABY Jilid 1A: Unit 5-6 (Makanan & Shalat)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "STT", subject: "THI-203: Makanan & Minuman Penyembuh Sesuai Wahyu", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Selasa", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "ARB-203: ABY Jilid 1B: Unit 11-12 (Manusia, Tempat & Hobi)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "KTR-103: Penanganan Luka & Pendarahan", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Selasa", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "TAU-103: Rukun Iman & Pembagian Tauhid", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "IPA-203: Sistem Pencernaan Manusia", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            // Rabu
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "LKS", subject: "ULH-203: Pengantar Sanad & Matan Hadits", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "KWU-103: Menemukan Ide Bisnis dari Masalah Sekitar", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "RBM", group: "KG", cluster: "STT", subject: "TME-203: Praktik Menggunakan Alat Ukur & Perawatan Alat", teacher: "Aria Atmaja", downloadLink: "" },
            { day: "Rabu", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "IPS-103: Interaksi Sosial & Adab", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "PAI-203: Public Speaking 3: Praktik Pidato Singkat (Kultum)", teacher: "SupraSojo, S.Pd.I., M.Pd.", downloadLink: "" },
            { day: "Rabu", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "ENG-203: Grammar 3: Present Continuous Tense", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "HAD-103: Hadits Arba'in 3 (Hafalan & Makna Hadits #11-15)", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            // Kamis
            { day: "Kamis", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "TIK-103: Latihan Mengetik 10 Jari (Typing)", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "TAU-203: Studi Kitab Tauhid 3", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Kamis", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "STT", subject: "TIK-203: Aplikasi Presentasi (PowerPoint) - Dasar", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "IPS-203: Geografi Jazirah Arab", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "IPA-103: Suhu, Kalor, & Pemuaian", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "ULQ-203: Pengantar Ilmu Tafsir (Definisi & Sejarah)", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            // Jumat
            { day: "Jumat", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "FIQ-103: Shalat 2: Sunnah & Pembatal Shalat", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Jumat", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "NAH-203: Penerapan Tanda Asli pada Isim Mufrad & Jamak Taksir", teacher: "M. Ryza Anshori, S.Pd", downloadLink: "" },
            { day: "Jumat", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "SIR-103: Hijrah ke Habasyah & Pemboikotan", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Jumat", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "BAL-103: Ilmu Bayan: Seni Perumpamaan (Tasybih)", teacher: "M. Ryza Anshori, S.Pd", downloadLink: "" },
            // Sabtu
            { day: "Sabtu", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "TAF-203: Tafsir & Tadabbur Surat At-Takatsur & Al-'Adiyat", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "AKH-103: Adab Menuntut Ilmu", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Sabtu", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "TAF-103: Tafsir & Tadabbur Surat Al-Ikhlas, Al-Falaq, An-Nas", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "IND-203: Berbicara 3: Menyampaikan Pendapat dalam Diskusi", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Sabtu", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "SIR-203: Bai'at 'Aqabah & Rencana Hijrah ke Madinah", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "NAH-103: Jumlah Fi'liyah (Kalimat Verbal)", teacher: "Mahadi Sentosa, S.Sos", downloadLink: "" },
        ];

        const scheduleDataBulan4 = [
            // Senin
            { day: "Senin", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "MAT-104: Pengenalan Bangun Datar", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Senin", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "MAT-104: Pengenalan Bangun Datar", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Senin", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "IND-104: Menulis 1: Menulis Paragraf Deskriptif", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Senin", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "AKH-204: Hijrah ke Habasyah", teacher: "SupraSojo, S.Pd.I., M.Pd.", downloadLink: "" },
            { day: "Senin", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "ENG-104: My Family & My Friends", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Senin", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "KWU-204: Analisis SWOT Sederhana", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            // Selasa
            { day: "Selasa", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "ARB-104: Mufrodat 1: Kosakata Benda di Kelas & Rumah", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "STT", subject: "THI-204: Terapi Pengobatan Nabawi (Bekam & Ruqyah)", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Selasa", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "ARB-204: Kitabah 2: Menulis Paragraf Sederhana & Imla' Lanjutan", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "KTR-104: Penanganan Kasus Umum & Simulasi P3K", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Selasa", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "TAU-104: Hadits Arba'in 4 (Hafalan & Makna Hadits #16-20)", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Selasa", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "IPA-204: Usaha & Pesawat Sederhana", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            // Rabu
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "LKS", subject: "ULH-204: Studi Sanad & Matan Sederhana", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "KWU-104: Menyusun Rencana Bisnis Sederhana", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "08:00-09:30", sks: 2, room: "RBM", group: "KG", cluster: "STT", subject: "TME-204: Praktik Menggunakan Alat Ukur & Perawatan Alat", teacher: "Aria Atmaja", downloadLink: "" },
            { day: "Rabu", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "IPS-104: Peta & Kompas", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "PAI-204: Public Speaking 4: Praktik Kultum di Depan Kelas", teacher: "SupraSojo, S.Pd.I., M.Pd.", downloadLink: "" },
            { day: "Rabu", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "ENG-204: Asking & Giving Directions", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Rabu", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "HAD-104: Hadits Arba'in 4 (Hafalan & Makna Hadits #16-20)", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            // Kamis
            { day: "Kamis", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "Wajib", subject: "TIK-104: Latihan Mengetik 10 Jari (Typing)", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "TAU-204: Studi Kitab Tauhid 4", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Kamis", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "STT", subject: "TIK-204: Desain Grafis Dasar 1 (dengan Canva)", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "IPS-204: Geografi Jazirah Arab", teacher: "Sulistiawan, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "IPA-104: Suhu, Kalor, & Pemuaian", teacher: "Ariyanti R. Siregar, S.Kom", downloadLink: "" },
            { day: "Kamis", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "ULQ-204: Tafsir Ayat-ayat Pilihan", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            // Jumat
            { day: "Jumat", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "FIQ-104: Shalat 4: Dzikir & Doa Setelah Shalat", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Jumat", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "NAH-204: Isim-isim yang Manshub (Manshubat al-Asma')", teacher: "M. Ryza Anshori, S.Pd", downloadLink: "" },
            { day: "Jumat", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "SIR-104: Masa Remaja Nabi & Perjalanan Dagang", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Jumat", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "LKS", subject: "BAL-104: Ilmu Badi': Keindahan Lafaz (Jinas & Thibaq)", teacher: "M. Ryza Anshori, S.Pd", downloadLink: "" },
            // Sabtu
            { day: "Sabtu", time: "08:00-09:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "TAF-204: Tafsir & Tadabbur Surat Al-'Adiyat & Al-Qari'ah", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "08:00-09:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "AKH-104: Adab Menuntut Ilmu", teacher: "Erwan Syahputra, S.Pd", downloadLink: "" },
            { day: "Sabtu", time: "10:00-11:30", sks: 2, room: "Kelas Mekah", group: "KF", cluster: "", subject: "TAF-104: Tafsir & Tadabbur Surat Al-Ikhlas, Al-Falaq, An-Nas", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "10:00-11:30", sks: 2, room: "Kelas Madinah", group: "KG", cluster: "Wajib", subject: "IND-204: Kaidah Bahasa 3: Imbuhan Dasar (me-, di-, ber-)", teacher: "Mia A. Lubis, S.Kom", downloadLink: "" },
            { day: "Sabtu", time: "13:00-14:30", sks: 2, room: "Kelas Mekah", group: "KG", cluster: "Wajib", subject: "SIR-204: Dakwah Terang-terangan & Reaksi Kafir Quraisy", teacher: "Zhofri F. Majdi, S.Sos", downloadLink: "" },
            { day: "Sabtu", time: "13:00-14:30", sks: 2, room: "Kelas Madinah", group: "KF", cluster: "", subject: "NAH-104: Jumlah Fi'liyah (Kalimat Verbal)", teacher: "Mahadi Sentosa, S.Sos", downloadLink: "" },
        ];
        
        const defaultTeachers = [
            { no: 1, name: "Sulistiawan, S.Kom", major: "Pelajaran Umum & Keterampilan", hari: "Semua hari & jam", schedule: "Guru Cadangan" },
            { no: 2, name: "Zhofri F. Majdi, S.Sos", major: "Diniyah", hari: "Kamis, Jumat, Sabtu", schedule: "Kamis (08-10), Jumat & Sabtu (Semua Jam)" },
            { no: 3, name: "M. Ryza Anshori, S.Pd", major: "Diniyah", hari: "Jumat", schedule: "Semua Jam" },
            { no: 4, name: "Erwan Syahputra, S.Pd", major: "Diniyah", hari: "Selasa, Rabu, Sabtu", schedule: "Selasa (Semua Jam), Rabu & Sabtu (sampai 10.00)" },
            { no: 5, name: "Ariyanti R. Siregar, S.Kom", major: "Pelajaran Umum", hari: "Semua Hari", schedule: "12.45 - 14.15" },
            { no: 6, name: "Mia A. Lubis, S.Kom", major: "Pelajaran Umum", hari: "Semua Hari", schedule: "10.00 - 12.15 (Guru Cadangan)" },
            { no: 7, name: "Mahadi Sentosa, S.Sos", major: "Diniyah", hari: "Sabtu", schedule: "13.00-14.30" },
            { no: 8, name: "Suprasojo, S.Pd.I., M.Pd.", major: "Diniyah", hari: "Senin, Rabu", schedule: "8.00-11.30" },
            { no: 9, name: "Aria Atmaja", major: "Teknik Mekanik Elektronik", hari: "Rabu", schedule: "08:00-09:30" },
        ];

        // --- GLOBAL STATE ---
        let scheduleData = []; // Will be populated after processing

        // --- DOM ELEMENTS ---
        const scheduleContainer = document.getElementById('schedule-container');
        const filterGroup = document.getElementById('filter-group');
        const filterCluster = document.getElementById('filter-cluster');
        const filterTeacher = document.getElementById('filter-teacher');
        const filterRoom = document.getElementById('filter-room');
        const resetFiltersBtn = document.getElementById('reset-filters');
        const teacherTableBody = document.querySelector('#teacher-table tbody');
        const moduleTableBody = document.querySelector('#module-table tbody');
        const modal = document.getElementById('confirmation-modal');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalMessage = document.getElementById('modal-message');
        const sidebar = document.getElementById('filter-sidebar');
        const overlay = document.getElementById('filter-overlay');
        const openBtn = document.getElementById('open-filter-btn');
        const closeBtn = document.getElementById('close-filter-btn');
        const tabBulan1 = document.getElementById('tab-bulan1');
        const tabBulan2 = document.getElementById('tab-bulan2');
        const tabBulan3 = document.getElementById('tab-bulan3');
        const tabBulan4 = document.getElementById('tab-bulan4');
        const krsContainer = document.getElementById('krs-container');
        const krsDisplay = document.getElementById('krs-display');
        const closeKrsBtnBottom = document.getElementById('close-krs-btn-bottom');
        const downloadKrsBtn = document.getElementById('download-krs-btn');
        const krsTableBody = document.getElementById('krs-table-body');
        const addKrsRowBtn = document.getElementById('add-krs-row');


        // --- UTILITY & HELPER FUNCTIONS ---
        const getGroupNameFromCode = (code) => {
            if (!code || !code.includes('-') || code.split('-')[1].length !== 3) {
                return "Modul Lain-lain";
            }
            const numStr = code.split('-')[1];
            const bagian = numStr.charAt(0);
            const sesi = numStr.charAt(2);
            const sesiMap = { '1': 'Sesi Pertama', '2': 'Sesi Kedua', '3': 'Sesi Ketiga', '4': 'Sesi Keempat', '5': 'Sesi Kelima', '6': 'Sesi Keenam' };
            const sesiText = sesiMap[sesi] || `Sesi ke-${sesi}`;
            return `Materi Bagian ${bagian} - ${sesiText}`;
        };

        const showConfirmation = (message) => {
            return new Promise((resolve) => {
                modalMessage.textContent = message;
                modal.classList.remove('hidden');
                const confirmHandler = () => {
                    modal.classList.add('hidden');
                    cleanup();
                    resolve(true);
                };
                const cancelHandler = () => {
                    modal.classList.add('hidden');
                    cleanup();
                    resolve(false);
                };
                const cleanup = () => {
                    modalConfirmBtn.removeEventListener('click', confirmHandler);
                    modalCancelBtn.removeEventListener('click', cancelHandler);
                };
                modalConfirmBtn.addEventListener('click', confirmHandler);
                modalCancelBtn.addEventListener('click', cancelHandler);
            });
        };
        
        const processAndFillScheduleData = (originalData) => {
            let processedData = originalData.filter(item => item.time !== "11:30-12:15");
            processedData = JSON.parse(JSON.stringify(processedData)); 
            
            const timeSlots = ["08:00-09:30", "10:00-11:30", "13:00-14:30"];
            const days = ["Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            const rooms = ["Kelas Mekah", "Kelas Madinah", "RBM"];

            days.forEach(day => {
                rooms.forEach(room => {
                    processedData.push({
                        day: day, time: "11:30-12:15", sks: 1, room: room, group: "Istirahat", cluster: "", 
                        subject: "Istirahat Qailullah", teacher: "", downloadLink: ""
                    });
                });

                timeSlots.forEach(time => {
                    // Skip RBM processing for Friday
                    if (day === "Jumat") {
                        const rbmEntry = processedData.find(item => item.day === "Jumat" && item.room === "RBM" && item.time === time);
                        if (rbmEntry) {
                            rbmEntry.subject = "";
                            rbmEntry.teacher = "";
                            rbmEntry.group = "";
                            rbmEntry.cluster = "";
                            rbmEntry.sks = 0;
                        }
                        if (time === "13:00-14:30") return;
                    }


                    const slotEntries = processedData.filter(item => item.day === day && item.time === time);
                    
                    const hasLKS = slotEntries.some(item => item.group === 'KG' && item.cluster === 'LKS');
                    const hasSTT = slotEntries.some(item => item.group === 'KG' && item.cluster === 'STT');

                    if (hasLKS && !hasSTT) {
                        processedData.push({
                            day: day, time: time, sks: 2, room: "RBM", group: "KG", cluster: "STT", 
                            subject: "Tugas Mandiri KG (STT)", teacher: "Sulistiawan, S.Kom", downloadLink: ""
                        });
                    } else if (hasSTT && !hasLKS) {
                         processedData.push({
                            day: day, time: time, sks: 2, room: "RBM", group: "KG", cluster: "LKS", 
                            subject: "Tugas Mandiri KG (LKS)", teacher: "Sulistiawan, S.Kom", downloadLink: ""
                        });
                    }

                    const kfInMainRooms = slotEntries.some(item => item.group === 'KF' && (item.room === 'Kelas Mekah' || item.room === 'Kelas Madinah'));
                    const rbmIsOccupied = slotEntries.some(item => item.room === 'RBM');

                    if (!kfInMainRooms && !rbmIsOccupied) { 
                        processedData.push({
                            day: day, time: time, sks: 2, room: "RBM", group: "KF", cluster: "", 
                            subject: "Tugas Mandiri KF", teacher: "Sulistiawan, S.Kom", downloadLink: ""
                        });
                    }
                });
            });
            return processedData;
        };

        // --- RENDER FUNCTIONS ---
        const renderSchedule = () => {
            scheduleContainer.innerHTML = '';
            const grid = document.createElement('div');
            grid.className = 'schedule-grid';
            const days = ["", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            const timeSlots = ["08:00-09:30", "10:00-11:30", "11:30-12:15", "13:00-14:30"];
            const rooms = ["Kelas Mekah", "Kelas Madinah", "RBM"];

            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header text-slate-600 bg-slate-100';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });

            timeSlots.forEach(time => {
                const timeHeader = document.createElement('div');
                timeHeader.className = 'time-slot text-teal-700 bg-slate-100 flex items-center justify-center';
                timeHeader.textContent = time;
                grid.appendChild(timeHeader);

                days.slice(1).forEach(day => {
                    const cellContainer = document.createElement('div');
                    cellContainer.className = 'p-1 bg-slate-100 rounded-lg space-y-1 flex flex-col justify-around';
                    const dayTimeData = scheduleData.filter(item => item.day === day && item.time === time);

                    rooms.forEach(room => {
                        const item = dayTimeData.find(d => d.room === room);
                        const cell = document.createElement('div');
                        cell.className = 'schedule-cell';

                        if (item) {
                            cell.dataset.group = item.group;
                            cell.dataset.teacher = item.teacher;
                            cell.dataset.room = item.room;
                            cell.dataset.cluster = item.cluster;

                            if (item.room === 'RBM') cell.classList.add('room-rbm');
                            if (item.room === 'Kelas Madinah') cell.classList.add('room-madinah');
                            if (item.room === 'Kelas Mekah') cell.classList.add('room-mekah');

                            let displayGroup = item.group;
                            if (item.group === 'KG' && item.cluster) {
                                displayGroup = `KG (${item.cluster})`;
                            }
                            
                            cell.innerHTML = `
                                <div class="flex-grow">
                                    <div class="subject font-bold text-sm text-teal-900"> ${item.subject || 'Kosong'}</div>
                                    <div class="group-display font-semibold text-xs text-slate-600"> ${displayGroup}</div>
                                    <div class="teacher font-semibold text-xs text-teal-600 mt-2"> ${item.teacher || ''}</div>
                                    <div class="room text-xs font-semibold ${item.room === 'RBM' ? 'text-orange-700' : 'text-sky-700'} mt-1"> ${item.room}</div>
                                </div>
                                <div class="flex justify-between items-end mt-2">
                                    <div class="sks-display font-bold text-xs text-teal-500">${item.sks || 0} SKS</div>
                                    ${item.downloadLink ? `
                                    <a href="${item.downloadLink}" target="_blank" rel="noopener noreferrer" title="Unduh Modul" class="inline-flex items-center justify-center w-6 h-6 bg-green-100 text-green-800 rounded-full hover:bg-green-200 transition">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M8.75 2.75a.75.75 0 0 0-1.5 0v5.69L5.03 6.22a.75.75 0 0 0-1.06 1.06l3.5 3.5a.75.75 0 0 0 1.06 0l3.5-3.5a.75.75 0 0 0-1.06-1.06L8.75 8.44V2.75Z" /><path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5Z" /></svg>
                                    </a>` : ''}
                                </div>
                            `;
                        }
                        cellContainer.appendChild(cell);
                    });
                    grid.appendChild(cellContainer);
                });
            });
            scheduleContainer.appendChild(grid);
            applyFilters();
        };

        const renderModuleTable = () => {
            const allScheduleEntries = [...scheduleDataBulan1, ...scheduleDataBulan2, ...scheduleDataBulan3, ...scheduleDataBulan4];
            
            const parentSubjectMap = { 'MAT': 'Matematika', 'IND': 'Bahasa Indonesia', 'THI': 'Thibbun Nabawi', 'ENG': 'Bahasa Inggris', 'KWU': 'Kewirausahaan', 'ARB': 'Bahasa Arab', 'KES': 'Kesehatan', 'KTR': 'Keterampilan', 'TAU': 'Tauhid', 'IPA': 'IPA Terpadu', 'ULH': 'Ulumul Hadits', 'TME': 'Teknik Mekanik Elektronik', 'IPS': 'IPS Terpadu', 'PANC': 'Pancasila', 'HAD': 'Hadits', 'TIK': 'Teknologi Informasi', 'ULQ': 'Ulumul Quran', 'FIQ': 'Fiqih', 'NAH': 'Nahwu', 'SIR': 'Sirah Nabawiyah', 'BAL': 'Balaghah', 'TAF': 'Tafsir', 'AKH': 'Akhlak' };
            const uniqueModules = {};

            allScheduleEntries.forEach(item => {
                if (item.subject && item.subject.includes(':')) {
                    if (!uniqueModules[item.subject]) {
                        uniqueModules[item.subject] = {
                            teacher: item.teacher || "N/A",
                            link: item.downloadLink || "",
                            sks: item.sks
                        };
                    }
                }
            });

            let moduleCounter = 1;
            const defaultModules = Object.keys(uniqueModules).map(subject => {
                const itemData = uniqueModules[subject];
                const [code, ...nameParts] = subject.split(':');
                const moduleName = nameParts.join(':').trim();
                const prefix = code.trim().split('-')[0];
                return {
                    no: moduleCounter++,
                    teacher: itemData.teacher,
                    parent_subject: parentSubjectMap[prefix] || 'Lainnya',
                    code: code.trim(),
                    module: moduleName,
                    sks: itemData.sks,
                    downloadLink: itemData.link
                };
            });
            
            moduleTableBody.innerHTML = '';
            const modulesByTeacher = defaultModules.reduce((acc, module) => {
                const teacherName = module.teacher || "Tanpa Guru";
                if (!acc[teacherName]) { acc[teacherName] = []; }
                acc[teacherName].push(module);
                return acc;
            }, {});

            const sortedTeachers = Object.keys(modulesByTeacher).sort();

            sortedTeachers.forEach(teacherName => {
                const modules = modulesByTeacher[teacherName];
                
                const teacherRow = document.createElement('tr');
                teacherRow.className = 'bg-slate-50 hover:bg-slate-100 cursor-pointer border-b border-slate-200';
                teacherRow.style.userSelect = 'none';
                teacherRow.innerHTML = `<td class="px-6 py-4 font-bold text-teal-700" colspan="7"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><svg class="w-5 h-5 transition-transform duration-300 arrow-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 0 1 .02-1.06L11.168 10 7.23 6.29a.75.75 0 1 1 1.04-1.08l4.5 4.25a.75.75 0 0 1 0 1.08l-4.5 4.25a.75.75 0 0 1-1.06-.02Z" clip-rule="evenodd" /></svg><span>${teacherName}</span></div><span class="bg-teal-100 text-teal-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full">${modules.length} Modul</span></div></td>`;
                moduleTableBody.appendChild(teacherRow);

                const detailsRow = document.createElement('tr');
                detailsRow.className = 'hidden';

                const detailsCell = document.createElement('td');
                detailsCell.colSpan = 7;
                detailsCell.className = "p-0";

                const modulesContainer = document.createElement('div');
                modulesContainer.className = "bg-white";

                modules.sort((a, b) => a.code.localeCompare(b.code));
                const groupsWithinTeacher = modules.reduce((acc, mod) => {
                    const groupName = getGroupNameFromCode(mod.code);
                    if (!acc[groupName]) { acc[groupName] = []; }
                    acc[groupName].push(mod);
                    return acc;
                }, {});

                Object.keys(groupsWithinTeacher).sort((a, b) => {
                    const numA = parseInt(a.match(/\d+/)[0]);
                    const numB = parseInt(b.match(/\d+/)[0]);
                    return numA - numB;
                }).forEach(groupName => {
                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'flex items-center justify-between px-4 py-3 text-base font-bold text-teal-800 bg-teal-50 border-t border-b border-teal-100 cursor-pointer hover:bg-teal-200 transition';
                    groupHeader.style.userSelect = 'none';
                    groupHeader.innerHTML = `<span>${groupName}</span><svg class="w-5 h-5 transition-transform duration-300 arrow-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 0 1 .02-1.06L11.168 10 7.23 6.29a.75.75 0 1 1 1.04-1.08l4.5 4.25a.75.75 0 0 1 0 1.08l-4.5 4.25a.75.75 0 0 1-1.06-.02Z" clip-rule="evenodd" /></svg>`;
                    modulesContainer.appendChild(groupHeader);
                    
                    const singleGroupContainer = document.createElement('div');
                    singleGroupContainer.className = 'divide-y divide-slate-100 hidden';
                    
                    const modulesInGroup = groupsWithinTeacher[groupName];
                    modulesInGroup.forEach(mod => {
                        const moduleItem = document.createElement('div');
                        moduleItem.className = 'grid grid-cols-7 gap-4 p-4 items-center text-sm hover:bg-slate-50 transition';
                        moduleItem.innerHTML = `
                            <div class="px-2 text-slate-500 font-medium">${mod.no}</div>
                            <div class="col-span-1 px-2 text-slate-800 font-semibold">${mod.parent_subject}</div>
                            <div class="col-span-1 px-2 text-slate-600">${mod.code}</div>
                            <div class="col-span-2 px-2 text-slate-800">${mod.module}</div>
                            <div class="px-2 text-slate-600">${mod.sks ? mod.sks + ' SKS' : 'N/A'}</div>
                            <div class="px-2 text-right">
                                ${mod.downloadLink ? `<a href="${mod.downloadLink}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-1 rounded-full hover:bg-green-200 transition"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M10.75 2.75a.75.75 0 0 0-1.5 0v8.614L6.295 8.235a.75.75 0 1 0-1.09 1.03l4.25 4.5a.75.75 0 0 0 1.09 0l4.25-4.5a.75.75 0 0 0-1.09-1.03l-2.955 3.129V2.75Z" /><path d="M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z" /></svg>Unduh</a>` : `<span class="inline-flex items-center gap-2 bg-slate-100 text-slate-500 text-xs font-semibold px-2.5 py-1 rounded-full cursor-not-allowed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z" clip-rule="evenodd" /></svg>Kosong</span>`}
                            </div>
                        `;
                        singleGroupContainer.appendChild(moduleItem);
                    });
                    modulesContainer.appendChild(singleGroupContainer);
                    groupHeader.addEventListener('click', () => {
                        singleGroupContainer.classList.toggle('hidden');
                        groupHeader.querySelector('.arrow-icon').classList.toggle('rotate-90');
                    });
                });
                detailsCell.appendChild(modulesContainer);
                detailsRow.appendChild(detailsCell);
                moduleTableBody.appendChild(detailsRow);
                teacherRow.addEventListener('click', () => {
                    detailsRow.classList.toggle('hidden');
                    teacherRow.querySelector('.arrow-icon').classList.toggle('rotate-90');
                });
            });
        };

        const renderTeacherTable = () => {
            teacherTableBody.innerHTML = '';
            defaultTeachers.forEach(teacher => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-500">${teacher.no}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">${teacher.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${teacher.major}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${teacher.hari}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${teacher.schedule}</td>
                `;
                teacherTableBody.appendChild(row);
            });
        };

        const applyFilters = () => {
            const group = filterGroup.value;
            let cluster = filterCluster.value;
            const teacher = filterTeacher.value;
            const room = filterRoom.value;
            filterCluster.disabled = (group !== 'KG');
            if (group !== 'KG') {
                filterCluster.value = 'all';
                cluster = 'all';
            }
            document.querySelectorAll('.schedule-cell').forEach(cell => {
                const cellData = cell.dataset;
                if (!cellData.group) {
                    cell.classList.remove('highlight', 'dimmed');
                    return;
                }
                let isMatch = true;
                if (group !== 'all' && cellData.group !== group) isMatch = false;
                if (cluster !== 'all' && cellData.cluster !== cluster && cellData.cluster !== 'Wajib') isMatch = false;
                if (teacher !== 'all' && cellData.teacher !== teacher) isMatch = false;
                if (room !== 'all' && cellData.room !== room) isMatch = false;

                if (group === 'all' && cluster === 'all' && teacher === 'all' && room === 'all') {
                    cell.classList.remove('highlight', 'dimmed');
                } else if (isMatch) {
                    cell.classList.add('highlight');
                    cell.classList.remove('dimmed');
                } else {
                    cell.classList.remove('highlight');
                    cell.classList.add('dimmed');
                }
            });
        };

        const populateTeacherFilter = () => {
            const teachers = [...new Set(scheduleData.map(item => item.teacher).filter(Boolean))];
            teachers.sort();
            filterTeacher.innerHTML = '<option value="all">Semua Guru</option>';
            teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher;
                option.textContent = teacher;
                filterTeacher.appendChild(option);
            });
        };

        // --- KRS LOGIC ---
        const updateKrsTotalSks = () => {
            const totalSksElement = document.getElementById('total-sks-diambil');
            let totalSks = 0;
            const krsTableForCalc = document.getElementById('krs-table-body');
            const sksCells = krsTableForCalc.querySelectorAll('tr td:nth-child(6)'); // 6th column is SKS
            sksCells.forEach(cell => {
                const sksValue = parseInt(cell.textContent, 10) || 0;
                totalSks += sksValue;
            });
            totalSksElement.textContent = totalSks;
        };

        const handleKrsClick = (event) => {
            const button = event.target;
            const row = button.closest('tr');
            const santriName = row.dataset.santriName;
            const santriGroupInfo = row.dataset.santriGroup.split(' ');
            const santriKelas = row.dataset.santriKelas;
            const santriJurusan = row.dataset.santriJurusan;
            
            const santriGroup = santriGroupInfo[0];
            const santriCluster = santriGroupInfo.length > 1 ? santriGroupInfo[1] : null;

            // Populate Info Card
            document.getElementById('nama-santri').textContent = `: ${santriName}`;
            document.getElementById('jurusan').textContent = `: ${santriJurusan}`;
            document.getElementById('kelas').textContent = `: ${santriKelas}`;
            document.getElementById('kelompok').textContent = `: ${row.dataset.santriGroup}`;
            const activeTab = document.querySelector('.tab-btn.active');
            document.getElementById('materi-bulan').textContent = `: ${activeTab.textContent.replace('Bulan ', '')}`;

            let krsData = [];
            if (santriGroup === 'KF') {
                krsData = scheduleData.filter(item => item.group === 'KF');
            } else if (santriGroup === 'KG' && santriCluster) {
                krsData = scheduleData.filter(item => item.group === 'KG' && (item.cluster === santriCluster || item.cluster === 'Wajib'));
            }

            const krsTableBodyEl = document.getElementById('krs-table-body');
            krsTableBodyEl.innerHTML = ''; // Clear previous data
            
            if (krsData.length > 0) {
                krsData
                    .filter(item => item.group !== 'Istirahat' && item.subject && item.subject.trim() !== 'Kosong' && !item.subject.toLowerCase().includes('tugas mandiri'))
                    .sort((a, b) => {
                        const days = ["Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
                        if (days.indexOf(a.day) !== days.indexOf(b.day)) {
                            return days.indexOf(a.day) - days.indexOf(b.day);
                        }
                        return a.time.localeCompare(b.time);
                    })
                    .forEach((item, index) => {
                        const tr = document.createElement('tr');
                        tr.className = index % 2 === 0 ? 'bg-white border-b' : 'bg-gray-50 border-b';
                        const code = item.subject.split(':')[0];
                        tr.innerHTML = `
                            <td class="px-4 py-2" contenteditable="true">${item.day}</td>
                            <td class="px-4 py-2" contenteditable="true">${item.time}</td>
                            <td class="px-4 py-2" contenteditable="true">${code}</td>
                            <td class="px-4 py-2" contenteditable="true">${item.subject.substring(code.length + 1).trim()}</td>
                            <td class="px-4 py-2" contenteditable="true">${item.room}</td>
                            <td class="px-4 py-2 text-center" contenteditable="true">${item.sks}</td>
                            <td class="px-4 py-2" contenteditable="true">${item.teacher}</td>
                            <td class="px-4 py-2 text-center"><button class="delete-krs-row text-red-500 hover:text-red-700">Hapus</button></td>
                        `;
                        krsTableBodyEl.appendChild(tr);
                    });
            } else {
                 krsTableBodyEl.innerHTML = `<tr><td colspan="8" class="text-center px-4 py-3 text-gray-500">Tidak ada data KRS untuk ditampilkan.</td></tr>`;
            }

            updateKrsTotalSks();
            krsContainer.classList.remove('hidden');
            krsContainer.scrollIntoView({ behavior: 'smooth' });
        };

        // --- EVENT LISTENERS ---
        const handleTabClick = (selectedData, activeTab) => {
            scheduleData = selectedData;
            
            [tabBulan1, tabBulan2, tabBulan3, tabBulan4].forEach(tab => tab.classList.remove('active'));
            activeTab.classList.add('active');

            renderSchedule();
            populateTeacherFilter();
            krsContainer.classList.add('hidden');
        };

        tabBulan1.addEventListener('click', () => handleTabClick(processedScheduleBulan1, tabBulan1));
        tabBulan2.addEventListener('click', () => handleTabClick(processedScheduleBulan2, tabBulan2));
        tabBulan3.addEventListener('click', () => handleTabClick(processedScheduleBulan3, tabBulan3));
        tabBulan4.addEventListener('click', () => handleTabClick(processedScheduleBulan4, tabBulan4));

        const toggleSidebar = () => {
            sidebar.classList.toggle('show');
            overlay.classList.toggle('hidden');
        };
        if (openBtn) openBtn.addEventListener('click', toggleSidebar);
        if (closeBtn) closeBtn.addEventListener('click', toggleSidebar);
        if (overlay) overlay.addEventListener('click', toggleSidebar);

        filterGroup.addEventListener('change', applyFilters);
        filterCluster.addEventListener('change', applyFilters);
        filterTeacher.addEventListener('change', applyFilters);
        filterRoom.addEventListener('change', applyFilters);
        
        resetFiltersBtn.addEventListener('click', () => {
            filterGroup.value = 'all';
            filterCluster.value = 'all';
            filterTeacher.value = 'all';
            filterRoom.value = 'all';
            applyFilters();
        });

        document.getElementById('reset-schedule').addEventListener('click', async () => {
            if (await showConfirmation('Apakah Anda yakin ingin mengembalikan jadwal ke data semula? Semua perubahan akan hilang.')) {
                handleTabClick(processedScheduleBulan1, tabBulan1);
            }
        });

        document.getElementById('print-schedule').addEventListener('click', () => window.print());

        document.getElementById('download-jpg').addEventListener('click', function() {
            const downloadBtn = this;
            const label = downloadBtn.querySelector('.fab-label');
            const originalText = label.textContent;
            const scheduleContainer = document.getElementById('schedule-container');
            label.textContent = 'Menyiapkan...';
            downloadBtn.disabled = true;
            html2canvas(scheduleContainer, { scale: 2, useCORS: true, onclone: (doc) => {
                const container = doc.getElementById('schedule-container');
                if (container) {
                    container.style.maxHeight = 'none';
                    container.style.overflow = 'visible';
                }
            }}).then(canvas => {
                const link = document.createElement('a');
                let fileName = 'jadwal-kbm.jpg';
                if(tabBulan1.classList.contains('active')) fileName = 'jadwal-kbm-bulan1.jpg';
                if(tabBulan2.classList.contains('active')) fileName = 'jadwal-kbm-bulan2.jpg';
                if(tabBulan3.classList.contains('active')) fileName = 'jadwal-kbm-bulan3.jpg';
                if(tabBulan4.classList.contains('active')) fileName = 'jadwal-kbm-bulan4.jpg';
                link.download = fileName;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                label.textContent = originalText;
                downloadBtn.disabled = false;
            }).catch(err => {
                console.error("Gagal membuat gambar jadwal:", err);
                label.textContent = "Gagal Unduh";
                setTimeout(() => {
                    label.textContent = originalText;
                    downloadBtn.disabled = false;
                }, 3000);
            });
        });

        document.querySelectorAll('.krs-btn').forEach(button => {
            button.addEventListener('click', handleKrsClick);
        });

        closeKrsBtnBottom.addEventListener('click', () => {
            krsContainer.classList.add('hidden');
        });

        addKrsRowBtn.addEventListener('click', () => {
            const tr = document.createElement('tr');
            const index = krsTableBody.children.length;
            tr.className = index % 2 === 0 ? 'bg-white border-b' : 'bg-gray-50 border-b';
            tr.innerHTML = `
                <td class="px-4 py-2" contenteditable="true"></td>
                <td class="px-4 py-2" contenteditable="true"></td>
                <td class="px-4 py-2" contenteditable="true"></td>
                <td class="px-4 py-2" contenteditable="true"></td>
                <td class="px-4 py-2" contenteditable="true"></td>
                <td class="px-4 py-2 text-center" contenteditable="true">0</td>
                <td class="px-4 py-2" contenteditable="true"></td>
                <td class="px-4 py-2 text-center"><button class="delete-krs-row text-red-500 hover:text-red-700">Hapus</button></td>
            `;
            krsTableBody.appendChild(tr);
            updateKrsTotalSks();
        });
        
        krsTableBody.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-krs-row')) {
                event.target.closest('tr').remove();
                updateKrsTotalSks();
            }
        });
        
        krsTableBody.addEventListener('input', (event) => {
             if (event.target.tagName === 'TD') {
                 updateKrsTotalSks();
             }
        });

        downloadKrsBtn.addEventListener('click', () => {
             const { jsPDF } = window.jspdf;
             const pdf = new jsPDF({
                 orientation: 'portrait',
                 unit: 'mm',
                 format: [210, 330]
             });
             const margin = 15;
             let y = 10;

             pdf.setFont('helvetica', 'bold');
             pdf.setFontSize(12);
             pdf.text('KARTU RENCANA STUDI (KRS)', 105, y, { align: 'center' });
             y += 6;
             pdf.setFontSize(10);
             pdf.text("Markaz Qur'an Al-Maa'un", 105, y, { align: 'center' });
             y += 4;
             pdf.setFont('helvetica', 'normal');
             pdf.setFontSize(9);
             pdf.text('Semester Ganjil', 105, y, { align: 'center' });
             y += 8;

             pdf.setFontSize(8);
             const info = {
                 left: [
                     { label: 'Nama Santri', value: document.getElementById('nama-santri').textContent.substring(1).trim() },
                     { label: 'Jurusan', value: document.getElementById('jurusan').textContent.substring(1).trim() },
                     { label: 'Kelompok', value: document.getElementById('kelompok').textContent.substring(1).trim() }
                 ],
                 right: [
                     { label: 'Total SKS yang bisa diambil', value: document.getElementById('total-sks-ambil').textContent.substring(1).trim() },
                     { label: 'Kelas', value: document.getElementById('kelas').textContent.substring(1).trim() },
                     { label: 'Materi untuk Bulan ke', value: document.getElementById('materi-bulan').textContent.substring(1).trim() }
                 ]
             };
             
             const leftLabelX = margin;
             const leftColonX = leftLabelX + 45;
             const leftValueX = leftColonX + 2;
             const rightLabelX = 110;
             const rightColonX = rightLabelX + 45;
             const rightValueX = rightColonX + 2;
             const lineHeight = 5;

             const maxRows = Math.max(info.left.length, info.right.length);

             for (let i = 0; i < maxRows; i++) {
                 if (info.left[i]) {
                     pdf.setFont('helvetica', 'bold');
                     pdf.text(info.left[i].label, leftLabelX, y);
                     pdf.setFont('helvetica', 'normal');
                     pdf.text(':', leftColonX, y);
                     pdf.text(info.left[i].value, leftValueX, y, { maxWidth: rightLabelX - leftValueX - 5 });
                 }
                 if (info.right[i]) {
                     pdf.setFont('helvetica', 'bold');
                     pdf.text(info.right[i].label, rightLabelX, y);
                      pdf.setFont('helvetica', 'normal');
                     pdf.text(':', rightColonX, y);
                     pdf.text(info.right[i].value, rightValueX, y);
                 }
                 y += lineHeight;
             }
             
             pdf.autoTable({
                 html: '#tabel-krs',
                 startY: y,
                 theme: 'grid',
                 styles: {
                     font: 'helvetica',
                     fontSize: 8,
                     cellPadding: 1,
                     valign: 'middle'
                 },
                 headStyles: {
                     fillColor: [243, 244, 246],
                     textColor: [31, 41, 55],
                     fontStyle: 'bold',
                     fontSize: 8.5,
                 },
                 footStyles: {
                     fillColor: [243, 244, 246],
                     textColor: [31, 41, 55],
                     fontStyle: 'bold',
                     fontSize: 8.5,
                     halign: 'right'
                 },
                 columnStyles: {
                     5: { halign: 'center' } 
                 },
                 didParseCell: function (data) {
                     if (data.row.section === 'foot') {
                        data.cell.styles.halign = 'right';
                        if(data.column.index === 0) {
                             data.cell.text = data.cell.text[0].replace(/:/g, '');
                        }
                     }
                 },
                 // Remove the last column ('Aksi') from the PDF
                 columns: [
                    { header: 'Hari', dataKey: 0 },
                    { header: 'Waktu', dataKey: 1 },
                    { header: 'Kode', dataKey: 2 },
                    { header: 'Mata Pelajaran / Modul', dataKey: 3 },
                    { header: 'Ruang', dataKey: 4 },
                    { header: 'SKS', dataKey: 5 },
                    { header: 'Guru', dataKey: 6 },
                ]
             });

             pdf.save(`KRS_${document.getElementById('nama-santri').textContent.substring(1).trim()}.pdf`);
        });

        // --- INITIALIZATION ---
        const processedScheduleBulan1 = processAndFillScheduleData(scheduleDataBulan1);
        const processedScheduleBulan2 = processAndFillScheduleData(scheduleDataBulan2);
        const processedScheduleBulan3 = processAndFillScheduleData(scheduleDataBulan3);
        const processedScheduleBulan4 = processAndFillScheduleData(scheduleDataBulan4);

        scheduleData = processedScheduleBulan1; // Set initial data

        renderTeacherTable();
        renderModuleTable();
        populateTeacherFilter();
        renderSchedule();
    });
    </script>
</body>
</html>
