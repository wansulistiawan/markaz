<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kasir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #333;
        }
        .container {
            max-width: 1200px;
        }
        .sidebar {
            background-color: #1f2937;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 50;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        @media (min-width: 768px) {
            .sidebar {
                transform: translateX(0);
                position: relative;
            }
        }
        .sidebar a {
            color: #d1d5db;
        }
        .sidebar a:hover {
            background-color: #374151;
        }
        .active-link {
            background-color: #4b5563;
            color: #ffffff;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #3b82f6;
            color: #ffffff;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: #ffffff;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .btn-success {
            background-color: #22c55e;
            color: #ffffff;
        }
        .btn-success:hover {
            background-color: #16a34a;
        }
        .table-header {
            background-color: #f3f4f6;
        }
        input, select, textarea {
            border: 1px solid #d1d5db;
        }
        .barcode-reader-container {
            position: relative;
            height: 300px;
            width: 100%;
            overflow: hidden;
        }
        #interactive.viewport {
            position: relative;
            width: 100%;
            height: 100%;
        }
        #interactive.viewport canvas, #interactive.viewport video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col md:flex-row min-h-screen">
    
    <header class="bg-gray-800 text-white p-4 flex justify-between items-center md:hidden">
        <div class="text-xl font-bold">Sistem Kasir</div>
        <button id="menu-toggle" class="focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
        </button>
    </header>

    <aside id="sidebar" class="sidebar fixed inset-y-0 left-0 w-64 p-4 text-gray-300 flex flex-col items-center md:relative md:flex md:transform-none">
        <div class="text-2xl font-bold text-white mb-8 hidden md:block">Sistem Kasir</div>
        <nav class="flex flex-col w-full space-y-2">
            <a href="#" class="p-3 rounded-md transition-colors active-link" onclick="showSection('manajemen')">
                Manajemen
            </a>
            <a href="#" class="p-3 rounded-md transition-colors" onclick="showSection('transaksi')">
                Transaksi Penjualan
            </a>
            <a href="#" class="p-3 rounded-md transition-colors" onclick="showSection('laporan')">
                Laporan
            </a>
        </nav>
        <div class="mt-auto text-xs text-center text-gray-400 p-2">
            <p>ID Pengguna:</p>
            <p id="userIdDisplay" class="truncate font-mono text-white mt-1">N/A</p>
        </div>
    </aside>

    <main class="flex-1 p-4 sm:p-8">
        <section id="manajemen" class="active-section">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6">Manajemen</h2>
			
            <div class="flex flex-col md:flex-row gap-8">
                <div class="flex-1 card p-4 sm:p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4 sm:gap-0">
                        <h3 class="text-lg sm:text-xl font-semibold">Daftar Barang & Jasa</h3>
                        <button id="addProductBtn" class="btn-primary w-full sm:w-auto py-2 px-4 rounded-full text-sm font-semibold">+ Tambah Barang</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm rounded-lg overflow-hidden">
                            <thead class="table-header">
                                <tr>
                                    <th class="py-2 px-4 text-left font-medium">Foto</th>
                                    <th class="py-2 px-4 text-left font-medium">Nama Barang</th>
                                    <th class="py-2 px-4 text-left font-medium">Kode</th>
                                    <th class="py-2 px-4 text-left font-medium">Harga Dasar</th>
                                    <th class="py-2 px-4 text-left font-medium">Harga Jual</th>
                                    <th class="py-2 px-4 text-left font-medium">Stok</th>
                                    <th class="py-2 px-4 text-left font-medium">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="productList" class="divide-y divide-gray-200">
                                </tbody>
                        </table>
                        <div id="noDataMessage" class="text-center text-gray-500 py-8 hidden">Tidak ada data barang. Silakan tambahkan.</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="transaksi" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Transaksi Penjualan</h2>
            <div class="card p-6">
                <p>Fitur Transaksi Penjualan akan diimplementasikan di sini. Ini bisa mencakup daftar barang, keranjang belanja, dan proses pembayaran.</p>
            </div>
        </section>

        <section id="laporan" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Laporan</h2>
            <div class="card p-6">
                <p>Fitur Laporan akan diimplementasikan di sini. Ini bisa mencakup laporan laba-rugi, ringkasan penjualan, dan laporan stok.</p>
            </div>
        </section>
    </main>
    
    <div id="productModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3">
                <h3 class="text-xl font-semibold" id="formTitle">Tambah Barang</h3>
                <button onclick="hideAddProductForm()" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="mt-2">
                <form id="productForm" class="space-y-4">
                    <input type="hidden" id="productId">
                    <div>
                        <label for="itemPhotoInput" class="block text-sm font-medium text-gray-700">Foto Barang</label>
                        <label for="itemPhotoInput" class="mt-1 flex items-center justify-center border-2 border-dashed rounded-md p-4 bg-gray-50 text-gray-500 hover:bg-gray-100 transition duration-150 ease-in-out cursor-pointer">
                            <input type="file" id="itemPhotoInput" accept="image/*" class="sr-only">
                            <div class="text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-20m32-12a4 4 0 00-4-4h-28a4 4 0 00-4 4v20m32-12L16 12L8 24"></path>
                                </svg>
                                <p class="mt-2 text-sm">Klik untuk upload atau ambil foto</p>
                                <p id="photoName" class="text-xs text-green-600 mt-1"></p>
                            </div>
                        </label>
                        <input type="hidden" id="itemPhotoURL">
                        <small class="text-gray-500">Foto akan otomatis dikompres sebelum diunggah.</small>
                    </div>
                    <div>
                        <label for="itemName" class="block text-sm font-medium text-gray-700">Nama Barang</label>
                        <input type="text" id="itemName" required class="mt-1 block w-full rounded-md p-2">
                    </div>
                    <div>
                        <label for="itemCode" class="block text-sm font-medium text-gray-700">Kode (Bisa scan barcode)</label>
                        <div class="relative mt-1">
                            <input type="text" id="itemCode" class="block w-full rounded-md p-2 pr-10">
                            <button type="button" onclick="startBarcodeScan()" class="absolute inset-y-0 right-0 flex items-center pr-3 focus:outline-none">
                                <svg class="h-5 w-5 text-gray-400 hover:text-gray-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1.894-3.56a.75.75 0 01-1.061 1.06l-2.5-2.5a.75.75 0 010-1.06l2.5-2.5a.75.75 0 111.06 1.061L8.31 10l.794.793a.75.75 0 01-.061 1.06zM13.626 13.626a.75.75 0 01-1.06 1.06l-2.5-2.5a.75.75 0 010-1.06l2.5-2.5a.75.75 0 011.06 1.061L12.19 10l.794.793a.75.75 0 01.061 1.06z" clip-rule="evenodd" fill-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label for="itemStock" class="block text-sm font-medium text-gray-700">Stok</label>
                            <input type="number" id="itemStock" required class="mt-1 block w-full rounded-md p-2">
                        </div>
                        <div class="flex-1">
                            <label for="itemBasePrice" class="block text-sm font-medium text-gray-700">Harga Dasar</label>
                            <input type="number" id="itemBasePrice" required class="mt-1 block w-full rounded-md p-2">
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label for="itemSellPrice" class="block text-sm font-medium text-gray-700">Harga Jual</label>
                            <input type="number" id="itemSellPrice" required class="mt-1 block w-full rounded-md p-2">
                        </div>
                        <div class="flex-1">
                            <label for="itemWholesalePrice" class="block text-sm font-medium text-gray-700">Harga Grosir</label>
                            <input type="number" id="itemWholesalePrice" class="mt-1 block w-full rounded-md p-2">
                        </div>
                    </div>
                    <div>
                        <label for="itemCategory" class="block text-sm font-medium text-gray-700">Kategori</label>
                        <select id="itemCategory" class="mt-1 block w-full rounded-md p-2">
                            <option value="">Pilih Kategori</option>
                            <option value="Makanan">Makanan</option>
                            <option value="Minuman">Minuman</option>
                            <option value="Elektronik">Elektronik</option>
                        </select>
                    </div>
                    <div>
                        <label for="itemDescription" class="block text-sm font-medium text-gray-700">Keterangan</label>
                        <textarea id="itemDescription" rows="2" class="mt-1 block w-full rounded-md p-2"></textarea>
                    </div>
                    <div>
                        <button type="submit" class="btn-success w-full py-2 px-4 rounded-md font-semibold">Simpan</button>
                        <button type="button" class="btn-secondary w-full py-2 px-4 rounded-md mt-2 font-semibold" onclick="hideAddProductForm()">Batal</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="barcodeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3">
                <h3 class="text-xl font-semibold">Scan Barcode</h3>
                <button onclick="stopBarcodeScan()" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="mt-2 text-center">
                <div id="interactive" class="viewport barcode-reader-container"></div>
                <p id="scanResult" class="mt-4 text-lg font-bold text-gray-800"></p>
                <button onclick="stopBarcodeScan()" class="btn-secondary w-full py-2 px-4 rounded-md mt-4">Tutup</button>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

<script type="module">
        const CONFIG = {
        SCRIPT_URL: "https://script.google.com/macros/s/AKfycbyNVr58Xay5aYGHT8Eu2xbXW5jXW9zjx5hwLc4SJGeqL-hmnhvVNY0KU-2DeRoglOgB/exec",
        CLOUDINARY_URL: "https://api.cloudinary.com/v1_1/deva5eknr/image/upload",
        CLOUDINARY_UPLOAD_PRESET: "markaz",
    };

    let codeReader;

    const showMessage = (message, isError = false) => {
        const messageBox = document.createElement('div');
        messageBox.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg text-white font-semibold transition-all duration-300 transform ${isError ? 'bg-red-500' : 'bg-green-500'} z-50`;
        messageBox.textContent = message;
        document.body.appendChild(messageBox);
        setTimeout(() => {
            messageBox.style.transform = 'translateY(100px)';
            messageBox.style.opacity = '0';
            setTimeout(() => messageBox.remove(), 300);
        }, 3000);
    };

    const fetchProducts = async () => {
        try {
            const response = await fetch(CONFIG.SCRIPT_URL + '?action=read');
            const data = await response.json();
            if (data.status === 'success') {
                renderProducts(data.data);
            } else {
                showMessage('Kesalahan saat memuat data produk.', true);
            }
        } catch (error) {
            console.error('Error fetching products:', error);
            showMessage('Kesalahan jaringan saat mengambil data.', true);
        }
    };

    const renderProducts = (products) => {
        const productList = document.getElementById('productList');
        productList.innerHTML = '';
        if (products.length === 0) {
            document.getElementById('noDataMessage').classList.remove('hidden');
        } else {
            document.getElementById('noDataMessage').classList.add('hidden');
            products.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="py-2 px-4"><img src="${product.photo || 'https://placehold.co/40x40/e5e7eb/d1d5db?text=N/A'}" alt="Foto Barang" class="w-10 h-10 object-cover rounded-md"></td>
                    <td class="py-2 px-4">${product.name}</td>
                    <td class="py-2 px-4">${product.code || 'N/A'}</td>
                    <td class="py-2 px-4">Rp${parseFloat(product.basePrice).toLocaleString('id-ID')}</td>
                    <td class="py-2 px-4">Rp${parseFloat(product.sellPrice).toLocaleString('id-ID')}</td>
                    <td class="py-2 px-4">${product.stock}</td>
                    <td class="py-2 px-4 space-x-2">
                        <button class="text-blue-500 hover:text-blue-700" onclick="editProduct('${product.id}')">Edit</button>
                        <button class="text-red-500 hover:text-red-700" onclick="deleteProduct('${product.id}')">Hapus</button>
                    </td>
                `;
                productList.appendChild(row);
            });
        }
    };

    window.showSection = (sectionId) => {
        document.querySelectorAll('section').forEach(section => {
            section.classList.add('hidden');
            section.classList.remove('active-section');
        });
        document.getElementById(sectionId).classList.remove('hidden');
        document.getElementById(sectionId).classList.add('active-section');
        
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.classList.remove('active-link');
        });
        document.querySelector(`.sidebar a[onclick="showSection('${sectionId}')"]`).classList.add('active-link');

        document.getElementById('sidebar').classList.remove('open');
    };

    window.showAddProductForm = () => {
        document.getElementById('productModal').classList.remove('hidden');
        document.getElementById('formTitle').textContent = 'Tambah Barang';
        document.getElementById('productForm').reset();
        document.getElementById('productId').value = '';
        document.getElementById('photoName').textContent = '';
        document.getElementById('itemPhotoURL').value = '';
    };

    window.hideAddProductForm = () => {
        document.getElementById('productModal').classList.add('hidden');
        document.getElementById('productForm').reset();
        document.getElementById('photoName').textContent = '';
        document.getElementById('itemPhotoURL').value = '';
        stopBarcodeScan();
    };

    window.editProduct = async (productId) => {
        try {
            const response = await fetch(CONFIG.SCRIPT_URL + `?action=read&id=${productId}`);
            const data = await response.json();
            if (data.status === 'success' && data.data) {
                const product = data.data;
                document.getElementById('productId').value = product.id;
                document.getElementById('itemName').value = product.name;
                document.getElementById('itemCode').value = product.code;
                document.getElementById('itemStock').value = product.stock;
                document.getElementById('itemBasePrice').value = product.basePrice;
                document.getElementById('itemSellPrice').value = product.sellPrice;
                document.getElementById('itemWholesalePrice').value = product.wholesalePrice;
                document.getElementById('itemCategory').value = product.category;
                document.getElementById('itemDescription').value = product.description;
                document.getElementById('itemPhotoURL').value = product.photo;
                document.getElementById('formTitle').textContent = 'Edit Barang';
                showAddProductForm();
                document.getElementById('photoName').textContent = 'Foto sudah terunggah';
            } else {
                showMessage('Gagal memuat data produk.', true);
            }
        } catch (error) {
            console.error('Error fetching product for edit:', error);
            showMessage('Kesalahan jaringan.', true);
        }
    };

    window.deleteProduct = async (productId) => {
        const confirmDelete = confirm("Apakah Anda yakin ingin menghapus produk ini?");
        if (confirmDelete) {
            try {
                const response = await fetch(CONFIG.SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'delete', id: productId })
                });
                const result = await response.json();
                if (result.status === 'success') {
                    showMessage('Produk berhasil dihapus!');
                    fetchProducts();
                } else {
                    showMessage('Kesalahan: Gagal menghapus produk.', true);
                }
            } catch (error) {
                console.error("Error deleting document:", error);
                showMessage("Kesalahan jaringan saat menghapus produk.", true);
            }
        }
    };
    
    const uploadImage = async (file) => {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CONFIG.CLOUDINARY_UPLOAD_PRESET);

        const response = await fetch(CONFIG.CLOUDINARY_URL, {
            method: 'POST',
            body: formData,
        });

        const data = await response.json();
        return data.secure_url;
    };

    const compressImage = (file) => {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const maxWidth = 800;
                    const quality = 0.8;

                    let width = img.width;
                    let height = img.height;

                    if (width > maxWidth) {
                        height = height * (maxWidth / width);
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;

                    ctx.drawImage(img, 0, 0, width, height);

                    canvas.toBlob((blob) => {
                        if (blob) {
                            const compressedFile = new File([blob], file.name, {
                                type: 'image/jpeg',
                                lastModified: Date.now()
                            });
                            resolve(compressedFile);
                        } else {
                            reject(new Error('Gagal mengompres gambar.'));
                        }
                    }, 'image/jpeg', quality);
                };
            };
            reader.onerror = (error) => reject(error);
            reader.readAsDataURL(file);
        });
    };

    document.getElementById('itemPhotoInput').addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (file) {
            document.getElementById('photoName').textContent = 'Mengunggah dan mengompres...';
            try {
                const compressedFile = await compressImage(file);
                const photoURL = await uploadImage(compressedFile);
                document.getElementById('itemPhotoURL').value = photoURL;
                document.getElementById('photoName').textContent = `Berhasil: ${file.name}`;
                showMessage('Foto berhasil diunggah.');
            } catch (error) {
                console.error('Error uploading image:', error);
                document.getElementById('photoName').textContent = 'Gagal mengunggah foto.';
                showMessage('Gagal mengunggah foto.', true);
            }
        }
    });

    // Deklarasikan variabel di luar fungsi agar bisa diakses secara global
let html5QrCodeScanner;

window.startBarcodeScan = () => {
    const barcodeModal = document.getElementById('barcodeModal');
    const scanResult = document.getElementById('scanResult');
    barcodeModal.classList.remove('hidden');
    scanResult.textContent = 'Memulai pemindai...';

    const html5QrCode = new Html5Qrcode("interactive");
    html5QrCodeScanner = html5QrCode;

    const qrCodeSuccessCallback = (decodedText) => {
        document.getElementById('itemCode').value = decodedText;
        scanResult.textContent = `✅ Barcode: ${decodedText}`;
        showMessage('Barcode berhasil discan!');
        stopBarcodeScan();
    };

    const config = { fps: 10, qrbox: 250 };

    Html5Qrcode.getCameras().then(cameras => {
        if (cameras && cameras.length) {
            const backCamera = cameras.find(c => c.label.toLowerCase().includes('back'));
			const cameraId = backCamera ? backCamera.id : cameras[0].id;


            html5QrCode.start(
				{ facingMode: "environment" },
				config,
				qrCodeSuccessCallback
            ).catch(err => {
                console.error("Gagal memulai kamera:", err);
                scanResult.textContent = `❌ Error: ${err.message}`;
                showMessage('Gagal memulai kamera. Cek console untuk detail.', true);
            });
        } else {
            scanResult.textContent = '❌ Tidak ada kamera ditemukan.';
            showMessage('Tidak ada kamera yang ditemukan.', true);
        }
    }).catch(err => {
        scanResult.textContent = '❌ Gagal mengakses kamera.';
        showMessage('Pastikan izin kamera sudah diberikan.', true);
    });
};

window.stopBarcodeScan = () => {
    const barcodeModal = document.getElementById('barcodeModal');
    // Periksa apakah scanner sedang berjalan sebelum menghentikannya
    if (html5QrCodeScanner && html5QrCodeScanner.isScanning) {
        html5QrCodeScanner.stop().then(() => {
            console.log("QR Code scanning stopped.");
            barcodeModal.classList.add('hidden');
            html5QrCodeScanner = null; // Atur ulang variabel
        }).catch(err => {
            console.error("Gagal menghentikan scanner.", err);
            showMessage("Gagal menghentikan scanner.", true);
            html5QrCodeScanner = null;
        });
    } else {
        barcodeModal.classList.add('hidden');
    }
};

    document.getElementById('productForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const productId = document.getElementById('productId').value;
        const productData = {
            name: document.getElementById('itemName').value,
            code: document.getElementById('itemCode').value,
            stock: parseInt(document.getElementById('itemStock').value),
            basePrice: parseFloat(document.getElementById('itemBasePrice').value),
            sellPrice: parseFloat(document.getElementById('itemSellPrice').value),
            wholesalePrice: parseFloat(document.getElementById('itemWholesalePrice').value || 0),
            category: document.getElementById('itemCategory').value,
            description: document.getElementById('itemDescription').value,
            photo: document.getElementById('itemPhotoURL').value,
        };
        
        try {
            const action = productId ? 'update' : 'create';
            const payload = { action, ...productData, id: productId };
            
            const response = await fetch(CONFIG.SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                showMessage(`Produk berhasil di${productId ? 'perbarui' : 'tambahkan'}!`);
                fetchProducts();
                hideAddProductForm();
            } else {
                showMessage(`Kesalahan: Gagal menyimpan data produk.`, true);
            }
        } catch (error) {
            console.error("Error adding/updating document:", error);
            showMessage("Kesalahan jaringan saat menyimpan data.", true);
        }
    });

    document.getElementById('menu-toggle').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('open');
    });

    document.getElementById('addProductBtn').addEventListener('click', showAddProductForm);
    
    setInterval(fetchProducts, 5000);
    fetchProducts();
</script>
</body>
</html>
