<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem MBG Enterprise - Akuntansi & Manajerial</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; }
            .shadow-lg, .shadow-sm, .border { box-shadow: none !important; border: none !important; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            table { width: 100% !important; }
            thead { display: table-header-group; } 
            tr { page-break-inside: avoid; }
        }
        .print-only { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- UTILS ---
        const formatRupiah = (num) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(num);
        
        const downloadCSV = (data, filename) => {
            if (!data || data.length === 0) { alert("Tidak ada data untuk diunduh."); return; }
            const headers = Object.keys(data[0]);
            const csvRows = [];
            csvRows.push(headers.join(','));
            for (const row of data) {
                const values = headers.map(header => {
                    const escaped = ('' + row[header]).replace(/"/g, '\\"');
                    return `"${escaped}"`;
                });
                csvRows.push(values.join(','));
            }
            const blob = new Blob([csvRows.join('\n')], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', filename + '.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        };

        // --- ICONS ---
        const Icon = ({ path, size=18 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{path}</svg>;
        const Icons = {
            Dashboard: <Icon path={<><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></>} />,
            FileText: <Icon path={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></>} />,
            DollarSign: <Icon path={<><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></>} />,
            Package: <Icon path={<><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22v-10"/></>} />,
            Printer: <Icon path={<><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></>} />,
            Trash2: <Icon path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            PlusCircle: <Icon path={<><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></>} />,
            MapPin: <Icon path={<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></>} />,
            Banknote: <Icon path={<><rect width="20" height="12" x="2" y="6" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></>} />,
            Download: <Icon path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
            Wallet: <Icon path={<><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"/></>} />,
            RefreshCw: <Icon path={<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></>} />,
            XCircle: <Icon path={<><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></>} />,
            Share: <Icon path={<><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></>} />,
            Chart: <Icon path={<><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></>} />,
            Calculator: <Icon path={<><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></>} />
        };

        // --- DATA GENERATION (6 MONTHS) ---
        const generateData = () => {
            const cashIn = [];
            const expenses = [];
            const employees = [
                { id: 'e1', name: 'Budi Santoso', role: 'Kepala Dapur', type: 'Bulanan', basicRate: 5000000, overtimeRate: 35000, taxRate: 5, phone: '628111111' },
                { id: 'e2', name: 'Siti Aminah', role: 'Ahli Gizi', type: 'Bulanan', basicRate: 4500000, overtimeRate: 30000, taxRate: 5, phone: '628111112' },
                { id: 'e3', name: 'Rudi Hartono', role: 'Admin Keuangan', type: 'Bulanan', basicRate: 4000000, overtimeRate: 25000, taxRate: 0, phone: '628111113' },
                { id: 'e4', name: 'Joko Susilo', role: 'Driver Logistik', type: 'Harian', basicRate: 150000, overtimeRate: 20000, taxRate: 0, phone: '628111114' },
                { id: 'e5', name: 'Bambang Pamungkas', role: 'Driver Logistik', type: 'Harian', basicRate: 150000, overtimeRate: 20000, taxRate: 0, phone: '628111115' },
                { id: 'e6', name: 'Dewi Sartika', role: 'Juru Masak', type: 'Harian', basicRate: 130000, overtimeRate: 15000, taxRate: 0, phone: '628111116' },
                { id: 'e7', name: 'Rina Nose', role: 'Juru Masak', type: 'Harian', basicRate: 130000, overtimeRate: 15000, taxRate: 0, phone: '628111117' },
                { id: 'e8', name: 'Tuti Wibowo', role: 'Juru Masak', type: 'Harian', basicRate: 130000, overtimeRate: 15000, taxRate: 0, phone: '628111118' },
                { id: 'e9', name: 'Susi Susanti', role: 'Juru Masak', type: 'Harian', basicRate: 130000, overtimeRate: 15000, taxRate: 0, phone: '628111119' },
                { id: 'e10', name: 'Anto Wijaya', role: 'Helper', type: 'Harian', basicRate: 100000, overtimeRate: 10000, taxRate: 0, phone: '628111120' },
                { id: 'e11', name: 'Budi Sudarsono', role: 'Helper', type: 'Harian', basicRate: 100000, overtimeRate: 10000, taxRate: 0, phone: '628111121' },
                { id: 'e12', name: 'Caca Handika', role: 'Helper', type: 'Harian', basicRate: 100000, overtimeRate: 10000, taxRate: 0, phone: '628111122' },
                { id: 'e13', name: 'Dedi Dores', role: 'Helper', type: 'Harian', basicRate: 100000, overtimeRate: 10000, taxRate: 0, phone: '628111123' },
                { id: 'e14', name: 'Eko Patrio', role: 'Helper', type: 'Harian', basicRate: 100000, overtimeRate: 10000, taxRate: 0, phone: '628111124' },
                { id: 'e15', name: 'Ferry Salim', role: 'Helper', type: 'Harian', basicRate: 100000, overtimeRate: 10000, taxRate: 0, phone: '628111125' }
            ];
            const attendance = [];

            const months = ['2025-06', '2025-07', '2025-08', '2025-09', '2025-10', '2025-11'];
            // Estimasi: 3000 anak x 15.000 x 22 hari = 990.000.000 + Operasional
            const budgetPerMonth = 1100000000; 

            months.forEach(month => {
                // Cash In (Dropping)
                cashIn.push({
                    id: Date.now() + Math.random(),
                    date: `${month}-01`,
                    desc: `Dropping Dana BGN Bulan ${month}`,
                    code: '4.1.1.01',
                    amount: budgetPerMonth,
                    ref: `TRF-${month.replace('-','')}`
                });

                // Expenses (Simulasi Belanja)
                for(let i=1; i<=4; i++) {
                    const day = i*5;
                    const dateStr = `${month}-${day.toString().padStart(2,'0')}`;
                    
                    expenses.push({id: Math.random(), date: dateStr, item: 'Beras Premium', category: '5.2.2.03', qty: 1500, unit: 'kg', price: 13500, total: 20250000, tax: 0, type: 'Stok', vendor: 'Bulog'});
                    expenses.push({id: Math.random(), date: dateStr, item: 'Ayam/Daging/Telur', category: '5.2.2.01', qty: 1000, unit: 'kg', price: 35000, total: 35000000, tax: 0, type: 'Habis Pakai', vendor: 'Supplier Lokal'});
                    expenses.push({id: Math.random(), date: dateStr, item: 'Sayur Mayur', category: '5.2.2.02', qty: 500, unit: 'ikat', price: 5000, total: 2500000, tax: 0, type: 'Habis Pakai', vendor: 'Pasar Induk'});
                    expenses.push({id: Math.random(), date: dateStr, item: 'Gas & Bumbu', category: '5.2.2.04', qty: 1, unit: 'paket', price: 5000000, total: 5000000, tax: 0, type: 'Habis Pakai', vendor: 'Toko Kelontong'});
                }

                // Attendance Dummy
                employees.forEach(emp => {
                    attendance.push({
                        id: Math.random(),
                        employeeId: emp.id,
                        date: `${month}-25`, 
                        status: 'Hadir',
                        overtime: Math.random() > 0.8 ? 2 : 0
                    });
                });
            });

            return { cashIn, expenses, employees, attendance };
        };

        const INITIAL_DATA = generateData();
        const INITIAL_STOCK = [
            { id: 'stk_1', name: 'Beras Premium', unit: 'kg', in: 9000, out: 8500, current: 500 },
            { id: 'stk_2', name: 'Minyak Goreng', unit: 'liter', in: 2000, out: 1800, current: 200 },
            { id: 'stk_3', name: 'Tepung Terigu', unit: 'kg', in: 500, out: 400, current: 100 },
            { id: 'stk_4', name: 'Gula Pasir', unit: 'kg', in: 300, out: 250, current: 50 },
        ];

        const COA = {
            '4.1.1.01': 'Pendapatan Dropping Dana (APBN)',
            '5.2.2.01': 'Belanja Bahan Makanan (Protein)',
            '5.2.2.02': 'Belanja Bahan Makanan (Sayur/Buah)',
            '5.2.2.03': 'Belanja Bahan Makanan (Beras)',
            '5.2.2.04': 'Belanja Bumbu & Gas',
            '5.2.2.11': 'Belanja Operasional (Sewa/Listrik)',
            '5.2.3.27': 'Belanja Modal Peralatan (Aset)',
            '5.1.1.01': 'Belanja Pegawai (Gaji Pokok)',
            '5.1.1.02': 'Belanja Pegawai (Lembur)'
        };

        // --- MAIN COMPONENT ---
        function MBGEnterpriseFinal() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [period, setPeriod] = useState('2025-11');
            
            // Persistent State Hook
            const useStickyState = (key, defaultValue) => {
                const [value, setValue] = useState(() => {
                    const stickyValue = window.localStorage.getItem(key);
                    return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
                });
                useEffect(() => { window.localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
                return [value, setValue];
            };

            // Initialize Data
            const [cashIn, setCashIn] = useStickyState('mbg_v4_cash', INITIAL_DATA.cashIn);
            const [expenses, setExpenses] = useStickyState('mbg_v4_exp', INITIAL_DATA.expenses);
            const [employees, setEmployees] = useStickyState('mbg_v4_emp', INITIAL_DATA.employees);
            const [attendanceData, setAttendanceData] = useStickyState('mbg_v4_att', INITIAL_DATA.attendance);
            const [stockData, setStockData] = useStickyState('mbg_v4_stock', INITIAL_STOCK);
            const [budgetLimit] = useState(1100000000); // Pagu Bulanan

            // Chart Filters
            const [chartStart, setChartStart] = useState('2025-06');
            const [chartEnd, setChartEnd] = useState('2025-11');

            // Forms
            const [expenseForm, setExpenseForm] = useState({ item: '', category: '5.2.2.01', qty: 1, unit: 'kg', price: 0, vendor: '', tax: 0, type: 'Habis Pakai', date: new Date().toISOString().split('T')[0] });
            const [cashInForm, setCashInForm] = useState({ date: new Date().toISOString().split('T')[0], desc: '', amount: 0, ref: '' });
            const [stockUsageForm, setStockUsageForm] = useState({ id: '', qty: 0 });
            const [selectedSlip, setSelectedSlip] = useState(null);

            // --- CALCULATIONS ---
            
            // Payroll Calculation Helper
            const calculatePayroll = (dataEmployees, dataAttendance, targetPeriod) => {
                return dataEmployees.map(emp => {
                    // Simplified calculation for demo purposes assuming full attendance for historical data
                    const days = 22; 
                    const otHours = 10; 
                    const basic = emp.type === 'Harian' ? days * emp.basicRate : emp.basicRate;
                    const otPay = otHours * emp.overtimeRate;
                    const gross = basic + otPay;
                    const tax = gross * (emp.taxRate / 100);
                    return { ...emp, gross, tax, net: gross - tax, days, otHours };
                });
            };

            const currentPayrollData = useMemo(() => calculatePayroll(employees, attendanceData, period), [employees, attendanceData, period]);
            
            // Total ALL TIME Payroll (Estimate for Dashboard Summary)
            const totalAllTimePayroll = useMemo(() => {
                // Rough estimate: Total months in data * monthly payroll
                const monthlyPay = employees.reduce((sum, emp) => {
                    const basic = emp.type === 'Harian' ? 22 * emp.basicRate : emp.basicRate;
                    return sum + basic + (10 * emp.overtimeRate);
                }, 0);
                // Calculate how many unique months exist in cashIn as a proxy for active months
                const uniqueMonths = new Set(cashIn.map(c => c.date.slice(0,7))).size;
                return monthlyPay * uniqueMonths;
            }, [employees, cashIn]);

            // Dashboard Data (ALL TIME)
            const dashboardSummary = useMemo(() => {
                const totalIn = cashIn.reduce((a,b)=>a+b.amount, 0);
                const totalExp = expenses.reduce((a,b)=>a+b.total, 0);
                const balance = totalIn - totalExp - totalAllTimePayroll;
                return { totalIn, totalExp, totalAllTimePayroll, balance };
            }, [cashIn, expenses, totalAllTimePayroll]);

            // Chart Data (Filtered)
            const chartData = useMemo(() => {
                // Generate months between start and end
                const start = new Date(chartStart + '-01');
                const end = new Date(chartEnd + '-01');
                const data = [];
                
                for (let d = new Date(start); d <= end; d.setMonth(d.getMonth() + 1)) {
                    const m = d.toISOString().slice(0, 7); // YYYY-MM
                    
                    const inc = cashIn.filter(c => c.date.startsWith(m)).reduce((a,b)=>a+b.amount,0);
                    const exp = expenses.filter(e => e.date.startsWith(m)).reduce((a,b)=>a+b.total,0);
                    // Add estimated payroll for that month
                    const pay = employees.reduce((sum, emp) => {
                        const basic = emp.type === 'Harian' ? 22 * emp.basicRate : emp.basicRate;
                        return sum + basic + (10 * emp.overtimeRate);
                    }, 0);

                    data.push({ month: m, income: inc, expense: exp + pay });
                }
                return data;
            }, [chartStart, chartEnd, cashIn, expenses, employees]);

            // LRA Data (Period Specific)
            const lraData = useMemo(() => {
                const incomes = cashIn.filter(c => c.date.startsWith(period)).map(c => ({...c, group: 'Pendapatan'}));
                const expItems = expenses.filter(e => e.date.startsWith(period)).map(e => ({
                    date: e.date, desc: `${e.item} (${e.qty} ${e.unit})`, code: e.category, amount: e.total, group: 'Belanja'
                }));
                
                const payrollTotal = currentPayrollData.reduce((a,b)=>a+b.gross,0);
                const payrollExp = [{
                    date: `${period}-28`, desc: `Realisasi Gaji Pegawai (${employees.length} Org)`, code: '5.1.1.01', amount: payrollTotal, group: 'Belanja'
                }];

                return { incomes, expenses: [...expItems, ...payrollExp] };
            }, [cashIn, expenses, period, currentPayrollData, employees]);

            // Budgeting Realization (Current Period) for Dashboard
            const currentPeriodRealization = useMemo(() => {
                const exp = expenses.filter(e => e.date.startsWith(period)).reduce((a,b)=>a+b.total,0);
                const pay = currentPayrollData.reduce((a,b)=>a+b.gross,0);
                return exp + pay;
            }, [expenses, currentPayrollData, period]);


            // --- HANDLERS ---
            const handleAddCashIn = (e) => {
                e.preventDefault();
                setCashIn([...cashIn, { id: Date.now(), ...cashInForm, amount: Number(cashInForm.amount), code: '4.1.1.01' }]);
                setCashInForm({ date: new Date().toISOString().split('T')[0], desc: '', amount: 0, ref: '' });
                alert('Dana Masuk Tercatat!');
            };

            const handleAddExpense = (e) => {
                e.preventDefault();
                const total = Number(expenseForm.qty) * Number(expenseForm.price);
                setExpenses([{ id: Date.now(), ...expenseForm, qty: Number(expenseForm.qty), price: Number(expenseForm.price), tax: Number(expenseForm.tax), total }, ...expenses]);
                
                if (expenseForm.type === 'Stok') {
                    const existing = stockData.find(s => s.name.toLowerCase() === expenseForm.item.toLowerCase());
                    if (existing) {
                        setStockData(stockData.map(s => s.id === existing.id ? { ...s, in: s.in + Number(expenseForm.qty), current: s.current + Number(expenseForm.qty) } : s));
                    } else {
                        setStockData([...stockData, { id: `stk_${Date.now()}`, name: expenseForm.item, unit: expenseForm.unit, in: Number(expenseForm.qty), out: 0, current: Number(expenseForm.qty) }]);
                    }
                }
                setExpenseForm({ ...expenseForm, item: '', qty: 1, price: 0, tax: 0 });
                alert('Belanja Tercatat!');
            };

            const handleUseStock = (e) => {
                e.preventDefault();
                setStockData(stockData.map(s => s.id === stockUsageForm.id ? { ...s, out: s.out + Number(stockUsageForm.qty), current: s.current - Number(stockUsageForm.qty) } : s));
                alert('Stok Terupdate');
            };

            const shareSlip = (emp) => {
                const text = `Slip Gaji ${period}\nNama: ${emp.name}\nTHP: ${formatRupiah(emp.net)}`;
                window.open(`https://wa.me/${emp.phone}?text=${encodeURIComponent(text)}`, '_blank');
            };

            return (
                <div className="min-h-screen bg-gray-50 pb-24">
                    {/* HEADER */}
                    <header className="bg-emerald-900 text-white p-4 sticky top-0 z-30 shadow-md no-print">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-white/10 p-2 rounded">{Icons.FileText}</div>
                                <div><h1 className="font-bold text-lg leading-tight">Sistem MBG Enterprise</h1><p className="text-xs text-emerald-300">Target: 3000 Anak | 15 Karyawan</p></div>
                            </div>
                            <button onClick={() => {if(confirm("Reset Data?")) {localStorage.clear(); window.location.reload()}}} className="bg-red-600 px-3 py-2 rounded text-xs hover:bg-red-700 flex gap-1">{Icons.RefreshCw} Reset</button>
                        </div>
                    </header>

                    {/* NAV */}
                    <div className="bg-white border-b sticky top-[76px] z-20 overflow-x-auto shadow-sm no-print scrollbar-hide">
                        <div className="max-w-7xl mx-auto flex px-2">
                            {[
                                {id:'dashboard', label:'Dashboard', icon: Icons.Dashboard},
                                {id:'kas', label:'Kas & Bank', icon: Icons.Wallet},
                                {id:'keuangan', label:'Belanja', icon: Icons.DollarSign},
                                {id:'lra', label:'Laporan LRA', icon: Icons.FileText},
                                {id:'stok', label:'Stok', icon: Icons.Package},
                                {id:'gaji', label:'Payroll', icon: Icons.Banknote},
                                {id:'absensi', label:'Absensi HP', icon: Icons.MapPin},
                            ].map(t => (
                                <button key={t.id} onClick={()=>setActiveTab(t.id)} className={`flex-shrink-0 flex items-center gap-2 px-6 py-4 border-b-2 text-sm font-medium transition-colors whitespace-nowrap ${activeTab===t.id ? 'border-emerald-600 text-emerald-800 bg-emerald-50' : 'border-transparent text-gray-500 hover:text-emerald-600'}`}>
                                    {t.icon} {t.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    <main className="max-w-7xl mx-auto p-4 mt-4">
                        
                        {/* DASHBOARD */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6 animate-in fade-in">
                                <div className="flex justify-between items-center no-print">
                                    <h2 className="text-xl font-bold text-gray-800">Ikhtisar Keuangan (All Time)</h2>
                                    <button onClick={() => downloadCSV(chartData, 'Dashboard_Summary')} className="bg-green-600 text-white px-4 py-2 rounded text-sm flex gap-2 hover:bg-green-700">{Icons.Download} Unduh Data</button>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="bg-white p-6 rounded-xl border shadow-sm">
                                        <div className="flex justify-between">
                                            <div><p className="text-gray-500 text-sm font-bold">Total Dana Masuk</p><p className="text-xs text-gray-400">Akumulasi Seluruh Periode</p></div>
                                            <div className="text-green-600">{Icons.DollarSign}</div>
                                        </div>
                                        <p className="text-2xl font-bold text-gray-800 mt-2">{formatRupiah(dashboardSummary.totalIn)}</p>
                                    </div>
                                    <div className="bg-white p-6 rounded-xl border shadow-sm">
                                        <div className="flex justify-between">
                                            <div><p className="text-gray-500 text-sm font-bold">Total Belanja & Gaji</p><p className="text-xs text-gray-400">Akumulasi Seluruh Periode</p></div>
                                            <div className="text-red-600">{Icons.Chart}</div>
                                        </div>
                                        <p className="text-2xl font-bold text-red-600 mt-2">{formatRupiah(dashboardSummary.totalExp + dashboardSummary.totalAllTimePayroll)}</p>
                                    </div>
                                    <div className="bg-emerald-800 text-white p-6 rounded-xl shadow-lg">
                                        <div className="flex justify-between">
                                            <div><p className="text-emerald-200 text-sm font-bold">Sisa Saldo Kas</p><p className="text-xs text-emerald-300">Dana Tunai/Bank Saat Ini</p></div>
                                            <div className="text-white">{Icons.Wallet}</div>
                                        </div>
                                        <p className="text-3xl font-bold mt-2">{formatRupiah(dashboardSummary.balance)}</p>
                                    </div>
                                </div>

                                {/* BUDGETING BAR (RESTORED) */}
                                <div className="bg-white p-6 rounded-xl border shadow-sm">
                                    <div className="flex justify-between items-center mb-2">
                                        <h3 className="font-bold text-gray-700">Realisasi Anggaran (Bulan {period})</h3>
                                        <span className="text-xs bg-gray-100 px-2 py-1 rounded">Pagu: {formatRupiah(budgetLimit)}</span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-6 mb-2">
                                        <div className={`h-6 rounded-full transition-all duration-500 ${currentPeriodRealization > budgetLimit ? 'bg-red-600' : 'bg-blue-600'}`} style={{width: `${Math.min((currentPeriodRealization/budgetLimit)*100, 100)}%`}}></div>
                                    </div>
                                    <div className="flex justify-between text-sm font-bold">
                                        <span className="text-blue-700">Terpakai: {formatRupiah(currentPeriodRealization)} ({(currentPeriodRealization/budgetLimit*100).toFixed(1)}%)</span>
                                        <span className="text-gray-500">Sisa: {formatRupiah(budgetLimit - currentPeriodRealization)}</span>
                                    </div>
                                </div>

                                {/* CHART FILTERS & CHART */}
                                <div className="bg-white p-6 rounded-xl border shadow-sm">
                                    <div className="flex flex-wrap justify-between items-center mb-6 gap-4">
                                        <h3 className="font-bold">Grafik Arus Kas</h3>
                                        <div className="flex gap-2 items-center bg-gray-50 p-2 rounded text-sm">
                                            <span>Periode:</span>
                                            <input type="month" value={chartStart} onChange={e=>setChartStart(e.target.value)} className="border rounded p-1"/>
                                            <span>s/d</span>
                                            <input type="month" value={chartEnd} onChange={e=>setChartEnd(e.target.value)} className="border rounded p-1"/>
                                        </div>
                                    </div>
                                    <div className="flex items-end h-64 gap-2 md:gap-8 pb-2 border-b">
                                        {chartData.map((d, i) => (
                                            <div key={i} className="flex-1 flex flex-col justify-end items-center gap-1 group relative h-full">
                                                <div className="w-full flex justify-center gap-1 h-full items-end">
                                                    <div style={{height: `${(d.income/1500000000)*100}%`}} className="w-4 md:w-8 bg-emerald-500 rounded-t hover:bg-emerald-600 transition-all relative group-hover:opacity-90" title={`Masuk: ${formatRupiah(d.income)}`}></div>
                                                    <div style={{height: `${(d.expense/1500000000)*100}%`}} className="w-4 md:w-8 bg-red-500 rounded-t hover:bg-red-600 transition-all relative group-hover:opacity-90" title={`Keluar: ${formatRupiah(d.expense)}`}></div>
                                                </div>
                                                <span className="text-[10px] font-bold text-gray-500 mt-2">{d.month.split('-')[1]}</span>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex justify-center gap-4 mt-4 text-sm">
                                        <div className="flex items-center gap-2"><div className="w-3 h-3 bg-emerald-500"></div> Pemasukan</div>
                                        <div className="flex items-center gap-2"><div className="w-3 h-3 bg-red-500"></div> Pengeluaran</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* KAS */}
                        {activeTab === 'kas' && (
                            <div className="space-y-6">
                                {/* INPUT FORM RESTORED */}
                                <div className="bg-white p-5 rounded-xl border shadow-sm no-print">
                                    <h3 className="font-bold mb-4 flex items-center gap-2 text-green-700">{Icons.PlusCircle} Input Kas Masuk (Dana)</h3>
                                    <form onSubmit={handleAddCashIn} className="grid md:grid-cols-5 gap-4 items-end">
                                        <div className="md:col-span-1 space-y-1">
                                            <label className="text-xs font-bold text-gray-500">Tanggal</label>
                                            <input type="date" required className="w-full border p-2 rounded text-sm" value={cashInForm.date} onChange={e=>setCashInForm({...cashInForm, date:e.target.value})}/>
                                        </div>
                                        <div className="md:col-span-2 space-y-1">
                                            <label className="text-xs font-bold text-gray-500">Uraian (Sumber Dana)</label>
                                            <input type="text" placeholder="Contoh: Dropping APBN Tahap 2" required className="w-full border p-2 rounded text-sm" value={cashInForm.desc} onChange={e=>setCashInForm({...cashInForm, desc:e.target.value})}/>
                                        </div>
                                        <div className="md:col-span-1 space-y-1">
                                            <label className="text-xs font-bold text-gray-500">Jumlah (Rp)</label>
                                            <input type="number" placeholder="0" required className="w-full border p-2 rounded text-sm font-bold text-green-700" value={cashInForm.amount} onChange={e=>setCashInForm({...cashInForm, amount:e.target.value})}/>
                                        </div>
                                        <button className="bg-green-700 text-white py-2 rounded font-bold shadow hover:bg-green-800 h-10">Simpan</button>
                                    </form>
                                </div>

                                <div className="bg-white p-4 rounded-xl border shadow-sm flex justify-between items-center no-print">
                                    <h3 className="font-bold text-gray-700">Buku Kas Umum</h3>
                                    <div className="flex gap-2">
                                        <button onClick={()=>downloadCSV(cashIn, 'Data_Kas_Masuk')} className="bg-green-600 text-white px-3 py-2 rounded text-sm flex items-center gap-2">{Icons.Download} Excel</button>
                                        <button onClick={()=>window.print()} className="bg-gray-800 text-white px-3 py-2 rounded text-sm flex items-center gap-2">{Icons.Printer} PDF</button>
                                    </div>
                                </div>
                                <div className="bg-white rounded-xl border overflow-hidden print:shadow-none print:border-0">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-gray-100 text-gray-700 font-bold"><tr><th className="p-3">Tanggal</th><th className="p-3">Uraian</th><th className="p-3">Kode Akun</th><th className="p-3 text-right">Jumlah</th></tr></thead>
                                        <tbody>
                                            {cashIn.sort((a,b)=>new Date(b.date)-new Date(a.date)).map(c => (
                                                <tr key={c.id} className="border-b hover:bg-gray-50">
                                                    <td className="p-3">{c.date}</td>
                                                    <td className="p-3">{c.desc} <span className="text-xs text-gray-400 block">{c.ref}</span></td>
                                                    <td className="p-3"><span className="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">{c.code}</span></td>
                                                    <td className="p-3 text-right font-bold text-emerald-700">{formatRupiah(c.amount)}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* BELANJA */}
                        {activeTab === 'keuangan' && (
                            <div className="space-y-6">
                                <div className="grid md:grid-cols-3 gap-6 no-print">
                                    <div className="md:col-span-1 bg-white p-5 rounded-xl border shadow-sm h-fit">
                                        <h3 className="font-bold mb-4 flex items-center gap-2 text-red-700">{Icons.PlusCircle} Input Belanja</h3>
                                        <form onSubmit={handleAddExpense} className="space-y-3 text-sm">
                                            <div className="space-y-1"><label className="text-xs font-bold text-gray-500">Tanggal</label><input type="date" required className="w-full border p-2 rounded" value={expenseForm.date} onChange={e=>setExpenseForm({...expenseForm, date:e.target.value})}/></div>
                                            <div className="space-y-1"><label className="text-xs font-bold text-gray-500">Kode Akun (COA)</label><select className="w-full border p-2 rounded bg-indigo-50 font-bold" value={expenseForm.category} onChange={e=>setExpenseForm({...expenseForm, category:e.target.value})}>{Object.entries(COA).filter(([k])=>k.startsWith('5')).map(([k,v])=><option key={k} value={k}>{k} - {v}</option>)}</select></div>
                                            <div className="space-y-1"><label className="text-xs font-bold text-gray-500">Jenis Belanja</label><select className="w-full border p-2 rounded" value={expenseForm.type} onChange={e=>setExpenseForm({...expenseForm, type:e.target.value})}><option value="Habis Pakai">Habis Pakai</option><option value="Stok">Masuk Stok</option><option value="Aset">Aset Tetap</option></select></div>
                                            <div className="space-y-1"><label className="text-xs font-bold text-gray-500">Nama Barang</label><input type="text" placeholder="Nama Barang" required className="w-full border p-2 rounded" value={expenseForm.item} onChange={e=>setExpenseForm({...expenseForm, item:e.target.value})}/></div>
                                            <div className="grid grid-cols-2 gap-2"><div><label className="text-xs font-bold text-gray-500">Qty</label><input type="number" placeholder="Qty" required className="w-full border p-2 rounded" value={expenseForm.qty} onChange={e=>setExpenseForm({...expenseForm, qty:e.target.value})}/></div><div><label className="text-xs font-bold text-gray-500">Satuan</label><input type="text" placeholder="Unit" required className="w-full border p-2 rounded" value={expenseForm.unit} onChange={e=>setExpenseForm({...expenseForm, unit:e.target.value})}/></div></div>
                                            <div className="space-y-1"><label className="text-xs font-bold text-gray-500">Harga Satuan</label><input type="number" placeholder="Harga Satuan" required className="w-full border p-2 rounded" value={expenseForm.price} onChange={e=>setExpenseForm({...expenseForm, price:e.target.value})}/></div>
                                            <button className="w-full bg-red-700 text-white py-2 rounded font-bold hover:bg-red-800">Simpan</button>
                                        </form>
                                    </div>
                                    <div className="md:col-span-2 bg-white rounded-xl border shadow-sm overflow-hidden">
                                        <div className="p-4 border-b flex justify-between items-center bg-gray-50"><h3 className="font-bold">Riwayat Belanja</h3><button onClick={()=>downloadCSV(expenses, 'Data_Belanja')} className="text-xs bg-green-600 text-white px-3 py-1 rounded flex items-center gap-1">{Icons.Download} Excel</button></div>
                                        <div className="overflow-x-auto h-[500px]">
                                            <table className="w-full text-sm text-left">
                                                <thead className="bg-gray-100 sticky top-0"><tr><th className="p-3">Tanggal</th><th className="p-3">Uraian</th><th className="p-3">Akun</th><th className="p-3 text-right">Total</th></tr></thead>
                                                <tbody>
                                                    {expenses.sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0, 50).map(e => (
                                                        <tr key={e.id} className="border-b hover:bg-gray-50">
                                                            <td className="p-3">{e.date}</td>
                                                            <td className="p-3">{e.item}<br/><span className="text-xs text-gray-500">{e.vendor}</span></td>
                                                            <td className="p-3 text-xs"><span className="bg-indigo-100 text-indigo-800 px-2 py-1 rounded">{e.category}</span></td>
                                                            <td className="p-3 text-right font-mono">{formatRupiah(e.total)}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* LRA */}
                        {activeTab === 'lra' && (
                            <div className="bg-white p-8 rounded-xl border shadow-sm">
                                <div className="flex justify-between items-center mb-6 no-print">
                                    <h2 className="font-bold text-xl">Laporan Realisasi Anggaran</h2>
                                    <div className="flex gap-2">
                                        <input type="month" value={period} onChange={e=>setPeriod(e.target.value)} className="border rounded p-2"/>
                                        <button onClick={()=>downloadCSV([...lraData.incomes, ...lraData.expenses], 'LRA_Data')} className="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 flex items-center gap-2">{Icons.Download} Excel</button>
                                        <button onClick={()=>window.print()} className="bg-gray-800 text-white px-4 py-2 rounded text-sm hover:bg-gray-900 flex items-center gap-2">{Icons.Printer} PDF</button>
                                    </div>
                                </div>
                                <div className="text-center mb-8 print:block hidden">
                                    <h1 className="text-2xl font-bold uppercase">Laporan Realisasi Anggaran</h1>
                                    <p>Periode: {period}</p>
                                </div>
                                <table className="w-full text-sm border-collapse border border-gray-300">
                                    <thead><tr className="bg-gray-100"><th className="border p-2 text-left">Kode</th><th className="border p-2 text-left">Uraian</th><th className="border p-2 text-right">Jumlah</th></tr></thead>
                                    <tbody>
                                        <tr className="bg-green-50 font-bold"><td colSpan="3" className="border p-2">PENDAPATAN</td></tr>
                                        {lraData.incomes.length > 0 ? lraData.incomes.map((inc,i) => <tr key={i}><td className="border p-2 text-center">{inc.code}</td><td className="border p-2">{inc.desc}</td><td className="border p-2 text-right">{formatRupiah(inc.amount)}</td></tr>) : <tr><td colSpan="3" className="border p-2 text-center text-gray-400">Tidak ada pendapatan di periode ini</td></tr>}
                                        <tr className="bg-gray-50 font-bold"><td colSpan="2" className="border p-2 text-right">Total Pendapatan</td><td className="border p-2 text-right">{formatRupiah(lraData.incomes.reduce((a,b)=>a+b.amount,0))}</td></tr>
                                        
                                        <tr className="bg-red-50 font-bold"><td colSpan="3" className="border p-2">BELANJA</td></tr>
                                        {lraData.expenses.map((exp,i) => <tr key={i}><td className="border p-2 text-center">{exp.code}</td><td className="border p-2">{exp.desc}</td><td className="border p-2 text-right">{formatRupiah(exp.amount)}</td></tr>)}
                                        <tr className="bg-gray-50 font-bold"><td colSpan="2" className="border p-2 text-right">Total Belanja</td><td className="border p-2 text-right">{formatRupiah(lraData.expenses.reduce((a,b)=>a+b.amount,0))}</td></tr>

                                        <tr className="bg-emerald-900 text-white font-bold text-lg"><td colSpan="2" className="border p-3 text-right">SURPLUS / (DEFISIT)</td><td className="border p-3 text-right">{formatRupiah(lraData.incomes.reduce((a,b)=>a+b.amount,0) - lraData.expenses.reduce((a,b)=>a+b.amount,0))}</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {/* STOK */}
                        {activeTab === 'stok' && (
                            <div className="space-y-6">
                                <div className="grid md:grid-cols-3 gap-4">
                                    <div className="bg-white p-6 rounded-xl border shadow-sm md:col-span-2">
                                        <div className="flex justify-between mb-4 items-center"><h3 className="font-bold text-gray-700">Posisi Stok Gudang (6 Bulan Terakhir)</h3> <button onClick={()=>downloadCSV(stockData,'Data_Stok')} className="text-xs bg-green-600 text-white px-3 py-1 rounded">{Icons.Download} Excel</button></div>
                                        <table className="w-full text-sm text-left">
                                            <thead className="bg-gray-100"><tr><th className="p-3">Barang</th><th className="p-3 text-center">Total Masuk</th><th className="p-3 text-center">Total Keluar</th><th className="p-3 text-center bg-yellow-50">Sisa Fisik</th></tr></thead>
                                            <tbody>
                                                {stockData.map(s => (
                                                    <tr key={s.id} className="border-b hover:bg-gray-50">
                                                        <td className="p-3 font-bold">{s.name} <span className="font-normal text-gray-500">({s.unit})</span></td>
                                                        <td className="p-3 text-center text-green-600">+{s.in}</td>
                                                        <td className="p-3 text-center text-red-500">-{s.out}</td>
                                                        <td className="p-3 text-center font-bold bg-yellow-50">{s.current}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    <div className="bg-white p-6 rounded-xl border shadow-sm h-fit">
                                        <h3 className="font-bold mb-4 text-orange-600 flex items-center gap-2">{Icons.Package} Catat Pemakaian</h3>
                                        <form onSubmit={handleUseStock} className="space-y-3">
                                            <select className="w-full border p-2 rounded" required onChange={e=>setStockUsageForm({...stockUsageForm, id:e.target.value})}>
                                                <option value="">Pilih Barang</option>
                                                {stockData.map(s=><option key={s.id} value={s.id}>{s.name}</option>)}
                                            </select>
                                            <input type="number" placeholder="Qty Keluar" className="w-full border p-2 rounded" onChange={e=>setStockUsageForm({...stockUsageForm, qty:e.target.value})}/>
                                            <button className="w-full bg-orange-600 text-white py-2 rounded font-bold hover:bg-orange-700">Simpan</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* PAYROLL */}
                        {activeTab === 'gaji' && (
                            <div className="space-y-6">
                                <div className="bg-white p-4 rounded-xl border shadow-sm flex justify-between items-center no-print">
                                    <div className="flex items-center gap-4">
                                        <h3 className="font-bold text-gray-700">Payroll Management</h3>
                                        <input type="month" value={period} onChange={e=>setPeriod(e.target.value)} className="border p-1 rounded text-sm"/>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={()=>downloadCSV(currentPayrollData, 'Payroll_'+period)} className="bg-green-600 text-white px-3 py-2 rounded text-sm flex items-center gap-2">{Icons.Download} Excel</button>
                                        <button onClick={()=>window.print()} className="bg-gray-800 text-white px-3 py-2 rounded text-sm flex items-center gap-2">{Icons.Printer} Cetak</button>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl border overflow-hidden print:shadow-none print:border-0">
                                    <div className="print:block hidden text-center mb-4 font-bold text-xl">REKAPITULASI GAJI PERIODE {period}</div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left">
                                            <thead className="bg-indigo-900 text-white">
                                                <tr>
                                                    <th className="p-3">Nama Karyawan</th>
                                                    <th className="p-3">Jabatan</th>
                                                    <th className="p-3 text-center">Kehadiran</th>
                                                    <th className="p-3 text-center">Lembur (Jam)</th>
                                                    <th className="p-3 text-right">Gaji Bruto</th>
                                                    <th className="p-3 text-right">Pajak</th>
                                                    <th className="p-3 text-right bg-indigo-800">THP (Bersih)</th>
                                                    <th className="p-3 text-center no-print">Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {currentPayrollData.map((emp, idx) => (
                                                    <tr key={idx} className="border-b hover:bg-gray-50">
                                                        <td className="p-3 font-bold">{emp.name}</td>
                                                        <td className="p-3 text-gray-600">{emp.role}</td>
                                                        <td className="p-3 text-center">{emp.days} Hari</td>
                                                        <td className="p-3 text-center">{emp.otHours}</td>
                                                        <td className="p-3 text-right">{formatRupiah(emp.gross)}</td>
                                                        <td className="p-3 text-right text-red-500">({formatRupiah(emp.tax)})</td>
                                                        <td className="p-3 text-right font-bold text-indigo-700 bg-indigo-50">{formatRupiah(emp.net)}</td>
                                                        <td className="p-3 text-center no-print flex justify-center gap-2">
                                                            <button onClick={()=>setSelectedSlip(emp)} className="text-blue-600 border border-blue-600 px-2 py-1 rounded text-xs hover:bg-blue-50">Slip</button>
                                                            <button onClick={()=>shareSlip(emp)} className="text-green-600 border border-green-600 px-2 py-1 rounded text-xs hover:bg-green-50">{Icons.Share}</button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                            <tfoot className="bg-gray-100 font-bold">
                                                <tr>
                                                    <td colSpan="4" className="p-3 text-right">TOTAL</td>
                                                    <td className="p-3 text-right">{formatRupiah(currentPayrollData.reduce((a,b)=>a+b.gross,0))}</td>
                                                    <td className="p-3 text-right text-red-600">({formatRupiah(currentPayrollData.reduce((a,b)=>a+b.tax,0))})</td>
                                                    <td className="p-3 text-right text-indigo-900">{formatRupiah(currentPayrollData.reduce((a,b)=>a+b.net,0))}</td>
                                                    <td className="no-print"></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ABSENSI (Dummy Mobile View) */}
                        {activeTab === 'absensi' && (
                            <div className="flex justify-center items-center min-h-[60vh]">
                                <div className="w-full max-w-sm bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-200 relative">
                                    <div className="bg-emerald-600 p-8 text-white text-center rounded-b-[2rem] shadow-lg relative z-10">
                                        <div className="mb-4 flex justify-center"><div className="p-3 bg-white/20 rounded-full">{Icons.MapPin}</div></div>
                                        <h2 className="text-2xl font-bold">Absensi MBG</h2>
                                        <p className="text-emerald-100 text-sm">Silakan absen di lokasi kerja</p>
                                    </div>
                                    <div className="p-6 space-y-6 pt-10">
                                        <select className="w-full p-3 border rounded-xl bg-gray-50">
                                            <option>Pilih Nama Anda</option>
                                            {employees.map(e=><option key={e.id}>{e.name}</option>)}
                                        </select>
                                        <button className="w-full py-4 rounded-xl text-white font-bold text-lg bg-emerald-600 hover:bg-emerald-700 shadow-lg">ABSEN MASUK</button>
                                    </div>
                                </div>
                            </div>
                        )}

                    </main>

                    {/* SLIP MODAL */}
                    {selectedSlip && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4 no-print backdrop-blur-sm">
                            <div className="bg-white w-full max-w-md rounded-lg overflow-hidden shadow-2xl animate-in zoom-in duration-200">
                                <div className="bg-emerald-900 text-white p-4 flex justify-between items-center">
                                    <h3 className="font-bold">Slip Gaji Digital</h3>
                                    <button onClick={()=>setSelectedSlip(null)} className="hover:text-emerald-200">{Icons.XCircle}</button>
                                </div>
                                <div className="p-6 text-sm">
                                    <div className="text-center border-b pb-4 mb-4"><h2 className="font-bold text-lg">DAPUR MBG NASIONAL</h2><p>Periode: {period}</p></div>
                                    <div className="space-y-2 mb-6">
                                        <div className="flex justify-between"><span>Nama:</span> <b>{selectedSlip.name}</b></div>
                                        <div className="flex justify-between"><span>Jabatan:</span> <span>{selectedSlip.role}</span></div>
                                    </div>
                                    <table className="w-full mb-6">
                                        <tbody>
                                            <tr><td className="py-1 text-gray-600">Gaji Bruto</td><td className="text-right font-medium">{formatRupiah(selectedSlip.gross)}</td></tr>
                                            <tr className="text-red-600"><td className="py-1">Pajak PPh 21</td><td className="text-right">({formatRupiah(selectedSlip.tax)})</td></tr>
                                            <tr className="font-bold border-t border-gray-300 text-lg"><td className="py-3">DITERIMA</td><td className="text-right py-3 text-emerald-700">{formatRupiah(selectedSlip.net)}</td></tr>
                                        </tbody>
                                    </table>
                                    <div className="grid grid-cols-2 gap-3">
                                        <button onClick={()=>window.print()} className="bg-gray-800 text-white py-2 rounded font-bold flex justify-center gap-2 items-center">{Icons.Printer} Cetak</button>
                                        <button onClick={()=>shareSlip(selectedSlip)} className="bg-green-500 text-white py-2 rounded font-bold flex justify-center gap-2 items-center">{Icons.Share} Share WA</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* PRINT SLIP TEMPLATE */}
                    {selectedSlip && (
                        <div className="print-only p-8 bg-white text-black font-serif">
                            <div className="text-center border-b-2 border-black pb-4 mb-8">
                                <h1 className="text-2xl font-bold uppercase tracking-widest">Slip Gaji Karyawan</h1>
                                <p>Program Makan Bergizi Gratis - Periode {period}</p>
                            </div>
                            <div className="mb-8">
                                <p><strong>Nama:</strong> {selectedSlip.name}</p>
                                <p><strong>Jabatan:</strong> {selectedSlip.role}</p>
                            </div>
                            <table className="w-full border-collapse border border-black mb-12">
                                <tr><td className="border border-black p-3">Penghasilan Bruto</td><td className="border border-black p-3 text-right">{formatRupiah(selectedSlip.gross)}</td></tr>
                                <tr><td className="border border-black p-3">Potongan Pajak</td><td className="border border-black p-3 text-right">({formatRupiah(selectedSlip.tax)})</td></tr>
                                <tr className="font-bold text-xl bg-gray-100"><td className="border border-black p-3">TOTAL DITERIMA</td><td className="border border-black p-3 text-right">{formatRupiah(selectedSlip.net)}</td></tr>
                            </table>
                            <div className="flex justify-between mt-20 text-center">
                                <div><p>Penerima,</p><br/><br/><p className="font-bold underline">{selectedSlip.name}</p></div>
                                <div><p>Bendahara,</p><br/><br/><p className="font-bold underline">( ............................. )</p></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MBGEnterpriseFinal />);
    </script>
</body>
</html>
