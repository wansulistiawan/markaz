<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Santri - Yayasan Markaz Yatim Duafa Qurani</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10b981;
            --dark: #064e3b;
            --accent: #f59e0b;
            --bg: #ecfdf5;
            --matched-bg: #2563eb; /* Biru saat cocok */
            --sidebar-bg: #ffffff;
            --slot-bg: #e5e7eb;
        }
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh; 
            overflow: hidden; 
            user-select: none;
        }

        /* --- MENU UTAMA (GAME SELECTION) --- */
        #gameMenu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 200;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow-y: auto; padding: 20px;
        }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; width: 100%; max-width: 1000px; }
        .game-card {
            background: white; border-radius: 15px; padding: 20px; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s;
            border: 2px solid transparent; display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .game-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .status-ready { background: #d1fae5; color: #065f46; font-size: 0.8rem; padding: 4px 10px; border-radius: 10px; font-weight: bold; }
        .status-soon { background: #f3f4f6; color: #6b7280; font-size: 0.8rem; padding: 4px 10px; border-radius: 10px; font-weight: bold; }

        /* --- GAME UI STRUCTURE --- */
        #gameUI { display: none; flex-direction: column; height: 100%; }
        
        .header {
            background: var(--dark); color: white; width: 100%; padding: 8px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex-shrink: 0; z-index: 50;
        }
        .header h1 { margin: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .home-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .user-info {
            position: relative !important; /* Penting */
            overflow: visible !important;  /* Agar mahkota yang keluar tidak terpotong */
            transition: all 0.3s ease;
        }
		.big-champion-crown {
            position: absolute;
            top: -20px;  /* Geser ke atas keluar border */
            left: -20px; /* Geser ke kiri keluar border */
            font-size: 3.5rem; /* Ukuran SANGAT BESAR */
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.3)); /* Efek bayangan agar menonjol */
            z-index: 10; /* Pastikan di layer paling atas */
            transform: rotate(-15deg); /* Miring sedikit biar gaya */
        }

        .main-container {
            display: flex; flex: 1; width: 100%; max-width: 1200px; margin: 0 auto;
            padding: 10px; gap: 15px; overflow: hidden; 
        }

        .game-area {
            flex: 3; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100%;
            overflow: hidden; /* Kunci area utama */
        }

        .sidebar {
            flex: 1; background: var(--sidebar-bg); border-radius: 10px; padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e5e7eb;
            height: 100%; overflow-y: auto; display: flex; flex-direction: column;
        }

        .controls-bar { width: 100%; display: flex; justify-content: center; gap: 8px; margin-bottom: 8px; flex-shrink: 0; }
        .status-bar { display: flex; gap: 10px; justify-content: center; margin-bottom: 8px; font-size: 1rem; font-weight: bold; color: var(--dark); flex-shrink: 0; }
        .badge { background: white; padding: 2px 15px; border-radius: 15px; border: 1px solid var(--primary); font-size: 0.9rem; }
        
        .btn { padding: 6px 12px; border: none; border-radius: 6px; font-family: 'Fredoka', sans-serif; font-weight: 600; font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; transition: background 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-blue { background: #3b82f6; color: white; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }

        /* --- MUFRODAT BOARD --- */
        .timer-container { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-bottom: 10px; flex-shrink: 0; }
        .timer-bar { height: 100%; background: var(--primary); width: 100%; transition: width 0.1s linear; }
        
        .game-board-mufrodat {
            display: grid; 
            gap: 8px; 
            width: 100%; 
            /* Gunakan flex-grow agar mengisi sisa ruang, min-height 0 penting untuk scroll */
            flex-grow: 1; 
            min-height: 0; 
            align-content: start; /* Kartu mulai dari atas */
            justify-content: center; 
            perspective: 1000px;
            overflow-y: auto; /* Scroll muncul hanya di area kartu jika sempit */
            padding-bottom: 20px; /* Ruang nafas bawah */
        }
        .card {
            background-color: transparent;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            /* Animasi dipercepat jadi 0.2 detik */
            transition: transform 0.2s cubic-bezier(0.4, 0.0, 0.2, 1);
            aspect-ratio: 1 / 1;
            max-width: 120px; 
            max-height: 120px;
        }
        .card.flipped { transform: rotateY(180deg); }
        .card.matched { transform: rotateY(180deg); cursor: default; }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; border-radius: 8px; font-weight: bold; padding: 2px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.15); }
        .front { background: linear-gradient(135deg, var(--primary), var(--dark)); color: white; font-size: 2.5rem; border: 2px solid white; }
        .back { background: white; transform: rotateY(180deg); border: 2px solid var(--primary); color: var(--dark); font-size: 1.2rem; line-height: 1.1; overflow:hidden; word-wrap:break-word;}
        .card.matched .back { background-color: var(--matched-bg) !important; color: white !important; border-color: #93c5fd; animation: pulse 0.5s ease-in-out; }
        .arabic-text { font-family: 'Amiri', serif; font-size: 2.2rem !important; font-weight: 900; line-height: 1; margin-top: -5px; }

        /* --- FIQIH BOARD --- */
        .fiqih-container { width: 100%; max-width: 700px; display: flex; flex-direction: column; gap: 20px; padding-bottom: 20px; }
        .fiqih-question { text-align: center; font-size: 1.3rem; font-weight: bold; color: var(--dark); margin-bottom: 10px; }
        .slots-area { display: flex; flex-direction: column; gap: 8px; }
        .slot { background: var(--slot-bg); border: 2px dashed #ccc; border-radius: 8px; min-height: 50px; display: flex; align-items: center; padding: 0 15px; position: relative; }
        .slot-number { background: var(--dark); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; flex-shrink: 0; }
        .slot.filled { border-style: solid; border-color: var(--primary); background: white; }
        .slot.correct { background-color: #d1fae5; border-color: #10b981; }
        .slot.wrong { background-color: #fee2e2; border-color: #ef4444; }
        .pieces-area { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 15px; background: rgba(255,255,255,0.5); border-radius: 10px; border: 1px solid #ccc; }
        .puzzle-piece { background: white; border: 2px solid var(--primary); color: var(--dark); padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .puzzle-piece:hover { transform: scale(1.05); background: var(--bg); }

        @keyframes pulse { 0% { transform: rotateY(180deg) scale(1); } 50% { transform: rotateY(180deg) scale(1.1); } 100% { transform: rotateY(180deg) scale(1); } }

        /* MODAL & OVERLAY */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: white; padding: 20px; border-radius: 15px; text-align: center; width: 90%; max-width: 350px; animation: popIn 0.3s ease; }
        #loadingOverlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.9); z-index: 200; justify-content: center; align-items: center; flex-direction: column; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes popIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* LEADERBOARD */
        .lb-item { padding: 8px; border-bottom: 1px solid #f3f4f6; margin-bottom: 4px; }
        .lb-rank { width: 20px; height: 20px; font-size: 0.7rem; background:var(--dark); color:white; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; margin-right:5px;}
        .rank-badge { font-size: 0.65rem; padding: 1px 5px; border-radius:4px; font-weight:bold;}
        .rank-1 { background: linear-gradient(45deg, #FFD700, #FDB931); color: #5c4004; }
        .rank-2 { background: linear-gradient(45deg, #E0E0E0, #BDBDBD); color: #424242; }
        .rank-3 { background: linear-gradient(45deg, #CD7F32, #A0522D); color: #fff; }
        .rank-legend { background: linear-gradient(45deg, #f59e0b, #b45309); color: white; }
        .rank-master { background: #fbcfe8; color: #9d174d; }
        .rank-high { background: #fef08a; color: #854d0e; }
        .rank-mid { background: #bfdbfe; color: #1e40af; }
        .rank-new { background: #e5e7eb; color: #374151; }

        @media (max-width: 900px) {
            .main-container { flex-direction: column; padding: 5px; }
            .game-area { width: 100%; height: 65vh; }
            .sidebar { display: none; }
            .game-board-mufrodat { max-height: none; }
        }
		
		/* --- TAJWID GAME --- */
        .tajwid-container { width: 100%; max-width: 700px; display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .tajwid-question { 
            text-align: center; font-size: 1.3rem; font-weight: bold; color: var(--dark); 
            background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            width: 100%; border-left: 5px solid var(--accent);
        }
        .quran-display {
            font-family: 'Amiri', serif;
            font-size: 2.2rem;
            line-height: 2.2;
            text-align: center;
            direction: rtl; /* Arab kanan ke kiri */
            background: white;
            padding: 30px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            width: 100%;
            border: 1px solid #e5e7eb;
        }
        
        /* Kata-kata dalam ayat bisa diklik */
        .tajwid-word {
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 5px;
            transition: all 0.2s;
            display: inline-block; /* Agar padding bekerja */
        }
        .tajwid-word:hover {
            background-color: #f3f4f6;
            transform: scale(1.1);
        }
        .tajwid-word.correct {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .tajwid-word.wrong {
            background-color: #fee2e2;
            color: #ef4444;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
		.timer-bar.bonus {
            background-color: #fbbf24 !important; /* Kuning Emas */
            box-shadow: 0 0 15px #fbbf24; /* Efek Glow */
            transition: background-color 0.1s;
        }
		/* --- EFEK TEKS WAKTU MELAYANG --- */
        .floating-time-text {
            position: absolute;
            top: 140px; /* Muncul di bawah timer / atas kartu */
            left: 50%;
            transform: translateX(-50%);
            color: #fbbf24; /* Warna Emas */
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            text-shadow: 
                2px 2px 0px #000, 
                0px 0px 10px rgba(255, 255, 255, 0.5);
            pointer-events: none; /* Agar tidak mengganggu klik */
            z-index: 100;
            animation: floatUpFade 1.2s ease-out forwards;
        }

        @keyframes floatUpFade {
            0% { 
                opacity: 0; 
                transform: translate(-50%, 20px) scale(0.5); 
            }
            20% { 
                opacity: 1; 
                transform: translate(-50%, 0) scale(1.2); 
            }
            100% { 
                opacity: 0; 
                transform: translate(-50%, -80px) scale(1); 
            }
        }
    </style>
</head>
<body>

    <div id="loadingOverlay"><div class="loader"></div><p>Memproses...</p></div>

    <div id="gameMenu">
        <div style="text-align:center; margin-bottom:30px;">
            <h1 style="color:var(--dark); font-size:2.5rem; margin:0;">ğŸ® Arcade Santri</h1>
            <p style="color:#555;">Belajar sambil bermain!</p>
        </div>
        <div class="menu-grid">
            <div class="game-card" onclick="selectGame('mufrodat')">
                <div style="font-size:3rem;">ğŸ§ </div>
                <div style="font-weight:bold; font-size:1.2rem;">Master Mufrodat</div>
                <div style="font-size:0.9rem; color:#666;">Hafalan kosakata kartu.</div>
                <div class="status-ready">MAIN SEKARANG</div>
            </div>
            <div class="game-card" onclick="selectGame('fiqih')">
                <div style="font-size:3rem;">ğŸ§©</div>
                <div style="font-weight:bold; font-size:1.2rem;">Puzzle Fiqih</div>
                <div style="font-size:0.9rem; color:#666;">Urutkan tata cara ibadah.</div>
                <div class="status-ready">MAIN SEKARANG</div>
            </div>
            <div class="game-card" onclick="selectGame('tajwid')">
                <div style="font-size:3rem;">ğŸ”</div>
                <div style="font-weight:bold; font-size:1.2rem;">Detektif Tajwid</div>
                <div style="font-size:0.9rem; color:#666;">Temukan hukum bacaan dalam ayat.</div>
                <div class="status-ready">MAIN SEKARANG</div> </div>
            <div class="game-card" onclick="selectGame('tahfidz')">
                <div style="font-size:3rem;">ğŸ“–</div><div style="font-weight:bold;">Sambung Ayat</div><div class="status-soon">SEGERA HADIR</div>
            </div>
            <div class="game-card" onclick="selectGame('nahwu')">
                <div style="font-size:3rem;">ğŸ—ï¸</div><div style="font-weight:bold;">Juragan Nahwu</div><div class="status-soon">SEGERA HADIR</div>
            </div>
        </div>
    </div>

    <div id="gameUI">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="home-btn" onclick="backToMenu()">ğŸ  Home</button>
                <h1 id="gameTitleDisplay">ğŸ® Game</h1>
            </div>
			<button id="muteBtn" class="home-btn" onclick="toggleMute()">ğŸ”Š On</button>
            <div class="user-info" id="userStatus">Tamu</div>
        </div>

        <div class="main-container">
            <div class="game-area">
                <div class="controls-bar">
                    <button class="btn btn-blue" onclick="fetchLeaderboard(true)">ğŸ† Peringkat</button>
                    <button class="btn btn-accent" id="btnSave" onclick="saveProgress()" disabled>ğŸ’¾ Simpan</button>
                    <button class="btn btn-primary" id="btnLoad" onclick="loadProgress()" disabled>ğŸ“‚ Muat Ulang</button>
                </div>

                <div class="status-bar">
                    <div class="badge">Lv: <span id="levelDisplay">1</span></div>
                    <div class="badge">Skor: <span id="scoreDisplay">0</span></div>
                </div>

                <div class="timer-container" id="mufrodatTimerContainer">
                    <div class="timer-bar" id="timerBar"></div>
                </div>
                <div class="game-board-mufrodat" id="gameBoardMufrodat" style="display:none;"></div>

                <div class="fiqih-container" id="gameBoardFiqih" style="display:none;">
                    <div class="fiqih-question" id="fiqihQuestion">Urutkan Rukun Wudhu</div>
                    <div class="slots-area" id="fiqihSlots"></div>
                    <div style="text-align:center; margin:10px 0;"><p style="font-size:0.9rem; color:#666;">Klik potongan di bawah.</p></div>
                    <div class="pieces-area" id="fiqihPieces"></div>
                    <button class="btn btn-primary" id="checkFiqihBtn" style="width:100%; padding:12px;" onclick="checkFiqihAnswer()">âœ… Cek Jawaban</button>
                </div>
				<div class="tajwid-container" id="gameBoardTajwid" style="display:none;">
                    <div class="tajwid-question" id="tajwidQuestText">Pertanyaan akan muncul di sini...</div>
                    
                    <div class="quran-display" id="quranTextDisplay">
                        </div>

                    <div id="tajwidFeedback" style="height: 20px; font-weight:bold; text-align:center;"></div>
                </div>
            </div>

            <div class="sidebar">
                <h2>ğŸ† Peringkat Top 10</h2>
                <div id="leaderboardList"><p style="text-align:center; color:#999;">...</p></div>
                <div style="margin-top:10px; text-align:center;">
                    <button class="btn btn-blue" onclick="fetchLeaderboard()" style="width:100%;">ğŸ”„ Refresh</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="leaderboardModal">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <h2 style="color: var(--dark); margin-top:0;">ğŸ† Top 10</h2>
            <div id="modalLbContent">Memuat...</div>
            <button class="btn btn-primary" style="margin-top: 15px; width: 100%;" onclick="document.getElementById('leaderboardModal').style.display='none'">Tutup</button>
        </div>
    </div>

    <div class="modal" id="levelModal">
        <div class="modal-content">
            <h2 style="color: var(--primary); margin-top:0;">Ahlan Wa Sahlan! ğŸ‰</h2>
            <p>Level <span id="nextLevelNum" style="font-weight:bold; font-size:1.5rem;"></span> TerTbuka!</p>
            <p>Bonus: +<span id="timeBonus"></span> Poin</p>
            <div style="display:flex; gap:10px; justify-content:center; margin-top:15px;">
                <button class="btn btn-primary" onclick="nextLevel()">Lanjut</button>
                <button class="btn btn-accent" onclick="document.getElementById('levelModal').style.display='none'">Tutup</button>
            </div>
        </div>
    </div>

    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2 style="color: #ef4444; margin-top:0;" id="gameOverTitle">Waktu Habis! â³</h2>
            <p>Skor Akhir: <span id="finalScore" style="font-weight:bold; font-size:1.5rem;"></span></p>
            <div style="display:flex; gap:10px; justify-content:center; margin-top:15px;">
                <button class="btn btn-primary" onclick="restartLevel()">Ulangi</button>
                <button class="btn btn-accent" onclick="restartGame()">Reset</button>
            </div>
        </div>
    </div>

<div class="modal" id="guestModal" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 350px;">
            <h2 style="color: var(--dark); margin-top:0;">Siapa Nama Antum?</h2>
            <p style="color:#666; font-size:0.9rem;">Masukkan nama panggilan untuk dicatat di Papan Peringkat.</p>
            
            <input type="text" id="guestNameInput" placeholder="Contoh: Abdullah" 
                   style="width:100%; padding:12px; margin:15px 0; border:2px solid #ddd; border-radius:8px; font-size:1.1rem; text-align:center; font-weight:bold;">
            
            <button class="btn btn-primary" style="width:100%;" onclick="submitGuestName()">Mulai Bermain ğŸš€</button>
        </div>
    </div>g

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxcwa24mmkgbdHUHQvjAnj_drADmr6Hb1EQyA6q4vK-vjdu-44F4U__19W4st54Skoqww/exec"; 
    
	// === SOUND MANAGER (GENERATOR SUARA TANPA FILE MP3) ===
    const sfx = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        
        // Helper untuk membunyikan nada
        playTone: function(freq, type, duration, vol = 0.3) {
            if (this.ctx.state === 'suspended') this.ctx.resume();
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            
            gain.gain.setValueAtTime(vol, this.ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);

            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.start();
            osc.stop(this.ctx.currentTime + duration);
        },

        // Suara Balik Kartu / Klik
        flip: function() {
            this.playTone(600, 'sine', 0.1, 0.2);
        },

        // Suara Benar (Ting!)
        correct: function() {
            this.playTone(880, 'sine', 0.1, 0.3); // A5
            setTimeout(() => this.playTone(1108, 'sine', 0.3, 0.3), 100); // C#6
        },

        // Suara Salah (Tetot!)
        wrong: function() {
            this.playTone(150, 'sawtooth', 0.3, 0.3);
            setTimeout(() => this.playTone(100, 'sawtooth', 0.4, 0.3), 150);
        },

        // Suara Menang Level (Fanfare Kecil)
        win: function() {
            [523, 659, 784, 1046].forEach((freq, i) => { // C Major Arpeggio
                setTimeout(() => this.playTone(freq, 'square', 0.2, 0.4), i * 100);
            });
        },

        // Suara Game Over
        lose: function() {
            [392, 370, 349, 330].forEach((freq, i) => { // Descending
                setTimeout(() => this.playTone(freq, 'triangle', 0.4, 0.4), i * 200);
            });
        }
    };
	
    let currentGameMode = ''; 
    let currentLevel = 1;
    let score = 0;
    let currentUser = null;

    // === DATA MUFRODAT LENGKAP (7 TIER) ===
    // Tier 1: Benda Sehari-hari
    const tier1 = [
        {a:"ÙƒÙØªÙØ§Ø¨ÙŒ", i:"Buku"}, {a:"Ù‚ÙÙ„ÙÙ…ÙŒ", i:"Pena"}, {a:"Ù…ÙÙƒÙ’ØªÙØ¨ÙŒ", i:"Meja"}, {a:"ÙƒÙØ±Ù’Ø³ÙÙŠÙŒÙ‘", i:"Kursi"}, {a:"Ø¨ÙØ§Ø¨ÙŒ", i:"Pintu"}, {a:"Ù†ÙØ§ÙÙØ°ÙØ©ÙŒ", i:"Jendela"},
        {a:"ÙÙØµÙ’Ù„ÙŒ", i:"Kelas"}, {a:"Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ©ÙŒ", i:"Sekolah"}, {a:"Ø£ÙØ³Ù’ØªÙØ§Ø°ÙŒ", i:"Guru (Lk)"}, {a:"ØªÙÙ„Ù’Ù…ÙÙŠÙ’Ø°ÙŒ", i:"Murid"}, {a:"Ø³ÙØ¨ÙÙ‘ÙˆÙ’Ø±ÙØ©ÙŒ", i:"Papan Tulis"}, {a:"Ù…ÙÙ…Ù’Ø³ÙØ­ÙØ©ÙŒ", i:"Penghapus"},
        {a:"Ø­ÙÙ‚ÙÙŠÙ’Ø¨ÙØ©ÙŒ", i:"Tas"}, {a:"Ù…Ø³Ø·Ø±Ø©", i:"Penggaris"}, {a:"Ø³ÙØ§Ø¹ÙØ©ÙŒ", i:"Jam"}, {a:"Ø¨ÙÙŠÙ’ØªÙŒ", i:"Rumah"}, {a:"ØºÙØ±Ù’ÙÙØ©ÙŒ", i:"Kamar"}, {a:"Ù…ÙØ·Ù’Ø¨ÙØ®ÙŒ", i:"Dapur"},
        {a:"Ø­ÙÙ…ÙÙ‘Ø§Ù…ÙŒ", i:"Kamar Mandi"}, {a:"Ø³ÙØ±ÙÙŠÙ’Ø±ÙŒ", i:"Ranjang"}, {a:"Ù…ÙØ±Ù’Ø¢Ø©ÙŒ", i:"Cermin"}, {a:"Ù…ÙØµÙ’Ø¨ÙØ§Ø­ÙŒ", i:"Lampu"}, {a:"Ø«ÙÙˆÙ’Ø¨ÙŒ", i:"Baju"}, {a:"Ø­ÙØ°ÙØ§Ø¡ÙŒ", i:"Sepatu"},
        {a:"Ø¬ÙÙˆÙ’Ø±ÙØ¨ÙŒ", i:"Kaos Kaki"}, {a:"Ù‚ÙÙ„ÙÙ†Ù’Ø³ÙÙˆÙØ©ÙŒ", i:"Peci"}, {a:"Ù…ÙØ§Ø¡ÙŒ", i:"Air"}, {a:"Ø®ÙØ¨Ù’Ø²ÙŒ", i:"Roti"}, {a:"Ù„ÙØ­Ù’Ù…ÙŒ", i:"Daging"}, {a:"Ø³ÙÙ…ÙÙƒÙŒ", i:"Ikan"}
    ];
    // Tier 2: Kata Kerja & Sifat
    const tier2 = [
        {a:"Ø£ÙÙƒÙÙ„Ù", i:"Makan"}, {a:"Ø´ÙØ±ÙØ¨Ù", i:"Minum"}, {a:"Ù†ÙØ§Ù…Ù", i:"Tidur"}, {a:"Ù‚ÙØ§Ù…Ù", i:"Berdiri"}, {a:"Ø¬ÙÙ„ÙØ³Ù", i:"Duduk"}, {a:"Ø°ÙÙ‡ÙØ¨Ù", i:"Pergi"},
        {a:"Ø±ÙØ¬ÙØ¹Ù", i:"Pulang"}, {a:"Ù‚ÙØ±ÙØ£Ù", i:"Membaca"}, {a:"ÙƒÙØªÙØ¨Ù", i:"Menulis"}, {a:"Ø¯ÙØ®ÙÙ„Ù", i:"Masuk"}, {a:"Ø®ÙØ±ÙØ¬Ù", i:"Keluar"}, {a:"ÙÙØªÙØ­Ù", i:"Membuka"},
        {a:"ØºÙÙ„ÙÙ‚Ù", i:"Menutup"}, {a:"Ù†ÙØ¸ÙØ±Ù", i:"Melihat"}, {a:"Ø³ÙÙ…ÙØ¹Ù", i:"Mendengar"}, {a:"ÙƒÙØ¨ÙŠØ±ÙŒ", i:"Besar"}, {a:"ØµÙØºÙÙŠÙ’Ø±ÙŒ", i:"Kecil"}, {a:"Ø·ÙÙˆÙÙŠÙ’Ù„ÙŒ", i:"Panjang"},
        {a:"Ù‚ÙØµÙÙŠÙ’Ø±ÙŒ", i:"Pendek"}, {a:"Ø¬ÙØ¯ÙÙŠÙ’Ø¯ÙŒ", i:"Baru"}, {a:"Ù‚ÙØ¯ÙÙŠÙ’Ù…ÙŒ", i:"Lama"}, {a:"Ù†ÙØ¸ÙÙŠÙ’ÙÙŒ", i:"Bersih"}, {a:"ÙˆÙØ³ÙØ®ÙŒ", i:"Kotor"}, {a:"Ø¬ÙÙ…ÙÙŠÙ’Ù„ÙŒ", i:"Indah"},
        {a:"Ù‚ÙØ¨ÙÙŠÙ’Ø­ÙŒ", i:"Jelek"}, {a:"Ù‚ÙØ±ÙÙŠÙ’Ø¨ÙŒ", i:"Dekat"}, {a:"Ø¨ÙØ¹ÙÙŠÙ’Ø¯ÙŒ", i:"Jauh"}, {a:"Ø³ÙØ±ÙÙŠÙ’Ø¹ÙŒ", i:"Cepat"}, {a:"Ø¨ÙØ·ÙÙŠÙ’Ø¡ÙŒ", i:"Lambat"}, {a:"Ù‚ÙÙˆÙÙŠÙŒÙ‘", i:"Kuat"}
    ];
    // Tier 3: Alam & Tubuh
    const tier3 = [
        {a:"Ø³ÙÙ…ÙØ§Ø¡ÙŒ", i:"Langit"}, {a:"Ø£ÙØ±Ù’Ø¶ÙŒ", i:"Bumi"}, {a:"Ø´ÙÙ…Ù’Ø³ÙŒ", i:"Matahari"}, {a:"Ù‚ÙÙ…ÙØ±ÙŒ", i:"Bulan"}, {a:"Ù†ÙØ¬Ù’Ù…ÙŒ", i:"Bintang"}, {a:"Ø¬ÙØ¨ÙÙ„ÙŒ", i:"Gunung"},
        {a:"Ø¨ÙØ­Ù’Ø±ÙŒ", i:"Laut"}, {a:"Ù†ÙÙ‡Ù’Ø±ÙŒ", i:"Sungai"}, {a:"Ø´ÙØ¬ÙØ±ÙØ©ÙŒ", i:"Pohon"}, {a:"Ø²ÙÙ‡Ù’Ø±ÙØ©ÙŒ", i:"Bunga"}, {a:"Ø£ÙØ³ÙØ¯ÙŒ", i:"Singa"}, {a:"ÙÙÙŠÙ’Ù„ÙŒ", i:"Gajah"},
        {a:"Ù‚ÙØ·ÙŒÙ‘", i:"Kucing"}, {a:"ÙƒÙÙ„Ù’Ø¨ÙŒ", i:"Anjing"}, {a:"Ø·ÙØ§Ø¦ÙØ±ÙŒ", i:"Burung"}, {a:"Ø±ÙØ£Ù’Ø³ÙŒ", i:"Kepala"}, {a:"Ø¹ÙÙŠÙ’Ù†ÙŒ", i:"Mata"}, {a:"Ø£ÙÙ†Ù’ÙÙŒ", i:"Hidung"},
        {a:"Ø£ÙØ°ÙÙ†ÙŒ", i:"Telinga"}, {a:"ÙÙÙ…ÙŒ", i:"Mulut"}, {a:"ÙŠÙØ¯ÙŒ", i:"Tangan"}, {a:"Ø±ÙØ¬Ù’Ù„ÙŒ", i:"Kaki"}, {a:"Ù‚ÙÙ„Ù’Ø¨ÙŒ", i:"Jantung"}, {a:"Ø¨ÙØ·Ù’Ù†ÙŒ", i:"Perut"},
        {a:"Ø´ÙØ¹Ù’Ø±ÙŒ", i:"Rambut"}, {a:"Ù„ÙØ³ÙØ§Ù†ÙŒ", i:"Lidah"}, {a:"Ø³ÙÙ†ÙŒÙ‘", i:"Gigi"}
    ];
    // Tier 4: Agama
    const tier4 = [
        {a:"ØµÙÙ„ÙØ§Ø©ÙŒ", i:"Sholat"}, {a:"ØµÙÙˆÙ’Ù…ÙŒ", i:"Puasa"}, {a:"Ø²ÙÙƒÙØ§Ø©ÙŒ", i:"Zakat"}, {a:"Ø­ÙØ¬ÙŒÙ‘", i:"Haji"}, {a:"Ø¥ÙÙŠÙ’Ù…ÙØ§Ù†ÙŒ", i:"Iman"}, {a:"ØªÙÙ‚Ù’ÙˆÙÙ‰", i:"Taqwa"},
        {a:"Ø¬ÙÙ†ÙÙ‘Ø©ÙŒ", i:"Surga"}, {a:"Ù†ÙØ§Ø±ÙŒ", i:"Neraka"}, {a:"Ù…ÙÙ„ÙØ§Ø¦ÙÙƒÙØ©ÙŒ", i:"Malaikat"}, {a:"Ø´ÙÙŠÙ’Ø·ÙØ§Ù†ÙŒ", i:"Setan"}, {a:"Ù‚ÙÙŠÙØ§Ù…ÙØ©ÙŒ", i:"Kiamat"}, {a:"Ø°ÙÙ†Ù’Ø¨ÙŒ", i:"Dosa"},
        {a:"Ø«ÙÙˆÙØ§Ø¨ÙŒ", i:"Pahala"}, {a:"Ø¥ÙØ®Ù’Ù„ÙØ§ØµÙŒ", i:"Ikhlas"}, {a:"ØµÙØ¨Ù’Ø±ÙŒ", i:"Sabar"}, {a:"Ø´ÙÙƒÙ’Ø±ÙŒ", i:"Syukur"}, {a:"Ø¹ÙÙ„Ù’Ù…ÙŒ", i:"Ilmu"}, {a:"Ø¹ÙÙ…ÙÙ„ÙŒ", i:"Amal"},
        {a:"ØµÙØ¯Ù’Ù‚ÙŒ", i:"Jujur"}, {a:"ÙƒÙØ°Ù’Ø¨ÙŒ", i:"Dusta"}, {a:"Ø®ÙÙŠÙ’Ø±Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù", i:"Sebaik Manusia"}, {a:"Ø·ÙÙ„ÙØ¨Ù Ø§Ù„Ù’Ø¹ÙÙ„Ù’Ù…Ù", i:"Menuntut Ilmu"}, {a:"Ø¨ÙØ±ÙÙ‘ Ø§Ù„Ù’ÙˆÙØ§Ù„ÙØ¯ÙÙŠÙ’Ù†Ù", i:"Berbakti Ortu"},
        {a:"Ù…ÙÙ†Ù’ Ø¬ÙØ¯ÙÙ‘ ÙˆÙØ¬ÙØ¯Ù", i:"Siapa bersungguh dapat"}, {a:"Ø§Ù„ØµÙÙ‘Ø¨Ù’Ø±Ù Ø¶ÙÙŠÙØ§Ø¡ÙŒ", i:"Sabar itu cahaya"}
    ];
    // Tier 5: Profesi & Keluarga
    const tier5 = [
        {a:"Ø·ÙØ¨ÙÙŠÙ’Ø¨ÙŒ", i:"Dokter"}, {a:"Ù…ÙÙ‡ÙÙ†Ù’Ø¯ÙØ³ÙŒ", i:"Insinyur"}, {a:"ØªÙØ§Ø¬ÙØ±ÙŒ", i:"Pedagang"}, {a:"ÙÙÙ„ÙÙ‘Ø§Ø­ÙŒ", i:"Petani"}, {a:"Ø´ÙØ±Ù’Ø·ÙÙŠÙŒÙ‘", i:"Polisi"}, {a:"Ø¬ÙÙ†Ù’Ø¯ÙÙŠÙŒÙ‘", i:"Tentara"},
        {a:"Ø³ÙØ§Ø¦ÙÙ‚ÙŒ", i:"Sopir"}, {a:"Ø·ÙØ¨ÙÙ‘Ø§Ø®ÙŒ", i:"Koki"}, {a:"Ø£ÙØ¨ÙŒ", i:"Ayah"}, {a:"Ø£ÙÙ…ÙŒÙ‘", i:"Ibu"}, {a:"Ø£ÙØ®ÙŒ", i:"Saudara (Lk)"}, {a:"Ø£ÙØ®Ù’ØªÙŒ", i:"Saudari (Pr)"},
        {a:"Ø¬ÙØ¯ÙŒÙ‘", i:"Kakek"}, {a:"Ø¬ÙØ¯ÙÙ‘Ø©ÙŒ", i:"Nenek"}, {a:"Ø¹ÙÙ…ÙŒÙ‘", i:"Paman (Ayah)"}, {a:"Ø¹ÙÙ…ÙÙ‘Ø©ÙŒ", i:"Bibi (Ayah)"}, {a:"Ø®ÙØ§Ù„ÙŒ", i:"Paman (Ibu)"}, {a:"Ø®ÙØ§Ù„ÙØ©ÙŒ", i:"Bibi (Ibu)"},
        {a:"ÙˆÙÙ„ÙØ¯ÙŒ", i:"Anak (Lk)"}, {a:"Ø¨ÙÙ†Ù’ØªÙŒ", i:"Anak (Pr)"}, {a:"Ø²ÙÙˆÙ’Ø¬ÙŒ", i:"Suami"}, {a:"Ø²ÙÙˆÙ’Ø¬ÙØ©ÙŒ", i:"Istri"}, {a:"Ù‚ÙØ§Ø¶Ù", i:"Hakim"}, {a:"ØµÙÙŠÙÙ‘Ø§Ø¯ÙŒ", i:"Nelayan"}, {a:"Ù…ÙÙ…ÙØ±ÙÙ‘Ø¶ÙŒ", i:"Perawat"}
    ];
    // Tier 6: Waktu, Arah & Transportasi
    const tier6 = [
        {a:"ØµÙØ¨ÙØ§Ø­ÙŒ", i:"Pagi"}, {a:"Ù†ÙÙ‡ÙØ§Ø±ÙŒ", i:"Siang"}, {a:"Ù…ÙØ³ÙØ§Ø¡ÙŒ", i:"Sore"}, {a:"Ù„ÙÙŠÙ’Ù„ÙŒ", i:"Malam"}, {a:"ÙŠÙÙˆÙ’Ù…ÙŒ", i:"Hari"}, {a:"Ø£ÙØ³Ù’Ø¨ÙÙˆÙ’Ø¹ÙŒ", i:"Minggu"},
        {a:"Ø´ÙÙ‡Ù’Ø±ÙŒ", i:"Bulan"}, {a:"Ø³ÙÙ†ÙØ©ÙŒ", i:"Tahun"}, {a:"Ø³ÙØ§Ø¹ÙØ©ÙŒ", i:"Jam"}, {a:"Ø¯ÙÙ‚ÙÙŠÙ’Ù‚ÙØ©ÙŒ", i:"Menit"}, {a:"Ø«ÙØ§Ù†ÙÙŠÙØ©ÙŒ", i:"Detik"}, {a:"Ø£ÙÙ…ÙØ§Ù…Ù", i:"Depan"},
        {a:"ÙˆÙØ±ÙØ§Ø¡Ù", i:"Belakang"}, {a:"ÙÙÙˆÙ’Ù‚Ù", i:"Atas"}, {a:"ØªÙØ­Ù’ØªÙ", i:"Bawah"}, {a:"ÙŠÙÙ…ÙÙŠÙ’Ù†Ù", i:"Kanan"}, {a:"ÙŠÙØ³ÙØ§Ø±Ù", i:"Kiri"}, {a:"Ø³ÙÙŠÙÙ‘Ø§Ø±ÙØ©ÙŒ", i:"Mobil"},
        {a:"Ø·ÙØ§Ø¦ÙØ±ÙØ©ÙŒ", i:"Pesawat"}, {a:"Ù‚ÙØ·ÙØ§Ø±ÙŒ", i:"Kereta Api"}, {a:"Ø¯ÙØ±ÙÙ‘Ø§Ø¬ÙØ©ÙŒ", i:"Sepeda"}, {a:"Ø³ÙÙÙÙŠÙ’Ù†ÙØ©ÙŒ", i:"Kapal"}, {a:"Ø­ÙØ§ÙÙÙ„ÙØ©ÙŒ", i:"Bus"}, {a:"Ø´ÙØ§Ø±ÙØ¹ÙŒ", i:"Jalan"}, {a:"Ù…ÙØ·ÙØ§Ø±ÙŒ", i:"Bandara"}
    ];
    // Tier 7: Hewan Ternak, Warna & Sifat Lanjutan
    const tier7 = [
        {a:"Ø£ÙØ­Ù’Ù…ÙØ±Ù", i:"Merah"}, {a:"Ø£ÙØ¨Ù’ÙŠÙØ¶Ù", i:"Putih"}, {a:"Ø£ÙØ³Ù’ÙˆÙØ¯Ù", i:"Hitam"}, {a:"Ø£ÙØ®Ù’Ø¶ÙØ±Ù", i:"Hijau"}, {a:"Ø£ÙØ²Ù’Ø±ÙÙ‚Ù", i:"Biru"}, {a:"Ø£ÙØµÙ’ÙÙØ±Ù", i:"Kuning"},
        {a:"Ø¬ÙÙ…ÙÙ„ÙŒ", i:"Unta"}, {a:"Ø­ÙØµÙØ§Ù†ÙŒ", i:"Kuda"}, {a:"ØºÙÙ†ÙÙ…ÙŒ", i:"Kambing"}, {a:"Ø¨ÙÙ‚ÙØ±ÙØ©ÙŒ", i:"Sapi"}, {a:"Ø¯ÙØ¬ÙØ§Ø¬ÙØ©ÙŒ", i:"Ayam"}, {a:"Ø¨ÙØ·ÙÙ‘Ø©ÙŒ", i:"Bebek"},
        {a:"Ø£ÙØ±Ù’Ù†ÙØ¨ÙŒ", i:"Kelinci"}, {a:"Ù†ÙÙ…Ù’Ù„ÙØ©ÙŒ", i:"Semut"}, {a:"Ù†ÙØ­Ù’Ù„ÙØ©ÙŒ", i:"Lebah"}, {a:"Ø¨ÙØ¹ÙÙˆÙ’Ø¶ÙØ©ÙŒ", i:"Nyamuk"}, {a:"Ø°ÙØ¨ÙØ§Ø¨ÙŒ", i:"Lalat"}, {a:"Ù†ÙØ´ÙÙŠÙ’Ø·ÙŒ", i:"Rajin"},
        {a:"ÙƒÙØ³Ù’Ù„ÙØ§Ù†Ù", i:"Malas"}, {a:"Ù…ÙØ§Ù‡ÙØ±ÙŒ", i:"Pintar"}, {a:"Ø¬ÙØ§Ù‡ÙÙ„ÙŒ", i:"Bodoh"}, {a:"Ø³ÙÙ…ÙÙŠÙ’Ù†ÙŒ", i:"Gemuk"}, {a:"Ù†ÙØ­ÙÙŠÙ’ÙÙŒ", i:"Kurus"}, {a:"ØºÙØ§Ù„Ù", i:"Mahal"}, {a:"Ø±ÙØ®ÙÙŠÙ’ØµÙŒ", i:"Murah"}
    ];

    // FIQIH DATA
    // === DATA FIQIH (50 LEVEL LENGKAP) ===
    const fiqihData = [
        // LEVEL 1-10: DASAR (Urutan Wajib)
        { title: "Rukun Islam", steps: ["Syahadat", "Sholat", "Zakat", "Puasa", "Haji"] },
        { title: "Rukun Iman", steps: ["Iman kpd Allah", "Malaikat", "Kitab-kitab", "Rasul", "Hari Kiamat", "Qada & Qadar"] },
        { title: "Urutan Rukun Wudhu", steps: ["Niat", "Basuh Muka", "Basuh Tangan", "Usap Kepala", "Basuh Kaki", "Tertib"] },
        { title: "Rukun Sholat (Bagian Awal)", steps: ["Niat", "Takbiratul Ihram", "Berdiri", "Al-Fatihah", "Ruku'", "I'tidal", "Sujud"] },
        { title: "Gerakan Sholat (Satu Rakaat)", steps: ["Takbir", "Fatihah & Surat", "Ruku'", "I'tidal", "Sujud", "Duduk Antara", "Sujud Kedua"] },
        { title: "Mengurus Jenazah", steps: ["Memandikan", "Mengafani", "Menyolatkan", "Menguburkan"] },
        { title: "Waktu Sholat Fardhu", steps: ["Subuh", "Dzuhur", "Ashar", "Maghrib", "Isya"] },
        { title: "Urutan Tayammum", steps: ["Niat", "Usap Muka", "Usap Tangan", "Tertib"] },
        { title: "Rukun Haji", steps: ["Ihram", "Wukuf", "Thawaf Ifadhah", "Sa'i", "Tahallul", "Tertib"] },
        { title: "Urutan Mandi Wajib", steps: ["Niat", "Cuci Tangan", "Bersihkan Kemaluan", "Wudhu", "Siram Kepala", "Siram Badan"] },

        // LEVEL 11-20: VARIASI (Kelompok/Set - Tidak Harus Urut)
        { title: "3 Macam Najis (Urutan Bebas)", steps: ["Mukhaffafah (Ringan)", "Mutawassitah (Sedang)", "Mughallazah (Berat)"], mode: 'unordered' },
        { title: "3 Waktu Haram Sholat", steps: ["Pas Terbit Matahari", "Pas Matahari di Atas", "Pas Terbenam Matahari"], mode: 'unordered' },
        { title: "3 Hari Tasyrik", steps: ["11 Dzulhijjah", "12 Dzulhijjah", "13 Dzulhijjah"], mode: 'unordered' },
        { title: "4 Bulan Haram", steps: ["Dzulqa'dah", "Dzulhijjah", "Muharram", "Rajab"], mode: 'unordered' },
        { title: "5 Hukum Taklifi", steps: ["Wajib", "Sunnah", "Mubah", "Makruh", "Haram"], mode: 'unordered' },
        { title: "Air Yang Suci (Pilih 4)", steps: ["Air Hujan", "Air Sumur", "Air Laut", "Air Sungai"], mode: 'unordered' },
        { title: "Anggota Sujud (7 Tulang)", steps: ["Dahi", "Dua Telapak Tangan", "Dua Lutut", "Dua Ujung Kaki"], mode: 'unordered' },
        { title: "Yang Membatalkan Wudhu (Pilih 3)", steps: ["Keluar Sesuatu dr Kubul/Dubur", "Hilang Akal", "Bersentuhan Kulit Non-Mahram"], mode: 'unordered' },
        { title: "Najis Mutawassitah (Pilih 3)", steps: ["Darah", "Nanah", "Khamr (Arak)"], mode: 'unordered' },
        { title: "Syarat Wajib Sholat (Pilih 3)", steps: ["Islam", "Baligh", "Berakal"], mode: 'unordered' },

        // LEVEL 21-30: URUTAN LANJUTAN (Lafaz & Proses)
        { title: "Urutan Lafaz Adzan (Awal)", steps: ["Allahu Akbar (4x)", "Asyhadu alla ilaha illallah (2x)", "Asyhadu anna Muhammadar Rasulullah (2x)"] },
        { title: "Urutan Lafaz Adzan (Akhir)", steps: ["Hayya 'alas Sholah (2x)", "Hayya 'alal Falah (2x)", "Allahu Akbar (2x)", "La ilaha illallah"] },
        { title: "Urutan Lafaz Iqamah", steps: ["Allahu Akbar", "Syahadatain", "Hayya 'alas Sholah", "Hayya 'alal Falah", "Qad qamatis sholah", "Takbir & Tahlil"] },
        { title: "Urutan Wali Nikah (Prioritas)", steps: ["Ayah Kandung", "Kakek (Ayah dari Ayah)", "Saudara Laki-laki Kandung", "Saudara Laki-laki Seayah", "Paman"] },
        { title: "Urutan Sholat Jumat", steps: ["Adzan Pertama", "Khutbah", "Iqamah", "Sholat 2 Rakaat"] },
        { title: "Rukun Khutbah Jumat", steps: ["Hamdalah", "Sholawat Nabi", "Wasiat Taqwa", "Membaca Ayat Quran", "Doa untuk Mukminin"] },
        { title: "Proses Jual Beli (Rukun)", steps: ["Penjual & Pembeli", "Barang & Harga", "Ijab Qabul (Serah Terima)"] },
        { title: "Urutan Wirid Ba'da Sholat", steps: ["Istighfar", "Tasbih 33x", "Tahmid 33x", "Takbir 33x", "Tahlil", "Doa"] },
        { title: "Menyucikan Najis Berat (Anjing)", steps: ["Hilangkan Wujud", "Basuh 7 Kali Air", "Salah Satunya Campur Tanah"] },
        { title: "Urutan Umrah", steps: ["Ihram dari Miqat", "Thawaf", "Sa'i", "Tahallul", "Tertib"] },

        // LEVEL 31-40: TANTANGAN CAMPURAN 1
        { title: "Rukun Puasa", steps: ["Niat (Malam Hari)", "Menahan Diri (Terbit-Terbenam)"] },
        { title: "Sebab Sujud Sahwi (Pilih 3)", steps: ["Lupa Tasyahud Awal", "Ragu Jumlah Rakaat", "Lupa Doa Qunut"], mode: 'unordered' },
        { title: "Golongan Penerima Zakat 1", steps: ["Fakir", "Miskin", "Amil", "Mualaf"], mode: 'unordered' },
        { title: "Golongan Penerima Zakat 2", steps: ["Riqab (Hamba Sahaya)", "Gharim (Berhutang)", "Sabilillah", "Ibnu Sabil"], mode: 'unordered' },
        { title: "Sunnah Puasa (Pilih 3)", steps: ["Sahur", "Menyegerakan Berbuka", "Berdoa saat Berbuka"], mode: 'unordered' },
        { title: "Sebab Mandi Wajib (Pilih 3)", steps: ["Jima' (Hubungan Suami Istri)", "Haid", "Nifas"], mode: 'unordered' },
        { title: "Rukun Sholat Jenazah", steps: ["Niat", "Berdiri", "4x Takbir", "Salam"] },
        { title: "Bacaan Sholat Jenazah (Urut Takbir)", steps: ["Al-Fatihah", "Sholawat Nabi", "Doa untuk Jenazah", "Doa untuk Keluarga"] },
        { title: "Urutan Peristiwa Kiamat", steps: ["Kematian", "Kebangkitan", "Padang Mahsyar", "Hisab/Mizan", "Sirat", "Surga/Neraka"] },
        { title: "Tanda Baligh (Pilih 3)", steps: ["Mimpi Basah", "Haid (Perempuan)", "Berumur 15 Tahun"], mode: 'unordered' },

        // LEVEL 41-50: TANTANGAN CAMPURAN 2 (EXPERT)
        { title: "Rukun Wakaf", steps: ["Wakif (Pemberi)", "Mauquf (Harta)", "Mauquf 'Alaih (Penerima)", "Sighat (Ikrar)"] },
        { title: "Syarat Sah Sholat Jumat (Pilih 3)", steps: ["Masuk Waktu Dzuhur", "Berjamaah", "Didahului 2 Khutbah"], mode: 'unordered' },
        { title: "Sunnah Wudhu (Pilih 4)", steps: ["Membaca Basmalah", "Siwak", "Kumur-kumur", "Istinsyaq (Hirup Air)"], mode: 'unordered' },
        { title: "Hadas Besar (Pilih 3)", steps: ["Jima'", "Keluar Mani", "Haid"], mode: 'unordered' },
        { title: "Hadas Kecil (Pilih 3)", steps: ["Buang Air Kecil", "Buang Air Besar", "Buang Angin"], mode: 'unordered' },
        { title: "Rukun Qiradh/Mudharabah", steps: ["Pemilik Modal", "Pengelola", "Modal", "Pekerjaan", "Keuntungan"] },
        { title: "Macam Puasa Sunnah (Pilih 3)", steps: ["Senin Kamis", "Ayyamul Bidh", "Puasa Daud"], mode: 'unordered' },
        { title: "Urutan Mengkafani (Laki-laki)", steps: ["Bentangkan Tali", "Bentangkan 3 Lapis Kain", "Letakkan Jenazah", "Lipat Kain", "Ikat Tali"] },
        { title: "Syarat Hewan Qurban (Pilih 3)", steps: ["Binatang Ternak", "Cukup Umur", "Tidak Cacat"], mode: 'unordered' },
        { title: "Rukun Nikah", steps: ["Mempelai Pria", "Mempelai Wanita", "Wali", "Dua Saksi", "Ijab Qabul"] }
    ];
	
	// === DATA TAJWID (50 LEVEL LENGKAP) ===
    const tajwidData = [
        // LEVEL 1-10: NUN SUKUN & TANWIN DASAR
        { text: "Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ Ø®ÙÙ„ÙÙ‚Ù", question: "Temukan Ikhfa Haqiqi", targetIndex: [0] },
        { text: "ÙˆÙÙ…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ ØºÙØ§Ø³ÙÙ‚Ù Ø¥ÙØ°ÙØ§ ÙˆÙÙ‚ÙØ¨Ù", question: "Temukan Izhar Halqi (Tanwin)", targetIndex: [2] },
        { text: "ÙƒÙÙ„ÙÙ‘Ø§ Ù„ÙÙŠÙÙ†Ù’Ø¨ÙØ°ÙÙ†ÙÙ‘ ÙÙÙŠ Ø§Ù„Ù’Ø­ÙØ·ÙÙ…ÙØ©Ù", question: "Temukan Iqlab", targetIndex: [1] },
        { text: "ÙÙÙŠ Ø¬ÙÙŠØ¯ÙÙ‡ÙØ§ Ø­ÙØ¨Ù’Ù„ÙŒ Ù…ÙÙ†Ù’ Ù…ÙØ³ÙØ¯Ù", question: "Temukan Idgham Bighunnah", targetIndex: [2] },
        { text: "Ù…ÙÙ†Ù’ Ù„ÙØ¯ÙÙ†Ù’ÙƒÙ Ø±ÙØ­Ù’Ù…ÙØ©Ù‹", question: "Temukan Idgham Bilaghunnah", targetIndex: [0] },
        { text: "Ø³ÙÙ„ÙØ§Ù…ÙŒ Ù‡ÙÙŠÙ Ø­ÙØªÙÙ‘Ù‰Ù° Ù…ÙØ·Ù’Ù„ÙØ¹Ù Ø§Ù„Ù’ÙÙØ¬Ù’Ø±Ù", question: "Temukan Izhar Halqi", targetIndex: [0] },
        { text: "ÙÙØ°ÙÙƒÙÙ‘Ø±Ù’ Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ø£ÙÙ†Ù’ØªÙ Ù…ÙØ°ÙÙƒÙÙ‘Ø±ÙŒ", question: "Temukan Ikhfa Syafawi (Mim Mati)", targetIndex: [2] }, 
        { text: "Ø¹ÙÙ†Ù’ Ù†ÙØ¨ÙØ¥Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù", question: "Temukan Idgham Bighunnah (Nun Mati)", targetIndex: [0] },
        { text: "ÙƒÙØ±ÙØ§Ù…Ù‹Ø§ ÙƒÙØ§ØªÙØ¨ÙÙŠÙ†Ù", question: "Temukan Ikhfa Haqiqi", targetIndex: [0] },
        { text: "Ù„ÙÙ†ÙØ³Ù’ÙÙØ¹Ù‹Ø§ Ø¨ÙØ§Ù„Ù†ÙÙ‘Ø§ØµÙÙŠÙØ©Ù", question: "Temukan Iqlab (Tanwin)", targetIndex: [0] },

        // LEVEL 11-20: MIM SUKUN & QALQALAH
        { text: "Ù„ÙÙ‡ÙÙ…Ù’ Ù…ÙØ§ ÙŠÙØ´ÙØ§Ø¡ÙÙˆÙ†Ù", question: "Temukan Idgham Mimi", targetIndex: [0] },
        { text: "ØªÙØ±Ù’Ù…ÙÙŠÙ‡ÙÙ…Ù’ Ø¨ÙØ­ÙØ¬ÙØ§Ø±ÙØ©Ù", question: "Temukan Ikhfa Syafawi", targetIndex: [0] },
        { text: "Ø£ÙÙ„ÙÙ…Ù’ ØªÙØ±Ù ÙƒÙÙŠÙ’ÙÙ", question: "Temukan Izhar Syafawi", targetIndex: [0] },
        { text: "Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ­ÙØ¯ÙŒ", question: "Temukan Qalqalah Kubra", targetIndex: [3] },
        { text: "ÙˆÙØ§Ù„Ù’Ø¹ÙØ§Ø¯ÙÙŠÙØ§ØªÙ Ø¶ÙØ¨Ù’Ø­Ù‹Ø§", question: "Temukan Qalqalah Sugra", targetIndex: [1] },
        { text: "Ù„ÙÙƒÙÙ…Ù’ Ø¯ÙÙŠÙ†ÙÙƒÙÙ…Ù’ ÙˆÙÙ„ÙÙŠÙ Ø¯ÙÙŠÙ†Ù", question: "Temukan Izhar Syafawi", targetIndex: [0, 1] },
        { text: "ÙÙÙŠ Ø¬ÙÙŠØ¯ÙÙ‡ÙØ§ Ø­ÙØ¨Ù’Ù„ÙŒ", question: "Temukan Qalqalah Sugra", targetIndex: [2] },
        { text: "Ø¥ÙÙ†ÙÙ‘ Ø±ÙØ¨ÙÙ‘Ù‡ÙÙ…Ù’ Ø¨ÙÙ‡ÙÙ…Ù’", question: "Temukan Ikhfa Syafawi", targetIndex: [1] },
        { text: "ÙˆÙÙ…ÙØ§ Ù„ÙÙ‡ÙÙ…Ù’ Ù…ÙÙ†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", question: "Temukan Idgham Mimi", targetIndex: [1] },
        { text: "Ù…ÙØ§ Ø£ÙØºÙ’Ù†ÙÙ‰Ù° Ø¹ÙÙ†Ù’Ù‡Ù Ù…ÙØ§Ù„ÙÙ‡Ù ÙˆÙÙ…ÙØ§ ÙƒÙØ³ÙØ¨Ù", question: "Temukan Qalqalah Kubra", targetIndex: [5] },

        // LEVEL 21-30: LAM & RA & GUNNAH
        { text: "Ø§ÙÙ„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‘Ù°Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹Ù°Ù„ÙÙ…ÙÙŠÙ’Ù†Ù", question: "Temukan Alif Lam Qamariyah", targetIndex: [0, 3] },
        { text: "Ù…ÙØ§Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù", question: "Temukan Alif Lam Syamsiyah", targetIndex: [2] },
        { text: "ØºÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’", question: "Temukan Ra Tarqiq (Tipis)", targetIndex: [0] },
        { text: "Ù†ÙØµÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ§Ù„Ù’ÙÙØªÙ’Ø­Ù", question: "Temukan Lafzul Jalalah Tafkhim", targetIndex: [1] },
        { text: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù", question: "Temukan Lafzul Jalalah Tarqiq", targetIndex: [1] },
        { text: "Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ø¥ÙÙ†Ù’Ø³ÙØ§Ù†Ù Ù„ÙÙÙÙŠ Ø®ÙØ³Ù’Ø±Ù", question: "Temukan Gunnah (Nun Bertasydid)", targetIndex: [0] },
        { text: "Ø«ÙÙ…ÙÙ‘ Ù„ÙØªÙØ³Ù’Ø£ÙÙ„ÙÙ†ÙÙ‘ ÙŠÙÙˆÙ’Ù…ÙØ¦ÙØ°Ù", question: "Temukan Gunnah (Mim Bertasydid)", targetIndex: [0] },
        { text: "ÙˆÙØ§Ù„Ø´ÙÙ‘Ù…Ù’Ø³Ù ÙˆÙØ¶ÙØ­ÙØ§Ù‡ÙØ§", question: "Temukan Alif Lam Syamsiyah", targetIndex: [0] },
        { text: "ÙˆÙØ§Ù„Ù’Ù‚ÙÙ…ÙØ±Ù Ø¥ÙØ°ÙØ§ ØªÙÙ„ÙØ§Ù‡ÙØ§", question: "Temukan Alif Lam Qamariyah", targetIndex: [0] },
        { text: "ÙÙØ±Ù’Ø¹ÙÙˆÙ’Ù†Ù Ø°ÙÙŠ Ø§Ù„Ù’Ø£ÙÙˆÙ’ØªÙØ§Ø¯Ù", question: "Temukan Ra Tarqiq", targetIndex: [0] },

        // LEVEL 31-40: MAD (PANJANG)
        { text: "Ø¥ÙÙ†ÙÙ‘Ø§ Ø£ÙØ¹Ù’Ø·ÙÙŠÙ’Ù†ÙØ§ÙƒÙ Ø§Ù„Ù’ÙƒÙÙˆÙ’Ø«ÙØ±Ù", question: "Temukan Mad Jaiz Munfasil", targetIndex: [0] },
        { text: "Ø¥ÙØ°ÙØ§ Ø¬ÙØ§Ø¡Ù Ù†ÙØµÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", question: "Temukan Mad Wajib Muttasil", targetIndex: [1] },
        { text: "Ø£ÙØ±ÙØ£ÙÙŠÙ’ØªÙ Ø§Ù„ÙÙ‘Ø°ÙÙŠ ÙŠÙÙƒÙØ°ÙÙ‘Ø¨Ù Ø¨ÙØ§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù", question: "Temukan Mad Arid Lissukun", targetIndex: [3] },
        { text: "ÙˆÙÙ„ÙØ§ Ø§Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù", question: "Temukan Mad Lazim Kilmi Mutsaqqal", targetIndex: [1] },
        { text: "Ù†ÙÙˆØ­ÙŠÙÙ‡ÙØ§", question: "Temukan Mad Thabi'i", targetIndex: [0] },
        { text: "Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ø£ÙØ·Ù’Ø¹ÙÙ…ÙÙ‡ÙÙ…Ù’ Ù…ÙÙ†Ù’ Ø¬ÙÙˆØ¹Ù", question: "Temukan Mad Jaiz Munfasil", targetIndex: [0] },
        { text: "Ù‚ÙÙ„Ù’ ÙŠÙØ§ Ø£ÙÙŠÙÙ‘Ù‡ÙØ§ Ø§Ù„Ù’ÙƒÙØ§ÙÙØ±ÙÙˆÙ†Ù", question: "Temukan Mad Jaiz Munfasil", targetIndex: [1] },
        { text: "Ø³ÙÙŠÙØµÙ’Ù„ÙÙ‰Ù° Ù†ÙØ§Ø±Ù‹Ø§ Ø°ÙØ§ØªÙ Ù„ÙÙ‡ÙØ¨Ù", question: "Temukan Mad Thabi'i", targetIndex: [2] },
        { text: "Ù„ÙØ¥ÙÙŠÙ„ÙØ§ÙÙ Ù‚ÙØ±ÙÙŠÙ’Ø´Ù", question: "Temukan Mad Badal (Hamzah ketemu Mad)", targetIndex: [0] },
        { text: "ÙÙÙ„Ù’ÙŠÙØ¹Ù’Ø¨ÙØ¯ÙÙˆØ§ Ø±ÙØ¨ÙÙ‘ Ù‡ÙÙ°Ø°ÙØ§ Ø§Ù„Ù’Ø¨ÙÙŠÙ’ØªÙ", question: "Temukan Mad Layyin (Wau Sukun didahului Fathah)", targetIndex: [3] },

        // LEVEL 41-50: GHARIB & LANJUTAN
        { text: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙØ¬Ù’Ø±ÙÙŠÙ’Ù‡ÙØ§", question: "Temukan Bacaan Imalah (Majreha)", targetIndex: [2] },
        { text: "Ù„ÙØ§ ØªÙØ£Ù’Ù…ÙÙ†ÙÙ‘Ø§ Ø¹ÙÙ„ÙÙ‰Ù° ÙŠÙÙˆØ³ÙÙÙ", question: "Temukan Bacaan Isymam (Ta'manna)", targetIndex: [1] },
        { text: "Ø¡ÙØ§Û¬Ø¹Ù’Ø¬ÙÙ…ÙÙŠÙŒÙ‘ ÙˆÙØ¹ÙØ±ÙØ¨ÙÙŠÙŒÙ‘", question: "Temukan Bacaan Tashil (A-a'jamiyyun)", targetIndex: [0] },
        { text: "Ø¨ÙØ¦Ù’Ø³Ù Ø§Ù„ÙØ§Ø³Ù’Ù…Ù Ø§Ù„Ù’ÙÙØ³ÙÙˆÙ‚Ù", question: "Temukan Bacaan Naql (Bisa'lismu)", targetIndex: [1] },
        { text: "ÙƒÙÙ„ÙÙ‘Ø§ Û– Ø¨ÙÙ„Ù’ Ûœ Ø±ÙØ§Ù†Ù", question: "Temukan Bacaan Saktah (Berhenti sejenak tanpa nafas)", targetIndex: [2] },
        { text: "ÙˆÙÙ‚ÙÙŠÙ„Ù Ù…ÙÙ†Ù’ Ûœ Ø±ÙØ§Ù‚Ù", question: "Temukan Bacaan Saktah", targetIndex: [1] },
        { text: "Ø§Ù„Ù… ï´¿Ù¡ï´¾ Ø°ÙÙ°Ù„ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù", question: "Temukan Mad Lazim Harfi", targetIndex: [0] },
        { text: "ÙƒÙ‡ÙŠØ¹Øµ", question: "Temukan Mad Lazim Harfi Mukhaffaf", targetIndex: [0] },
        { text: "Ø·Ø³Ù…", question: "Temukan Mad Lazim Harfi Mutsaqqal", targetIndex: [0] },
        { text: "Ù‚ÙÙ„Ù Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù…ÙØ§Ù„ÙÙƒÙ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ", question: "Temukan Lafzul Jalalah Tafkhim", targetIndex: [1] }
    ];
	
	
    function showLoading(show) { document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none'; }
    
    function selectGame(gameId) {
        // 1. Filter Game yang Belum Siap
        if (gameId === 'nahwu') { 
            alert("Game ini sedang dalam pengembangan.");
            return;
        } else if (gameId === 'tahfidz') {
            alert("Game Sambung Ayat sedang disiapkan!");
            return;
        }

        // 2. Simpan Mode Game
        currentGameMode = gameId;

        // 3. CEK USER DENGAN TELITI
        // Panggil checkSession() dulu untuk memastikan data terbaru terbaca
        const isLoggedIn = checkSession();

        if (!isLoggedIn) {
            // Jika benar-benar belum login, baru munculkan modal
            document.getElementById('guestModal').style.display = 'flex';
            document.getElementById('guestNameInput').focus();
            return; 
        }

        // 4. Jika sudah ada user, lanjut ke Tampilan Game
        startGameSequence();
    }

    // Fungsi helper untuk memulai game (dipisahkan agar rapi)
    function startGameSequence() {
        // 1. Sembunyikan Menu, Tampilkan Game UI
        document.getElementById('gameMenu').style.display = 'none';
        document.getElementById('gameUI').style.display = 'flex';

        // 2. Reset Score & Level
        currentLevel = 1; 
        score = 0;

        // 3. Sembunyikan SEMUA Papan Game terlebih dahulu (Reset Tampilan)
        document.getElementById('gameBoardMufrodat').style.display = 'none';
        document.getElementById('mufrodatTimerContainer').style.display = 'none'; 
        document.getElementById('gameBoardFiqih').style.display = 'none';
        document.getElementById('gameBoardTajwid').style.display = 'none'; // Board Baru

        // 4. Tampilkan Papan Game sesuai Mode
        if (currentGameMode === 'mufrodat') {
            document.getElementById('gameTitleDisplay').textContent = "ğŸ® Master Mufrodat";
            document.getElementById('gameBoardMufrodat').style.display = 'grid';
            document.getElementById('mufrodatTimerContainer').style.display = 'block';
            
        } else if (currentGameMode === 'fiqih') {
            document.getElementById('gameTitleDisplay').textContent = "ğŸ§© Puzzle Fiqih";
            document.getElementById('gameBoardFiqih').style.display = 'flex';
            
        } else if (currentGameMode === 'tajwid') {
            // --- LOGIKA BARU UNTUK TAJWID ---
            document.getElementById('gameTitleDisplay').textContent = "ğŸ” Detektif Tajwid";
            document.getElementById('gameBoardTajwid').style.display = 'flex';
        }

        // 5. Sinkronisasi Data User (Ambil Level Terakhir dari Server)
        fetchLeaderboard(false, true);
    }
	
	// === PENGATURAN SUARA ===
    let isMuted = false;

    function toggleMute() {
        isMuted = !isMuted;
        const btn = document.getElementById('muteBtn');
        
        if (isMuted) {
            sfx.ctx.suspend(); // Matikan Audio Context
            btn.innerText = "ğŸ”‡ Off";
            btn.style.background = "rgba(239, 68, 68, 0.5)"; // Merah
        } else {
            sfx.ctx.resume(); // Hidupkan Audio Context
            btn.innerText = "ğŸ”Š On";
            btn.style.background = "rgba(255, 255, 255, 0.2)"; // Normal
        }
    }

    function backToMenu() {
        clearInterval(mufrodatInterval);
        document.getElementById('gameUI').style.display = 'none';
        document.getElementById('gameMenu').style.display = 'flex';
    }

    function checkSession() {
        // Cek 1: Login Utama dari Website Yayasan
        const sessionStr = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
        if (sessionStr) {
            const session = JSON.parse(sessionStr);
            if (session.loggedIn) {
                currentUser = session.userData;
                updateUserUI();
                return true; // Sudah Login
            }
        }

        // Cek 2: Login Tamu (Sesi Sementara Game)
        const guestStr = sessionStorage.getItem('guestSession');
        if (guestStr) {
            currentUser = JSON.parse(guestStr);
            updateUserUI();
            return true; // Sudah Login sebagai Tamu
        } 
        
        // Jika tidak ada keduanya
        currentUser = null;
        document.getElementById('userStatus').innerHTML = `Tamu`;
        document.getElementById('btnSave').disabled = true;
        document.getElementById('btnLoad').disabled = true;
        fetchLeaderboard(false, false); // Load leaderboard umum
        return false; // Belum Login
    }

    function updateUserUI() {
        document.getElementById('userStatus').innerHTML = `<b>ğŸ‘¤ ${currentUser.profileName}</b>`;
        document.getElementById('btnSave').disabled = false;
        document.getElementById('btnLoad').disabled = false;
        fetchLeaderboard(false, true);
    }

	function submitGuestName() {
        const nameInput = document.getElementById('guestNameInput');
        const name = nameInput.value.trim();

        if (name.length < 3) {
            alert("Nama terlalu pendek (min 3 huruf).");
            return;
        }

        // Buat ID unik untuk tamu agar tidak menimpa data orang lain di server
        // Format: guest_TIMESTAMP_ACAK
        const uniqueId = 'guest_' + Date.now() + '_' + Math.floor(Math.random() * 1000);

        const guestUser = {
            username: uniqueId,     // ID Unik untuk database
            profileName: name + " (Tamu)", // Nama Tampilan
            isGuest: true
        };

        // Simpan ke Session Storage (Hilang kalau tutup browser, tapi tahan refresh)
        sessionStorage.setItem('guestSession', JSON.stringify(guestUser));
        
        // Set global user
        currentUser = guestUser;
        updateUserUI();

        // Tutup modal dan mulai game
        document.getElementById('guestModal').style.display = 'none';
        startGameSequence();
    }

    function getRankInfo(level) {
        if (level >= 46) return { title: "ğŸ‘‘ Syaikhul 'Ilmi", class: "rank-legend" };
        if (level >= 31) return { title: "âš”ï¸ Farisul Lughah", class: "rank-master" };
        if (level >= 16) return { title: "ğŸ“š Hafizh Mufrodat", class: "rank-high" };
        if (level >= 6)  return { title: "ğŸ”¥ Thalib Mujtahid", class: "rank-mid" };
        return { title: "ğŸŒ± Thalib Jadid", class: "rank-new" };
    }

    function startGameLevel() {
        if (currentGameMode === 'mufrodat') startMufrodatLevel();
        else if (currentGameMode === 'fiqih') startFiqihLevel();
		else if (currentGameMode === 'tajwid') startTajwidLevel();
    }

    // === SAVE/LOAD ===
    function saveProgress(silent = false) {
        if (!currentUser) { if(!silent) alert("Login dulu!"); return; }
        if(!silent) showLoading(true);
        const btnSave = document.getElementById('btnSave');
        if(silent) btnSave.innerText = "â³...";

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ 
                action: 'saveGameProgress', 
                username: currentUser.username, 
                nama: currentUser.profileName,
                level: currentLevel, skor: score,
                namaGame: currentGameMode 
            })
        }).then(r=>r.json()).then(res => {
            if(!silent) { showLoading(false); alert("Tersimpan!"); }
            else { btnSave.innerText = "âœ…"; setTimeout(()=>btnSave.innerText="ğŸ’¾ Simpan", 2000); }
            fetchLeaderboard(false, false);
        }).catch(e => { if(!silent) showLoading(false); });
    }

    function loadProgress() {
        if (!currentUser) return alert("Login dulu!");
        fetchLeaderboard(false, true);
    }

    function fetchLeaderboard(showModal = false, sync = false) {
        const lbContainer = document.getElementById('leaderboardList');
        if(!showModal && !sync) lbContainer.innerHTML = '<p style="text-align:center; color:#999;">...</p>';

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ 
                action: 'getGameLeaderboardAndProgress', 
                username: currentUser ? currentUser.username : '',
                namaGame: currentGameMode
            })
        }).then(r=>r.json()).then(res => {
            if(res.status === 'success') {
                const html = renderLbHtml(res.leaderboard, res.myProgress);
                lbContainer.innerHTML = html;
                
                // --- LOGIKA MAHKOTA HEADER (UPDATE BESAR) ---
                if (currentUser && res.leaderboard.length > 0) {
                    const champion = res.leaderboard[0];
                    const statusDiv = document.getElementById('userStatus');
                    
                    if (champion.username === currentUser.username) {
                        // JIKA JUARA 1: Pakai span khusus 'big-champion-crown'
                        // Dan beri padding kiri ekstra agar nama tidak tertutup mahkota besar
                        statusDiv.innerHTML = `<b><span class="big-champion-crown">ğŸ‘‘</span> ğŸ‘¤ ${currentUser.profileName}</b>`;
                        
                        // Style kotak emas
                        statusDiv.style.border = "3px solid #FFD700"; 
                        statusDiv.style.background = "linear-gradient(135deg, #064e3b 0%, #b45309 100%)";
                        statusDiv.style.boxShadow = "0 0 15px rgba(255, 215, 0, 0.5)"; // Efek bersinar
                        statusDiv.style.paddingLeft = "40px"; // Beri ruang untuk mahkota besar
                        statusDiv.style.paddingTop = "8px";
                        statusDiv.style.paddingBottom = "8px";
                    } else {
                        // JIKA BUKAN JUARA 1: Kembali normal
                        statusDiv.innerHTML = `<b>ğŸ‘¤ ${currentUser.profileName}</b>`;
                        statusDiv.style.border = "1px solid rgba(255,255,255,0.3)";
                        statusDiv.style.background = "rgba(255,255,255,0.15)";
                        statusDiv.style.boxShadow = "none";
                        statusDiv.style.paddingLeft = "10px"; // Reset padding
                        statusDiv.style.paddingTop = "4px";
                        statusDiv.style.paddingBottom = "4px";
                    }
                }
                // ----------------------------

                if(showModal) {
                    document.getElementById('modalLbContent').innerHTML = html;
                    document.getElementById('leaderboardModal').style.display = 'flex';
                }
                if(sync) {
                    if (res.myProgress) {
                        currentLevel = res.myProgress.level;
                        score = res.myProgress.skor;
                        document.getElementById('levelDisplay').innerText = currentLevel;
                        document.getElementById('scoreDisplay').innerText = score;
                        document.getElementById('btnLoad').innerText = `ğŸ“‚ Muat Ulang (Lv ${currentLevel})`;
                        startGameLevel();
                    } else {
                        startGameLevel();
                    }
                }
            }
        });
    }

    function renderLbHtml(list, me) {
        let html = '';
        list.forEach((item, i) => {
            let rankBadge = "";
            let rankClass = "";
            
            // Tentukan Ikon Juara (Disamping Nama)
            if (i === 0) { 
                rankBadge = " ğŸ¥‡ <span style='color:#d97706; font-weight:bold;'>The Champion</span>"; 
                rankClass = "rank-1";
            } 
            else if (i === 1) { 
                rankBadge = " ğŸ¥ˆ <span style='color:#4b5563; font-weight:bold;'>Runner Up</span>"; 
                rankClass = "rank-2";
            } 
            else if (i === 2) { 
                rankBadge = " ğŸ¥‰ <span style='color:#b45309; font-weight:bold;'>3rd Place</span>"; 
                rankClass = "rank-3";
            }

            // Gelar Level (Tetap muncul)
            let levelInfo = getRankInfo(item.level);

            const isMe = (me && item.username === me.username) ? 'my-rank-item' : '';
            
            html += `
            <div class="lb-item ${isMe}">
                <div class="lb-header">
                    <div>
                        <span class="lb-rank ${rankClass}">${i+1}</span> 
                        <span style="font-weight:bold;">${item.username}</span>
                        ${rankBadge} </div>
                    <span>${item.skor}</span>
                </div>
                <div class="lb-details">
                    <span class="rank-badge ${levelInfo.class}">${levelInfo.title}</span>
                    Lv ${item.level}
                </div>
            </div>`;
        });

        // Tampilkan posisi saya sendiri jika tidak masuk Top 10
        if(me && !list.find(i => i.username === me.username)) {
             let levelInfo = getRankInfo(me.level);
             html += `<div style="margin-top:10px; border-top:2px dashed #ccc; padding-top:10px;">
                <div class="lb-item my-rank-item">
                    <div class="lb-header">
                        <div><span class="lb-rank">?</span> Anda (${me.username})</div>
                        <span>${me.skor}</span>
                    </div>
                    <div class="lb-details">
                        <span class="rank-badge ${levelInfo.class}">${levelInfo.title}</span>
                        Lv ${me.level}
                    </div>
                </div>
            </div>`;
        }
        return html || '<p style="text-align:center;">Belum ada data.</p>';
    }

    // === MUFRODAT LOGIC (FULL) ===
    let mufrodatInterval, mfFirstCard, mfSecondCard, mfLockBoard, mfMatches, mfPairsNeeded, mfTimeLeft, mfTotalTime;

    function getLevelConfig(level) {
        let tierData, gridCols, pairs, timePerPair;
        
        if (level <= 10) { tierData = tier1; gridCols = 3; timePerPair = 15; } 
        else if (level <= 20) { tierData = [...tier1, ...tier2]; gridCols = 4; timePerPair = 12; } 
        else if (level <= 30) { tierData = [...tier2, ...tier3]; gridCols = 4; timePerPair = 10; } 
        else if (level <= 35) { tierData = [...tier3, ...tier4]; gridCols = 4; timePerPair = 10; }
        else if (level <= 40) { tierData = [...tier4, ...tier5]; gridCols = 5; timePerPair = 9; }
        else if (level <= 45) { tierData = [...tier5, ...tier6]; gridCols = 5; timePerPair = 8; }
        else { tierData = [...tier6, ...tier7]; gridCols = 5; timePerPair = 8; } 

        pairs = Math.min(4 + Math.floor(level / 3), 15); 
        if (window.innerWidth < 600 && gridCols > 4) gridCols = 4;

        return { data: tierData, cols: gridCols, pairs: pairs, time: Math.floor(pairs * timePerPair) + 10 };
    }

    function startMufrodatLevel() {
        const board = document.getElementById('gameBoardMufrodat');
        board.innerHTML = '';
        
        const config = getLevelConfig(currentLevel);
        
        mfPairsNeeded = config.pairs;
        mfTotalTime = config.time;
        mfTimeLeft = mfTotalTime;
        mfMatches = 0; mfLockBoard = false; mfFirstCard = null; mfSecondCard = null;

        document.getElementById('levelDisplay').innerText = currentLevel;
        document.getElementById('scoreDisplay').innerText = score;
        board.style.gridTemplateColumns = `repeat(${config.cols}, 1fr)`;

        const shuffled = config.data.sort(() => 0.5 - Math.random()).slice(0, mfPairsNeeded);
        let deck = [];
        shuffled.forEach((item, i) => {
            deck.push({ id: i, content: item.a, type: 'arab' });
            deck.push({ id: i, content: item.i, type: 'indo' });
        });
        deck.sort(() => 0.5 - Math.random());

        deck.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.id = item.id;
            card.innerHTML = `<div class="face front">â“</div><div class="face back ${item.type==='arab'?'arabic-text':''}">${item.content}</div>`;
            card.addEventListener('click', flipMufrodatCard);
            board.appendChild(card);
        });

        startMufrodatTimer();
    }

    function startMufrodatTimer() {
        clearInterval(mufrodatInterval);
        const bar = document.getElementById('timerBar');
        bar.style.width = '100%';
        mufrodatInterval = setInterval(() => {
            mfTimeLeft -= 0.1;
            bar.style.width = `${(mfTimeLeft/mfTotalTime)*100}%`;
            if(mfTimeLeft <= 0) { clearInterval(mufrodatInterval); showGameOver(); }
        }, 100);
    }

// Fungsi untuk memunculkan efek teks
    function showFloatingTime(text) {
        const gameArea = document.querySelector('.game-area');
        const floatingEl = document.createElement('div');
        floatingEl.className = 'floating-time-text';
        floatingEl.innerText = text;
        
        // Masukkan elemen ke area game
        gameArea.appendChild(floatingEl);

        // Hapus elemen otomatis setelah animasi selesai (1.2 detik)
        setTimeout(() => {
            floatingEl.remove();
        }, 1200);
    }

    function flipMufrodatCard() {
        if (mfLockBoard || this === mfFirstCard || this.classList.contains('matched')) return;

        if(typeof sfx !== 'undefined') sfx.flip();
        this.classList.add('flipped');

        if (!mfFirstCard) { mfFirstCard = this; return; }
        mfSecondCard = this; mfLockBoard = true;

        if (mfFirstCard.dataset.id === mfSecondCard.dataset.id) {
            // --- JAWABAN BENAR ---
            if(typeof sfx !== 'undefined') sfx.correct();
            
            score += 10; mfMatches++;
            document.getElementById('scoreDisplay').innerText = score;
            mfFirstCard.classList.add('matched'); mfSecondCard.classList.add('matched');
            
            // === LOGIKA BONUS WAKTU & TEKS ===
            let bonus = 0;
            let textBonus = "";

            if (currentLevel >= 40) {
                bonus = 6;
                textBonus = "+6 Menit";
            } else if (currentLevel >= 20) {
                bonus = 5;
                textBonus = "+5 Menit";
            } else {
                bonus = 4;
                textBonus = "+4 Menit";
            }
            
            mfTimeLeft += bonus;
            // Batasi agar tidak melebihi waktu maksimal awal
            if(mfTimeLeft > mfTotalTime) mfTimeLeft = mfTotalTime;

            // PANGGIL EFEK TEKS
            showFloatingTime(textBonus);

            // Efek Bar Berkedip
            const bar = document.getElementById('timerBar');
            bar.classList.add('bonus'); 
            setTimeout(() => bar.classList.remove('bonus'), 500);
            
            mfFirstCard = null; mfSecondCard = null; mfLockBoard = false;
            if (mfMatches === mfPairsNeeded) showLevelComplete(Math.floor(mfTimeLeft));
        } else {
            // --- JAWABAN SALAH ---
            if(typeof sfx !== 'undefined') sfx.wrong();
            setTimeout(() => {
                mfFirstCard.classList.remove('flipped'); mfSecondCard.classList.remove('flipped');
                mfFirstCard = null; mfSecondCard = null; mfLockBoard = false;
            }, 1000);
        }
    }

    // === FIQIH LOGIC ===
    let fiqihCurrentSeq = [];

    function startFiqihLevel() {
        document.getElementById('levelDisplay').innerText = currentLevel;
        document.getElementById('scoreDisplay').innerText = score;
        document.getElementById('checkFiqihBtn').innerText = "âœ… Cek Jawaban";

        const idx = (currentLevel - 1) % fiqihData.length;
        const data = fiqihData[idx];
        fiqihCurrentSeq = data.steps;

        // Update Judul
        document.getElementById('fiqihQuestion').innerText = data.title;
        
        // Update Instruksi berdasarkan Mode
        const instructionText = document.querySelector('#gameBoardFiqih p'); // Cari elemen <p> instruksi
        if(instructionText) {
            if(data.mode === 'unordered') {
                instructionText.innerText = "Urutan BEBAS. Klik potongan yang termasuk dalam kategori di atas.";
                instructionText.style.color = "#059669"; // Hijau biar beda
            } else {
                instructionText.innerText = "Klik potongan di bawah untuk menyusun URUTAN yang benar.";
                instructionText.style.color = "#666";
            }
        }

        const slotsArea = document.getElementById('fiqihSlots');
        slotsArea.innerHTML = '';
        fiqihCurrentSeq.forEach((_, i) => {
            const d = document.createElement('div');
            d.className = 'slot'; 
            d.dataset.index = i;
            // Tampilkan nomor hanya jika mode urutan
            const numberHtml = (data.mode === 'unordered') ? 'â€¢' : (i + 1);
            d.innerHTML = `<div class="slot-number">${numberHtml}</div><div class="slot-content"></div>`;
            d.addEventListener('click', handleSlotClick);
            slotsArea.appendChild(d);
        });

        const piecesArea = document.getElementById('fiqihPieces');
        piecesArea.innerHTML = '';
        // Acak potongan soal
        [...fiqihCurrentSeq].sort(()=>0.5-Math.random()).forEach(txt => {
            const p = document.createElement('div');
            p.className = 'puzzle-piece'; 
            p.innerText = txt;
            p.addEventListener('click', handlePieceClick);
            piecesArea.appendChild(p);
        });
    }

    function handlePieceClick() {
        const empty = Array.from(document.querySelectorAll('.slot')).find(s => !s.classList.contains('filled'));
        if(empty) {
			sfx.flip();
            empty.querySelector('.slot-content').innerText = this.innerText;
            empty.classList.add('filled'); empty.dataset.value = this.innerText;
            this.remove();
        }
    }

    function handleSlotClick() {
        if(!this.classList.contains('filled')) return;
        const txt = this.dataset.value;
        const p = document.createElement('div');
        p.className = 'puzzle-piece'; p.innerText = txt;
        p.addEventListener('click', handlePieceClick);
        document.getElementById('fiqihPieces').appendChild(p);
        this.classList.remove('filled','correct','wrong');
        this.querySelector('.slot-content').innerText = '';
        this.dataset.value = '';
    }

    function checkFiqihAnswer() {
        const slots = document.querySelectorAll('.slot');
        let correctCount = 0;
        let isFull = true;
        
        // Ambil data level saat ini untuk cek mode
        const idx = (currentLevel - 1) % fiqihData.length;
        const currentData = fiqihData[idx];
        const isUnordered = currentData.mode === 'unordered';

        // Cek apakah semua slot terisi
        slots.forEach(slot => {
            if (!slot.classList.contains('filled')) isFull = false;
        });

        if (!isFull) return alert("Lengkapi semua kotak dulu!");

        // Logika Pengecekan
        slots.forEach((slot, i) => {
            const userValue = slot.dataset.value;
            
            if (isUnordered) {
                // Mode ACAK: Cek apakah jawaban user ADA di dalam kunci jawaban manapun?
                // Dan pastikan tidak duplikat (sudah dicek oleh mekanisme puzzle piece yang hilang saat diklik)
                if (fiqihCurrentSeq.includes(userValue)) {
                    slot.classList.add('correct');
                    correctCount++;
                } else {
                    slot.classList.add('wrong');
                }
            } else {
                // Mode URUTAN (Default): Cek indeks harus sama persis
                if (userValue === fiqihCurrentSeq[i]) {
                    slot.classList.add('correct');
                    correctCount++;
                } else {
                    slot.classList.add('wrong');
                }
            }
        });

        if (correctCount === fiqihCurrentSeq.length) {
			sfx.win();
            score += 50; 
            showLevelComplete(0); 
        } else {
			sfx.wrong();
            score = Math.max(0, score - 10); 
            document.getElementById('scoreDisplay').innerText = score;
            alert("Masih ada yang salah, coba lagi!");
            setTimeout(() => {
                slots.forEach(s => s.classList.remove('correct', 'wrong'));
            }, 1500);
        }
    }

	// ============================================
    // === LOGIKA GAME 3: DETEKTIF TAJWID ===
    // ============================================
    let tajwidTargetIndices = [];

    function startTajwidLevel() {
        document.getElementById('levelDisplay').innerText = currentLevel;
        document.getElementById('scoreDisplay').innerText = score;
        document.getElementById('tajwidFeedback').innerText = ""; // Reset feedback

        // Ambil data soal (Looping jika level > jumlah soal)
        const idx = (currentLevel - 1) % tajwidData.length;
        const data = tajwidData[idx];
        
        tajwidTargetIndices = data.targetIndex; // Array kunci jawaban

        document.getElementById('tajwidQuestText').innerText = data.question;

        const quranContainer = document.getElementById('quranTextDisplay');
        quranContainer.innerHTML = '';

        // Pecah ayat menjadi kata-kata berdasarkan spasi
        const words = data.text.split(" ");

        words.forEach((word, index) => {
            const span = document.createElement('span');
            span.className = 'tajwid-word';
            span.innerText = word;
            span.dataset.index = index;
            
            span.addEventListener('click', function() {
                checkTajwidAnswer(this, parseInt(this.dataset.index));
            });

            quranContainer.appendChild(span);
            // Tambah spasi visual antar kata
            quranContainer.appendChild(document.createTextNode(" "));
        });
    }

    function checkTajwidAnswer(element, clickedIndex) {
        // Cek apakah indeks yang diklik ada di dalam kunci jawaban
        if (tajwidTargetIndices.includes(clickedIndex)) {
            // BENAR
			sfx.correct();
            element.classList.add('correct');
            document.getElementById('tajwidFeedback').style.color = "#10b981";
            document.getElementById('tajwidFeedback').innerText = "Benar! Mumtaz!";
            
            // Poin & Lanjut
            score += 20;
            setTimeout(() => {
                showLevelComplete(0); // Tidak ada bonus waktu
            }, 1000);
        } else {
            // SALAH
			sfx.wrong();
            element.classList.add('wrong');
            score = Math.max(0, score - 5);
            document.getElementById('scoreDisplay').innerText = score;
            
            document.getElementById('tajwidFeedback').style.color = "#ef4444";
            document.getElementById('tajwidFeedback').innerText = "Kurang tepat, coba lagi.";
            
            // Hapus warna merah setelah sebentar
            setTimeout(() => {
                element.classList.remove('wrong');
            }, 500);
        }
    }


    // === SHARED LOGIC ===
    function showLevelComplete(bonus) {
		sfx.win();
        clearInterval(mufrodatInterval);
        score += bonus;
        document.getElementById('scoreDisplay').innerText = score;
        saveProgress(true);
        document.getElementById('nextLevelNum').innerText = currentLevel + 1;
        document.getElementById('timeBonus').innerText = bonus;
        document.getElementById('levelModal').style.display = 'flex';
    }

    function showGameOver() {
		sfx.lose();
        document.getElementById('finalScore').innerText = score;
        document.getElementById('gameOverModal').style.display = 'flex';
    }

    function nextLevel() {
        currentLevel++;
        document.getElementById('levelModal').style.display = 'none';
        startGameLevel();
    }

    function restartLevel() {
        document.getElementById('gameOverModal').style.display = 'none';
        startGameLevel();
    }

    function restartGame() {
        currentLevel = 1; score = 0;
        document.getElementById('gameOverModal').style.display = 'none';
        startGameLevel();
    }
</script>
</body>
</html>
